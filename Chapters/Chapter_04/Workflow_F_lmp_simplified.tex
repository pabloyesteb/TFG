
\begin{figure}[!htb]
%\begin{changemargin}{-2.2cm}{-1cm}
\begin{adjustbox}{width=\textwidth}
\begin{tikzpicture}[,>=stealth,thick, text=black,
every new ->/.style={shorten >=1pt}]
%\tikzstyle{every node}=[font=\small]
% ---------- NODES ----------
\matrix[column sep=4mm] { 
% === === === === F_lmp diagram === === === === 
% ***** First row *****
\node (lmp)			[terminal_gray] {$ l,m,p $}; 							& 																			& 
 																			& 																			& &
\node (ft1)			[terminal_red] {$ C_{t} $}; 								& 																			& 
 																			& 																			& 
 																			& 																			\\[2ex]	
% ***** Second row *****
																			& 																			& 
																			& \node (pt4)		[point] 		{};										& \node (pt5)		[point] 		{};&			
\node (ft2)			[terminal_red] {$ (\sin i)^\bullet $}; 					& \node (ft)		[terminal_red] {$ f_{t} = C_{t} \cdot (\sin i)^\bullet \cdot S_s $};	& 
\node (F_lmp)		[terminal_gray] {$ F_{lmp} = F_{lmp} + f_t $}; 			& \node (t_decision)[decision] 		{$t \overset{\mathord{?}}{=} t_{max} $};& 
\node (t_yes)		[cloud] 		{Yes}; 									& \node (F_lmp_end)	[terminal_red] {$ F_{lmp}  $}; 							\\[2ex]																	
% ***** Third row *****
 																			&\node (t_0) 		[terminal_white]{$ t = 0 $}; 							& 
\node (t)			[terminal_gray] {$ t $};  								& 																			&  &
\node (Flmp_Ss)		[terminal_garnet] {$ S_s $}; 							& 																			& 
\node (Flmp_0) 		[terminal_white]{$ F_{lmp} = 0 $}; 						& \node (t_no)		[cloud] 		{No}; 									& 
 																			& 																			\\[2ex]	
% ***** 4th row *****
																			& 																			& 
 																			&  																			& &
\node (t_plus_1)	[nonterminal] 	{$t = t + 1$};  						&  																			& 
																			&  																			& 
																			&																			\\[10ex]																	
% === === === === S_s diagram === === === === 
% ***** First row *****
\node (lmpt)		[terminal_gray] {$ l, m, p, t $}; 							& 																			& 
 																			& 																			& &
\node (fs1)			[terminal_red] {$ C_{s} $}; 								& 																			& 
 																			& 																			& 
 																			& 																			\\[2ex]	
% ***** Second row *****
																			& 																			& 
																			& \node (ps4)		[point] 		{};									 	& \node (ps5)		[point] 		{};&
\node (fs2)			[terminal_red] {$ \cos^s i$}; 							& \node (fs)		[terminal_red] {$ f_{s} = C_{s} \cdot \cos^s i \cdot S_c $};	& 
\node (S_s)			[terminal_gray] {$ S_{s} = S_{s} + f_s $}; 				& \node (s_decision)[decision] 		{$s \overset{\mathord{?}}{=} t_{max} $};& 
\node (s_yes)		[cloud] 		{Yes}; 									& \node (S_s_end)	[terminal_red] {$ S_{s}  $}; 							\\[2ex]																	
% ***** Third row *****
 																			&\node (s_0) 		[terminal_white]{$ s = 0 $}; 							& 
\node (s)			[terminal_gray] {$ s $};  								& 																			&  &
\node (Ss_Sc)		[terminal_garnet] {$ S_s $}; 							& 																			& 
\node (Ss_0) 		[terminal_white]{$ S_s = 0 $}; 							& \node (s_no)		[cloud] 		{No}; 									& 
 																			& 																			\\[2ex]	
% ***** 4th row *****
																			& 																			& 
 																			&  																			& &
\node (s_plus_1)	[nonterminal] 	{$s = s + 1$};  						&  																			& 
																			&  																			& 
																			&																			\\[10ex]																	
% === === === === S_c diagram === === === === 
% ***** First row *****
\node (lmpts)			[terminal_gray] {$ l,m,p,t,s $}; 					& 																			& 
 																			& 																			& &
\node (fc1)			[terminal_red] {$ f_{c1} $}; 							& 																			& 
 																			& 																			& 
 																			& 																			\\[2ex]	
% ***** Second row *****
																			& 																			& 
																			& \node (pc4)		[point] 		{};									 	& \node (pc5)		[point] 		{};&
\node (fc2)			[terminal_red] {$ f_{c2} $}; 							& \node (fc)		[terminal_red] {$ C_{c} = f_{c1} \cdot f_{c2} \cdot f_{c3} $};	& 
\node (S_c)			[terminal_gray] {$ S_c = S_c + C_c $}; 					& \node (c_decision)[decision] 		{$c \overset{\mathord{?}}{=} c_{max} $};& 
\node (c_yes)		[cloud] 		{Yes}; 									& \node (S_c_end)	[terminal_red] {$ S_c  $}; 							\\[2ex]																	
% ***** Third row *****
 																			&\node (c_0) 		[terminal_white]{$ c = 0 $}; 							& 
\node (c)			[terminal_gray] {$ c $};  								& 																			&  &
\node (fc3)			[terminal_red] {$ f_{c3} $}; 						& 																			& 
\node (Sc_0) 		[terminal_white]{$ S_c = 0 $}; 							& \node (c_no)		[cloud] 		{No}; 									& 
 																			& 																			\\[2ex]	
% ***** 4th row *****
																			& 																			& 
 																			&  																			& 
\node (c_plus_1)	[nonterminal] 	{$c = c + 1$};  						&  																			& 
																			&  																			& 
																			&																			\\[10ex]
																			};
% ----------- GRAPH ----------
\node (Flmp_text)	[GMVred!70, above = 14ex of ft]		{\huge{$\bm F_{lmp}$ \textbf{calculation}}};
\node (Ss_text)		[GMVred!70, above = 14ex of fs]		{\huge{$\bm S_{s}$ \textbf{calculation}}};
\node (Ss_text)		[GMVred!70, above = 14ex of fc]		{\huge{$\bm S_{c}$ \textbf{calculation}}};
\begin{pgfonlayer}{background}
\draw	[GMVred!50, thick, fill = GMVred, opacity = 0.05] 	($(lmp.north east) + (8ex, 0.6ex)$) rectangle ($(F_lmp_end.south east) - (5ex, 20ex)$);
\draw	[GMVred!50, thick, fill = GMVred, opacity = 0.1] 	($(lmpt.north east) + (6ex, 0.6ex)$) rectangle ($(S_s_end.south east) - (5ex, 20ex)$);
\draw	[GMVred!50, thick, fill = GMVred, opacity = 0.2] 	($(lmpts.north east) + (6ex, 0.6ex)$) rectangle ($(S_c_end.south east) - (5ex, 25ex)$);
%\node[GMVred!70, above = 0.5ex of lpq]{$V_{lmpq}$ calculation};
\end{pgfonlayer}
\graph [use existing nodes] {
t_0 				-> [double distance=2pt] t;
s_0 				-> [double distance=2pt] s;
c_0 				-> [double distance=2pt] c;
Sc_0 				-> [double distance=2pt] S_c;
Ss_0 				-> [double distance=2pt] S_s;
Flmp_0 				-> [double distance=2pt] F_lmp;
lmp 				-- [hv path] pt4 				-- pt5 					-> ft2 					-> ft -> F_lmp 	-> t_decision 		-> t_yes -> F_lmp_end;
lmpt 				-- [hv path] ps4 				-- ps5 					-> fs2 					-> fs -> S_s 	-> s_decision 		-> s_yes -> S_s_end; 
lmpts 				-- [hv path] pc4 				-- pc5 					-> fc2 					-> fc -> S_c 	-> c_decision 		-> c_yes -> S_c_end; 
t_decision 			-> t_no 						-> [vh path] t_plus_1 	->[hv path]t 	-- [hv path] pt4;
s_decision 			-> s_no 						-> [vh path] s_plus_1 	->[hv path]s 	-- [hv path] ps4;
c_decision 			-> c_no 						-> [vh path] c_plus_1 	->[hv path]c 	-- [hv path] pc4;
pt5 				-> [vh path] ft1 				-> [hv path] ft.north west ;
ps5 				-> [vh path] fs1 				-> [hv path] fs.north west;
pc5 				-> [vh path] fc1 				-> [hv path] fc.north west;
pt5 				-> [vh path] Flmp_Ss 			-> [hv path] ft.south west;
ps5 				-> [vh path] Ss_Sc 				-> [hv path] fs.south west;
pc5 				-> [vh path] fc3 				-> [hv path] fc.south west;
S_c_end 			-> [bend right, dotted, thick] Ss_Sc;
S_s_end 			-> [bend right, dotted, thick] Flmp_Ss;
};
%%\node[rectangle, draw=GMVred!50, thick] (rect) at  

\end{tikzpicture}
\end{adjustbox}
%\end{changemargin}
\caption{Workflow of the computation of $F_{lmp}$.}
\label{tikz:Workflow_F_lmp_simp}
\end{figure}