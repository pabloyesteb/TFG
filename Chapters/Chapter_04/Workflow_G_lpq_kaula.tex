
\begin{figure}[!htb]
\begin{changemargin}{-2.2cm}{-1cm}
\begin{adjustbox}{width=1.2\textwidth}
\begin{tikzpicture}[,>=stealth,thick, text=black,
every new ->/.style={shorten >=1pt}]
%\tikzstyle{every node}=[font=\small]
% ---------- NODES ----------
\matrix[column sep=4mm] { 
% === === === === G_{lpq} diagram === === === === 
% ***** First row *****
\node (lpq)			[terminal_gray] {$ l,p,q $}; 							& 																			& 
 																			& 																			& 
 																			& \node (fk1)			[terminal_red] {$ f_{k1} $}; 						& 																																						&  																			& 																			
 																			& 																			& 																	
 																			\\[2ex]	
% ***** Second row *****
																			& 																			& 
																			& \node (pk4)		[point] 		{};											& 
\node (pk5)		[point] 		{};												& \node (Plpqk)		[terminal_garnet] {$ P_{lpqk} $}; 						& 
\node (fk)		[terminal_red] {$ f_{k} = f_{k1} \cdot P_{lpqk} \cdot Q_{lpqk}$};	& \node (G_lpq)		[terminal_gray] {$ G_{lpq} = G_{lpq} + f_k $}; 		& 
\node (k_decision)[decision] 		{$k \overset{\mathord{?}}{=} k_{max} $};	& \node (k_yes)		[cloud] 		{Yes}; 										& 
\node (G_lpq_end)	[terminal_red] {$ G_{lpq}  $}; 							\\[2ex]																	
% ***** Third row *****
 																			& \node (k_0) 		[terminal_white]{$ k = 0 $}; 							& 
\node (k)			[terminal_gray] {$ k $};  								& 																			& 
																			& \node (Qlpqk)		[terminal_garnet] {$ Q_{lpqk}$}; 						& 																		
																			& \node (G_lpq_0) 	[terminal_white]{$ G_{lpq} = 0 $}; 						& 
\node (k_no)		[cloud] 		{No}; 											& 																			& 																			
																			\\[2ex]	
% ***** 4th row *****
																			& 																			& 
 																			&  																			&
 																			&\node (k_plus_1)	[nonterminal] 	{$k = k + 1$};  							&  
 																			& 																			& 
 																			& 																			&
																			\\[10ex]																	
% === === === === P, Q diagram === === === === 
% ***** First row *****
\node (lpqk)		[terminal_gray] {$ l, p, q, k $}; 							& 																			&
 																			& \node (pr4)		[point] 		{};									 		&
\node (pprime)		[terminal_red] {$ p', q', h $}; 							& 																			&
\node (fr1)			[terminal_red] {$ f_{r1} $}; 							& 																			&
\node (phi_def)			[cloud] 		{$\varphi = P, Q$}; 						& 																			&
																			& 																			\\[2ex]	
% ***** Second row *****
																			& 																			& 
																			&																			& 
\node (pr5)			[point] 		{};											& \node (lpprime)	[terminal_gray] {$ l, p', q', h, r $}; 					&
\node (fr2)			[terminal_red] {$ f_{r2} $}; 							& \node (fr)		[terminal_red] {$ f_{r} = f_{r1} \cdot f_{r2} \cdot f_{r3} $};& 
\node (phi)			[terminal_gray] {$ \varphi_{lpqk} = \varphi_{lpqk} + f_r $}; 	& \node (r_decision)[decision] 		{$r \overset{\mathord{?}}{=} r_{max} $};& 
\node (r_yes)		[cloud] 		{Yes}; 										& \node (phi_end)	[terminal_red] {$ \varphi_{lpqk}  $}; 					\\[2ex]																	
% ***** Third row *****
 																			& \node (r_0) 		[terminal_white]{$ r = 0 $}; 							& 
\node (r)			[terminal_gray] {$ r $};  								& 																			& 
																			& 																			& 
\node (fr3)			[terminal_red] {$ f_{r3} $}; 							& 																			& 
\node (phi_0) 		[terminal_white]{$ \phi_{lpqk} = 0 $}; 					& \node (r_no)		[cloud] 		{No}; 										&
 																			& 																			\\[2ex]	
% ***** 4th row *****
																			& 																			& 
 																			&  																			&
 	 																		&  																			&																		
\node (r_plus_1)	[nonterminal] 	{$r = r + 1$};  								&  																			& 
																			&  																			& 
																			&																			\\[10ex]																	
																			};
% ----------- GRAPH ----------
\node (Glpq_text)	[GMVred!70, above = 14ex of fk]		{\huge{$\bm G_{lpq}$ \textbf{calculation}}};
\node (PQ_text)		[GMVred!70, above = 14ex of fr2]		{\huge{$\bm P_{lpqk}, \bm Q_{lpqk}$ \textbf{calculation}}};
\begin{pgfonlayer}{background}
\draw	[GMVred!50, thick, fill = GMVred, opacity = 0.05] 	($(lpq.north east) + (8ex, 0.6ex)$) rectangle ($(G_lpq_end.south east) - (5ex, 20ex)$);
\draw	[GMVred!50, thick, fill = GMVred, opacity = 0.1] 	($(lpqk.north east) + (6ex, 0.6ex)$) rectangle ($(phi_end.south east) - (5ex, 20ex)$);
%\node[GMVred!70, above = 0.5ex of lpq]{$V_{lmpq}$ calculation};
\end{pgfonlayer}
\graph [use existing nodes] {
k_0 				-> [double distance=2pt] k;
r_0 				-> [double distance=2pt] r;
G_lpq_0 			-> [double distance=2pt] G_lpq;
phi_0 				-> [double distance=2pt] phi;
lpq 				-- [hv path] pk4 				-- pk5 					-> Plpqk 				-> fk 	-> G_lpq 			-> k_decision 		-> k_yes 			-> G_lpq_end;
lpqk 				--  pr4 						-- [vh path] pr5 		-> lpprime				-> fr2 			-> fr 				-> phi 				-> r_decision 		-> r_yes -> phi_end; 
k_decision 			-> k_no 						-> [vh path] k_plus_1 	->[hv path]k 	-- [hv path] pk4;
r_decision 			-> r_no 						-> [vh path] r_plus_1 	->[hv path]r 	-- [hv path] lpprime.south west;
pk5 				-> [vh path] fk1 				-> [hv path] fk.north west ;
lpprime 			-> [vh path] fr1 				-> [hv path] fr.north west;
pk5 				-> [vh path] Qlpqk 				-> [hv path] fk.south west;
lpprime 			-> [vh path] fr3 				-> [hv path] fr.south west;
phi_end 			-> [bend right, dotted, thick] Plpqk;
phi_end 			-> [bend right, dotted, thick] Qlpqk;
pr4 				-> pprime 						->[hv path] lpprime.north west;
};
%%\node[rectangle, draw=GMVred!50, thick] (rect) at  

\end{tikzpicture}
\end{adjustbox}
\end{changemargin}
\caption{Workflow of the computation of $G_{lpq}$ through Kaula's approach.}
\label{tikz:Workflow_G_lpq_kaula}
\end{figure}