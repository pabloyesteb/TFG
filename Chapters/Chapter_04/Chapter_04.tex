\chapter{Perturbations: Non-spherical gravity.}
%
\label{chap:Chap_4}
%
\section{Introduction.}
%
\indent Up until now, every single orbit has been propagated under the assumption of unperturbed motion. This hypothesis is essentially flawed: not a single celestial system in the nature is \textit{exactly} a two body problem. \\
%
\indent However, most of said systems are really close two the two-body configuration, deviating from it due to small perturbations. Of course, there are exceptions for that, as for example an interplanetary transfer, in which by definition two primary bodies are, at least at some point, equally important. The wide variety of perturbations and its notorious effect when needing accurate results induces the development of theories that (a) model and implement said perturbations and (b) yield insightful knowledge about them. \\
%
\indent In any case, and for whatever theory that is formulated, one thing needs to be kept in mind: perturbation theories are built upon the assumption that perturbations remain small. The solutions that these theories may return are otherwise not valid nor useful \cite{Wiesel}. \\
%
\indent Of all the perturbations that may be considered in spacecraft motion, one of the most relevant is the deviation of the gravity field from that of a central body. This is usually referred to as non-spherical gravity (NSG), and the goal is to accurately model the mass distribution of the central body and hence the gravity field induced by it. An example of overall knowledge is the Earth's oblateness (\ie the Earth being flattened in its rotation direction). Although an oblate spheroid is usually a good enough approximation, the mathematical architecture behind some theories allows for a very accurate representation of the Earth's shape. This will undoubtedly improve the accuracy of the results. \\
%
\indent The implementation of a non-spherical gravity model can be approached as a raw computation of its value -- with a High-Fidelity propagation in mind -- or as a way to further understand its effects and obtain closed-form solutions. Though the former improves the truth model, it is the latter who yields more knowledge and fewer computational cost.\\
%
\indent This chapter intends to (a) provide an outlook on how to model perturbations in general through averaging methods and (b) focus on the non-spherical gravity field analysis and implementation. Its structure is outlined with that in mind, starting by analyzing which perturbations should be considered and introducing general averaging methods. That is followed by a general description of the non-spherical gravity field, which leads to the two main sections of the chapter. The first one is about mean and osculating elements: its definition, how they simplify orbit propagation and how they are actually calculated for the oblate Earth. The second one deals with Kaula's theory, which provides a different insight on the spherical harmonic formulation of the gravity field.
%
	\subsection{Relevant perturbations in spacecraft motion.}
	%
	\indent Figure \ref{figCh4:Pert_montenbruck}, remastered from Montenbruck \cite{Montenbruck}, provides a very visual and insightful idea about usually considered perturbations in Earth orbits, as a function of the orbital radius. Besides the obvious central body term ($GM$), which remains the biggest effect for every considered radius, Low Earth Orbits (LEO) are most notably affected by Earth's oblateness ($J_2$) and aerodynamic drag. Moving on to higher orbits, other perturbations may escalate in importance and in value, such as the third-body effects of the Moon and the Sun. It is important to note though that the nonlinear effect of the oblateness ($J_2^2$) still rises above other NSG first-order harmonics (such as $J_6$). However, other smaller effects such as the solar radiation pressure (SRP) or other third-bodies may need to be considered in higher orbits. Nonetheless, if the orbit scope is enlarged, the aforementioned terms may become relevant, such as in the case of interplanetary trajectories.\\
	%
	\indent The nature of SRP and drag makes them very body-dependent, in the sense that each body's surface, drag or reflective coefficient makes a huge difference in the disturbance. This fact becomes specially relevant when considering the relative motion of two different bodies, as the differential effect is what matters the most.
	%
	%
	\begin{figure}[!htb]
	\begin{changemargin}{-1.2cm}{0cm}
	\centering\includegraphics[width = 0.95\linewidth]{Chapters/Chapter_04/Pert_montenbruck}
	\end{changemargin}
	\caption{Order of magnitude of various perturbations of a satellite orbit. \cite{Montenbruck}}
	\label{figCh4:Pert_montenbruck}
	\end{figure}
	%
	\FloatBarrier
	%
	\indent For low altitude Earth-centered relative motion, non-spherical gravity and aerodynamic drag become the main concern. During this chapter, the spotlight will be put on the former, whose scientifical branch is known as satellite geodesy.
	%
	\subsection{Variational formulation of perturbed motion: Averaging methods.}\label{secCh4:Av_methods}
	%
	\indent Perturbed problems are usually nonlinear and initially unsolvable, meaning that no closed-form solution can be directly derived. Before figuring out how to approach this issue, it is necessary to consider the type of effects these perturbations lead to. Considering the periodicity, perturbations cause three types of alterations: 
	%
	\begin{itemize}
	\item[\GMVred{A.}] \myul[GMVred]{Secular}: Non-periodic effects, which generate a net variation over time. In other words, those which long-term average is non zero.
	%
	\item[\GMVred{B.}] \myul[GMVred]{Short-period}: Oscillations which feature a period equal or directly proportional to the fastest time-varying state variable. For example, in the case of a spacecraft, that variable may be the mean anomaly $M$.
	%
	\item[\GMVred{C.}] \myul[GMVred]{Long-period}: Periodic oscillations with a period considerably greater than that of the short-period effects. Their long-term average is still zero. In the case of celestial motion, this may be the argument of perigee $\omega$ or the ascending node $\Omega$.
	\end{itemize}	
	%
	\indent The facet one is usually more concerned about is the secular or mean motion. Taking the example of a drag-affected orbit, the final target is to get the long-term motion, rather than the short-term oscillations. These oscillations may nonetheless be important, as they might determine other aspects of the motion. \\
	%
	\indent In light of this, it would be interesting to separate the state variables into these three components, so as to analyse each by its own. Initially, one is faced with a problem expressed in instantaneous or osculating variables, which comprise all the motion components and are the ``real'' variables, in the sense that they can be measured and have a physical definition. The question now is, how can one go from these variables to the mean or averaged variables. This would lead to a closed-form, approximate solution of the original problem.\\
	%
	\indent The target is now to reach a transformation from osculating to mean elements and vice versa. These methods range from raw averaging of the equations, to more sophisticated and insightful theories. The latter will be the main topic of this section, as two of them will be presented. A practical application of them will be later discussed, while here a mere theoretical introduction is made.\\
	%
	\indent The two methods later described are based on a variational formulation, using concepts presented in appendix \ref{app:App_C}. They seek for arriving at successively higher order solutions of the unsolvable, perturbed problem starting from the solvable, unperturbed problem (solution of order 0). This is done by generating a differential problem in which the unknown (\ie the solution of order $n$) is expressed in terms of the lower order solutions (\ie the solutions of order $n-1, n-2, \ldots, 0$). In this way, increasingly accurate closed-form solutions are reached.\\
	%
	\indent A common trait among the two surveyed methods is that they are based on canonical transformations. These are used to find a phase space in which the problem becomes trivial, making the generating function the true solution (and sought variable) of the problem. The difference between the two approaches is how this generating function is formulated.
	%
		\subsubsection{Von Zeipel's method.}
		%
		\paragraph{\GMVred{I.} \myul[GMVred]{Problem statement.} \\}
		%
		\indent Von Zeipel's method is the oldest of the two surveyed methods, though its relevance cannot be underestimated. A more formal approach is presented by Nayfeh \cite{Nayfeh}, whereas the simplified viewpoint here developed is based on Wiesel \cite{Wiesel}. It starts with the Hamilton-Jacobi equation, which is expressed as:
		%
		\begin{equation}
		K(Q_i, P_i, t) = \left. H(q_i, p_i, t)\right\rvert_{Q_i, P_i} + \dfrac{\partial S}{\partial t}
		\end{equation}
		%
		\noindent where $H$ is the original Hamiltonian, $S$ is the generating function (or Hamilton principal function) and $K$ is the transformed Hamiltonian. $S$ is assumed to be of type 2, that is, $S = S(q_i, P_i, t)$. The original, perturbed Hamiltonian can be expressed as:
		%
		\begin{equation}
		H(q_i, p_i, t) = H_0(q_i, p_i) + \varepsilon H_1 (q_i, p_i, t)
		\label{eqCh4:H0H1}
		\end{equation}
		%
		\noindent where $H_0$ represents the solvable part of the problem, $H_1$ the perturbation part and $\varepsilon<<1$ a small parameter. The target is now to obtain the generating function $S$ that nullifies the new Hamiltonian $K$, that is:
		%
		\begin{equation}
		K(Q_i, P_i, t) = 0 = H\left( q_i, p_i = \dfrac{\partial S}{\partial q_i}, t\right) + \dfrac{\partial S}{\partial t}
		\label{eqCh4:K_0}
		\end{equation}
		%
		\paragraph{\GMVred{II.} \myul[GMVred]{Transformation.} \\}
		%
		\indent Von Zeipel assumes that the generating function $S$ can be expanded in powers of the parameter $\varepsilon$ as:
		%
		\begin{equation}
		S(q_i, P_i, t) = S_0(q_i, P_i, t) + \varepsilon S_1(q_i, P_i, t) + \dfrac{1}{2} \varepsilon^2 S_2(q_i, P_i, t) + \ldots
		\label{eqCh4:S}
		\end{equation}
		%
		\indent This formulation leads to the following form of the old momenta $p_i$:
		%
		\begin{equation}
		p_i =  \dfrac{\partial S}{\partial q_i} = \dfrac{\partial S_0}{\partial q_i} + \varepsilon \dfrac{\partial S_1}{\partial q_i} + \dfrac{1}{2} \varepsilon^2 \dfrac{\partial S_2}{\partial q_i} + \ldots
		\label{eqCh4:p_i}
		\end{equation}
		%
		\indent Inserting \eqref{eqCh4:p_i} into \eqref{eqCh4:K_0} leads to:
		%
		\begin{equation}
		K = 0  = H_0(q_i, \partial S/\partial q_i) + \varepsilon H_1(q_i, \partial S/\partial q_i) + \dfrac{\partial S}{\partial t}
		\label{eqCh4:K_0_exp}
		\end{equation}
		%
		\indent Equation \eqref{eqCh4:K_0_exp} features three terms which can be expanded in powers of $\varepsilon$ around $\partial S_0/\partial q_i$ through \eqref{eqCh4:p_i}:
		%
		\begin{itemize}
		\item[\GMVred{$\bullet$}] \myul[GMVred]{$H_0$}:
		%
		\begin{equation}
		\begin{array}{lll}
		H_0(q_i, \partial S/\partial q_i) & = H_0\left( q_i, \dfrac{\partial S_0}{\partial q_i} + \varepsilon \dfrac{\partial S_1}{\partial q_i} + \dfrac{1}{2} \varepsilon^2 \dfrac{\partial S_2}{\partial q_i} + \ldots \right) = H_0\left( q_i, \dfrac{\partial S_0}{\partial q_i} +\delta p_i\right) \\[1.2em]
			&  \approx H_0\left( q_i, \partial S_0/\partial q_i\right) + \dsum_{i} \dfrac{\partial H_0}{\partial p_i} \delta p_i + \dfrac{1}{2!} \dsum_i \dsum_j \dfrac{\partial^2 H_0}{\partial p_i \partial p_j} \delta p_i \delta p_j + \mathcal{O}(\varepsilon^3) 
		\end{array}	
		\label{eqCh4:H_0_exp}
		\end{equation}
		%
		\noindent where $\delta p_i = \varepsilon \dfrac{\partial S_1}{\partial q_i} + \dfrac{1}{2} \varepsilon^2 \dfrac{\partial S_2}{\partial q_i} + \mathcal{O}(\varepsilon^3)$. Substituting this into \eqref{eqCh4:H_0_exp} and retaining only elements up to second order in $\varepsilon$:
		%
		\begin{equation}
		\begin{array}{lll}
		H_0(q_i, \partial S/\partial q_i)  \approx H_0\left( q_i, \partial S_0/\partial q_i\right) + \dsum_{i} \dfrac{\partial H_0}{\partial p_i} \left(\varepsilon \dfrac{\partial S_1}{\partial q_i} + \dfrac{1}{2} \varepsilon^2 \dfrac{\partial S_2}{\partial q_i}\right)\\[1.2em]
		 + \dfrac{1}{2!} \dsum_i \dsum_j \dfrac{\partial^2 H_0}{\partial p_i \partial p_j} \varepsilon^2 \dfrac{\partial S_1}{\partial q_i}\dfrac{\partial S_1}{\partial q_j} + \mathcal{O}(\varepsilon^3)
		\end{array}
		\label{eqCh4:H_0_exp_final}
		\end{equation}
		%
		\item[\GMVred{$\bullet$}]\myul[GMVred]{$H_1$}: In an analogue manner to $H_0$, and considering that this factor is already of order $\varepsilon$:
		%
		\begin{equation}
		\varepsilon H_1(q_i, \partial S /\partial q_i ) = \varepsilon H_1\left( q_i, \dfrac{\partial S_0}{\partial q_i}\right) + \varepsilon^2 \dsum_{i} \dfrac{\partial H_1}{\partial p_i} \dfrac{\partial S_1}{\partial q_i} + \mathcal{O}(\varepsilon^3)
		\label{eqCh4:H_1_exp_final}
		\end{equation}
		%
		\item[\GMVred{$\bullet$}]\myul[GMVred]{$\partial S/\partial t$}: Simply substituting \eqref{eqCh4:S} yields:
		%
		\begin{equation}
		\dfrac{\partial S}{\partial t} \approx \dfrac{\partial S_0}{\partial t} + \varepsilon \dfrac{\partial S_1}{\partial t} + \dfrac{1}{2} \varepsilon^2 \dfrac{\partial S_2}{\partial t}
		\label{eqCh4:S_t}
		\end{equation}
		%
		\end{itemize}
		%
		\paragraph{\GMVred{III.} \myul[GMVred]{Substitution in Hamilton-Jacobi equation.} \\}
		%
		\indent If one is to substitute equations \eqref{eqCh4:H_0_exp_final}, \eqref{eqCh4:H_1_exp_final} and \eqref{eqCh4:S_t} into \eqref{eqCh4:K_0_exp}, a quite cumbersome expression arises. Nonetheless, applying the uniqueness of the coefficients of the $\varepsilon$ expansion, a separate PDE for each order of can be reached. In particular:
		%
		\begin{alignat}{4}[left = \empheqlbrace]
		\label{eqCh4:eps_0}\varepsilon^0 : & H_0\left( q_i, \partial S_0/\partial q_i\right) + \dfrac{\partial S_0}{\partial t} = 0 \\
		\label{eqCh4:eps_1}\varepsilon^1 : & \dsum_{i} \dfrac{\partial H_0}{\partial p_i} \dfrac{\partial S_1}{\partial q_i} + H_1\left( q_i, \dfrac{\partial S_0}{\partial q_i}\right) + \dfrac{\partial S_1}{\partial t} = 0 \\
		\nonumber \varepsilon^2 : 	& \dfrac{1}{2}\dsum_{i} \dfrac{\partial H_0}{\partial p_i} \dfrac{\partial S_2}{\partial q_i} + \\
		 							& \label{eqCh4:eps_2} \dfrac{1}{2!} \dsum_i \dsum_j \dfrac{\partial^2 H_0}{\partial p_i \partial p_j} \dfrac{\partial S_1}{\partial q_i}\dfrac{\partial S_1}{\partial q_j} + H_2\left( q_i, \dfrac{\partial S_0}{\partial q_i}\right) + \dfrac{\partial S_2}{\partial t} = 0 
		\end{alignat}
		%
		\indent Equation \eqref{eqCh4:eps_0} is the unperturbed, solvable problem, whose solution is reached by solving for $S_0$ in the PDE. $S_0$ provides the zeroth-order transformation $(p_i, q_i) \to (P_i, Q_i)$, hence the old variables in terms of the new. Once this is done, the first order problem \eqref{eqCh4:eps_1} can be tackled, where again a PDE in terms of $S_1$ is to be solved. This will lead to a first-order approximation of the perturbed problem, which is in turn substituted in \eqref{eqCh4:eps_2} to find the second-order solution. This is then a recursive scheme, in which increasingly higher order approximations are derived.\\
		%
		\paragraph{Remarks. \\}
		%
		\indent The described approach is based on the Hamilton-Jacobi equation, which seeks to find a state space in which the solution of the dynamics is trivial. The solution process consists of attaining increasingly better approximations of the generating function that simplifies the original dynamics. \\
		%
		\indent Nonetheless, a somewhat different approach is to choose the generating function $S$ in a way that it simplifies the problem in other ways. For example, if one wishes to just analyse the mean evolution of the system, choosing $S$ such that it cancels the periodic terms in the Hamiltonian is a possible approach. The new Hamiltonian will be (by choice) non-zero. This will be discussed in more detail later, in a particularization of the perturbed two-body problem.
		%
		\subsubsection{Lie series method.}
		%
		\indent Von Zeipel's method features a considerable disadvantage: the independent variables of the generating function $S$ are a mix of the old and the new generalized coordinates and momenta. Hori \cite{Hori} and Deprit \cite{Deprit, Deprit_2} develop more sophisticated methods relying on the Lie theorem and Lie series expansions. The general Lie series method is explained in \cite{Nayfeh}, specifying every detail of its mathematical grounds. This theory will not be implemented throughout this thesis. Nevertheless, a brief introduction is made, so as to have a starting point for future work. In particular, Hori's approach will be introduced \cite{SCFormationFlying}.
		%
		\paragraph{Hori's method. \\}
		%
		\indent This approach starts by imposing that the generating function $W$ depends only on the new generalized coordinates and momenta. Expanding said function until first order:
		%
		\begin{equation}
		W(Q_i, P_i) = W_1(Q_i, P_i) + \varepsilon W_2(Q_i, P_i) + \mathcal{O}(\varepsilon^3)
		\label{eqCh4:Hori_W}
		\end{equation}
		%
		\indent The modified Hamiltonian $K$ is expanded up to second order in $\varepsilon$ so that:
		%
		\begin{equation}
		K(Q_i, P_i) = K_0(Q_i, P_i) + \varepsilon K_1 (Q_i, P_i) + \dfrac{1}{2} \varepsilon^2 K_2 (Q_i, P_i) + \ldots
		\label{eqCh4:Hori_K}
		\end{equation}
		%
		\indent On the other hand, the original Hamiltonian is defined as:
		%
		\begin{equation}
		H(q_i, p_i) = H_0(q_i, p_i) + \varepsilon H_1 (q_i, p_i)
		\label{eqCh4:Hori_H}
		\end{equation}
		%
		\indent Up until here, the only difference with respect to Von Zeipel's method is that the generating function depends only on the new variables. It is now where the main procedural difference appears, as the Lie theorem is applied, which states that:
		%
		\begin{equation}
		H(q_i, p_i) = H(Q_i, P_i) + \varepsilon \left[ H(Q_i, P_i), W\right] + \dfrac{1}{2} \varepsilon^2 \left[ \left[ H(Q_i, P_i), W \right], W \right] + \mathcal{O} (\varepsilon^3)
		\label{eqCh4:Lie_theorem}
		\end{equation}
		%
		\noindent where $[\bullet, \bullet]$ represents the Poisson bracket. Substituting \eqref{eqCh4:Hori_H} and \eqref{eqCh4:Hori_W} into \eqref{eqCh4:Lie_theorem}:
		%
		\begin{alignat}{4}
		& \nonumber \bullet \varepsilon \left[ H, W \right] = \varepsilon \left[ H_0 + \varepsilon H_1, W_1 + \varepsilon W_2 \right] = \varepsilon \left[ H_0, W_1 \right] + \varepsilon^2 \left( \left[ H_0, W_2 \right] + \left[ H_1, W_1 \right] \right) + \mathcal{O}(\varepsilon^3) \\
		& \nonumber \bullet \dfrac{1}{2}\varepsilon^2 \left[ \left[ H, W \right] W\right] = \dfrac{1}{2} \varepsilon^2 \left[ \left[ H_0, W_1 \right], W_1 \right] + \mathcal{O}(\varepsilon^3)
		\end{alignat}
		%
		\indent The original Hamiltonian hence becomes:
		%
		\begin{equation}
		H(q_i, p_i) = H_0(Q_i, P_i) + \varepsilon \left( H_1(Q_i, P_i) + \left[ H_0, W_1 \right]\right) + \varepsilon^2 \left(  \left[ H_0, W_2 \right] + \left[ H_1, W_1 \right] + \dfrac{1}{2}\left[ \left[ H_0, W_1 \right], W_1 \right]\right)
		\label{eqCh4:Original_ham}
		\end{equation}
		%
		\indent Additionally, Hamilton-Jacobi equation states that:
		%
		\[
		K(Q_i, P_i) = H(q_i, p_i)
		\]
		%
		\indent Considering \eqref{eqCh4:Original_ham} and \eqref{eqCh4:Hori_K}, and by virtue of the uniqueness of the coefficients of the expansion, one equation can be stated for each order of $\varepsilon$, that is:
		\begin{alignat}{4}[left = \empheqlbrace]
		\label{eqCh4:Hori_eps_0}\varepsilon^0 : & K_0(Q_i, P_i) = H_0(Q_i, P_i) \\
		\label{eqCh4:Hori_eps_1}\varepsilon^1 : & K_1(Q_i, P_i) = H_1(Q_i, P_i) + \left[ H_0, W_1 \right] \\
		\label{eqCh4:Hori_eps_2}\varepsilon^2 : & K_2(Q_i, P_i) = \left[ H_0, W_2 \right] + \left[ H_1, W_1 \right] + \dfrac{1}{2} \left[ \left[ H_0, W_1 \right], W_1\right]
		\end{alignat}
		%
		\indent Equation \eqref{eqCh4:Hori_eps_0} can be understood as ``go solve the unperturbed problem'', which in principle should be straightaway (as for the two-body problem). The first order differential equation \eqref{eqCh4:Hori_eps_1} can be solved in different ways, as it has two unknowns ($W_1$ and $K_1$). In general, the first order modified Hamiltonian is selected to have a certain value or expression, and then the generating function is obtained. A quite common approach is to make $K_1$ to comprise just the secular part of the perturbations $H_1$, making $W_1$ absorb the periodic part. For higher order equations, the procedure is similar: choose $K_i$ and solve for $W_i$.
		%
\section{Non-spherical gravity: General concepts.}
%
\indent As shown in figure \ref{figCh4:Pert_montenbruck}, the asphericity of the Earth induces some perturbations on the easily solved two-body problem. Many theories have been developed for the treatment of Earth's oblateness ($J_2$), due to its dominance over the effect of the rest of the irregularities. However, when a more accurate result is needed, a higher-fidelity Earth model has to be implemented. These theories can be later implemented in spacecraft dynamics models or, in particular, STMs, such as in \cite{GA_STM} or \cite{Chihabi}. \\
%
\indent In this section, classical theories for $J_2$ effects will be first described, all based in Brouwer's theory \cite{Brouwer_paper}. Later on, a promising approach full for non-spherical gravity field description is detailed. Implementation and validation of both theories will also be performed, as the final target is to use them in a dynamics model.
%
\section{$J_2$ effect analysis.}
	\subsection{Mean and osculating elements}\label{secCh4:mean2osc}
	%
	\indent As introduced in \ref{secCh4:Av_methods}, the mean motion is usually the most important component of the full motion. A very important advantage of the mean element space is that the variational equations become very simple, as only long-term effects are taken into account. The problem is how to convert the variational equations in instantaneous/osculating variables into a mean element counterpart. \\
	%
	\indent This is where mean to osculating transformations arise. They can be either obtained by pure averaging or through some kind of transformation. During this section, an example of the latter will be developed, based on the Von Zeipel's method and applied to the $J_2$-perturbed two-body problem. It is commonly referred to as Brouwer's Theory, in reference to its author Dirk Brouwer \cite{Brouwer_paper}. An extensive survey on this exact topic can be found in Gaias et al. \cite{Gaias_mean2osc}, where several classical and state-of-the-art methods (including the one here described) are presented and compared against each other. \\
	%
	\subsection{Brouwer's theory.}
	%
	\indent Brouwer's theory seeks a closed-form of the $J_2$-perturbed motion of a spacecraft, applying Von Zeipel's method for that purpose. This approach starts by formulating the equations of motion of the spacecraft in a favorable form (\ie in Delaunay elements). The resulting differential problem can be reshaped through canonical transformations until the mean elements and secular equations of motion are reached. These can be easily integrated, after which an inverse transformation (\ie mean to osculating) can be performed, so as to get the actual motion of the spacecraft. \\
	%
	\indent Once this general results are outlined, the Lyddane modification \cite{Lyddane} for near zero eccentricities and inclination angles will be introduced. Finally, a quick validation test is performed.
	%	
		\subsubsection{Grounds: Brouwer's theory outline.}
		%
		\paragraph{\GMVred{I.} \myul[GMVred]{Modification of the Hamiltonian $\bm F$.} \\}
		%
		\indent As shown in section \ref{secAppE:LPE}, the variational equations of the motion of a spacecraft in Delaunay variables are:
		%
		\begin{equation}
		\left\{ \begin{array}{ccc}
		\dfrac{dL}{dt} = \dfrac{\partial F}{\partial l}\; , \qquad \dfrac{dl}{dt} = - \dfrac{\partial F}{\partial L} \\[1.2em]
		\dfrac{dG}{dt} = \dfrac{\partial F}{\partial g}\; , \qquad \dfrac{dl}{dt} = - \dfrac{\partial F}{\partial G} \\[1.2em]
		\dfrac{dH}{dt} = \dfrac{\partial F}{\partial h}\; , \qquad \dfrac{dl}{dt} = - \dfrac{\partial F}{\partial h}
		\end{array}\right. 
		\label{eqCh4:LPE_DOE}
		\end{equation}
		%
		\noindent where $(L, G, H, l, g, h)$ is the set of Delaunay elements (see section \ref{secAppA:Delaunay}) and $F$ is the Hamiltonian function, denoted that way to avoid confusion with the third Delaunay element. For a $J_2$ perturbed orbit, the Hamiltonian is expressed as:
		%
		\begin{equation}
		F = \dfrac{\mu^2}{2L^2} + \dfrac{\mu^4 a_e^2 J_2}{L^6} \left[ \left(-\dfrac{1}{2} + \dfrac{3}{2} \dfrac{H^2}{G^2}\right) \dfrac{a^3}{r^3} + \left( \dfrac{3}{2} - \dfrac{3}{2} \dfrac{H^2}{G^2}\right) \dfrac{a^3}{r^3} \cos(2g + 2\theta)\right]
		\end{equation}
		%
		\indent One obvious change to arrive to a closed-form solution is to achieve a right-hand side of \eqref{eqCh4:LPE_DOE} which only depends on the Delaunay variables. That leads to the need of expressing $(a/r)^3$ and $\cos (2g+ 2\theta)$ in terms of $L, G, H, l, g, h$. This is done through elliptic motion expansions, using Fourier series in terms of the mean anomaly $l$, that is:
		%
		\[
		\left\{ \begin{array}{ll}
		\dfrac{a^3}{r^3} = \dfrac{L^3}{G^3} + \dsum_{j = 1}^{\infty} 2 P_j \cos jl \equiv \dfrac{L^3}{G^3} + \sigma_1 \\
		\dfrac{a^3}{r^3} \cos(2g + 2\theta) = \dsum_{j = -\infty}^{\infty} Q_j \cos(2g + jl)  \equiv \sigma_2 
		\end{array}\right.
		\]
		%
		\indent Additionally, defining:
		%
		\[
		\begin{array}{ll}
		A = -\dfrac{1}{2} + \dfrac{3}{2} \dfrac{H^2}{G^2}\\[1.2em]
		B = \dfrac{3}{2} - \dfrac{3}{2} \dfrac{H^2}{G^2}
		\end{array}
		\]
		%
		\noindent the Hamiltonian becomes:
		%
		\begin{equation}
		F = \dfrac{\mu^2}{2L^2} + \dfrac{\mu^4 a_e^2 J_2}{L^6} \left[ A \left(\dfrac{L^3}{G^3} + \sigma_1\right) + B\sigma_2\right] = F(L, G, H, l, g, -)
		\end{equation}
		%
		\noindent where the $-$ emphasizes the absence of $h$ in the Hamiltonian.
		%
		\paragraph{\GMVred{II.} \myul[GMVred]{Von Zeipel's method application.} \\}
		%
		\indent The Hamiltonian function is now better suited for a canonical transformation, which through the removal of variables from the Hamiltonian will simplify the solution process. In this respect, Hamilton-Jacobi equation can be leveraged in two ways:
		%
		\begin{itemize}
		\item[\GMVred{A.}] Choose the generating function so that only $L', G', H'$ appear on the Hamiltonian, leading to a simple solution.
		%
		\item[\GMVred{B.}] Choose the generating function otherwise, tailoring the Hamiltonian rather than just simplifying it.
		\end{itemize}
		%
		\indent The approach followed by Brouwer consists on first getting rid of the mean anomaly $l$, hence of the short-period effects, to then eliminate the argument of perigee $g$ and remove the long-period effects with it. The Von Zeipel's method will be used for this purpose.\\
		%
		\indent The first step is to identify the solvable and the perturbation part of the original Hamiltonian accordingly to \eqref{eqCh4:H0H1}:
		%
		\begin{equation}
		\left\{\begin{array}{ll}
		\nonumber H_0 & = \dfrac{\mu^2}{2 L^2} \\[1.2em]
		\nonumber H_1  & = \dfrac{\mu^4 a_e^2 J_2}{L^6} \left[ A \left(\dfrac{L^3}{G^3} + \sigma_1\right) + B\sigma_2\right]
		\end{array}\right.
		\label{eqCh4:H0H1_V500}
		\end{equation}
		%
		\noindent where the small parameter $\varepsilon$ has been merged into $H_1$.
		%
		\subparagraph{\GMVred{II.A.} \myul[GMVred]{Short-period effects removal.} \\}
		%
		\indent The transformation function is expanded again as:
		%
		\[
		S = S_0 + S_1 + S_2 + \ldots
		\]
		%
		\indent From now on, the subindex of each function denotes its order in $\varepsilon$. In order to transform the problem into the two-body space and remove the mean anomaly from the Hamiltonian, the zeroth-order factor of the generating function $S_0$ is chosen to be:
		%
		\[
		S_0 \equiv L' l + G' g + H' h
		\]
		%
		\indent The Hamilton-Jacobi equation becomes:
		%
		\begin{equation}
		K(L', G', H', -, g', -) = F(L, G, H, l, g, -)
		\label{eqCh4:K_F}
		\end{equation}
		%
		\indent Substituting the original Hamiltonian $F = H_0 + H_1$ and expanding the new one up to second order, equation \eqref{eqCh4:K_F} becomes:
		%
		\begin{equation}
		\begin{array}{ll}
		K_0 + K_1\left(L', G', H', -, \dfrac{\partial S}{\partial G'}, -\right) + K_2\left(L', G', H', -, \dfrac{\partial S}{\partial G'}, -\right) = \\[1.2em]
		H_0\left(\dfrac{\partial S}{\partial L} \right) + H_1\left( \dfrac{\partial S}{\partial l}, \dfrac{\partial S}{\partial g}, \dfrac{\partial S}{\partial h}, l, g, - \right)
		\end{array}
		\end{equation}
		%
		\indent Expanding up to the second power of $\varepsilon = J_2 a_e^2$:
		%
		\begin{equation}
		\begin{array}{cc}
		K_0 + K_1\left(L', G', H', -, g, -\right) + \dfrac{\partial K_1}{\partial g} \dfrac{\partial S_1}{\partial G'} + K_2\left(L', G', H', -, g, -\right) = \\[1.2em]
		H_0\left(L' \right) +\dfrac{\partial H_0}{\partial L'} \dfrac{\partial S_1}{\partial l} + \dfrac{\partial H_0}{\partial L'}\dfrac{\partial S_2}{\partial l} + \dfrac{1}{2} \dfrac{\partial^2 H_0}{\partial L'^2} \left( \dfrac{\partial S_1}{\partial l} \right)^2 + H_1\left( L', G', H', l, g, - \right) + \\[1em]
		 \dfrac{\partial H_1}{\partial L'} \dfrac{\partial S_1}{\partial l} + \dfrac{\partial H_1}{\partial G'}\dfrac{\partial S_1}{\partial g}
		\end{array}
		\end{equation}
		%
		\indent It is possible to associate elements of corresponding order in either side of the equation, by considering that each term's order is equal to the sum of the subindices of each factor.  With this in mind:
		%
		\begin{alignat}{4}[left = \empheqlbrace]
		\label{eqCh4:eps_0_brouwer}\varepsilon^0 : & K_0(L') && =  H_0(L')  \\
		\label{eqCh4:eps_1_brouwer}\varepsilon^1 : & K_1 && =  H_1 + \dfrac{\partial H_0}{\partial L'} \dfrac{\partial S_1}{\partial l} \\
		\label{eqCh4:eps_2_brouwer}\varepsilon^2 : 	& K_2 + \dfrac{\partial K_1}{ \partial g} \dfrac{\partial S_1}{\partial G'} &&=  \dfrac{\partial H_0}{\partial L'} \dfrac{\partial S_2}{\partial l} +  \dfrac{1}{2} \dfrac{\partial^2 H_0}{\partial L'^2} \left( \dfrac{\partial S_1}{\partial l} \right)^2 + \dfrac{\partial H_1}{\partial L'} \dfrac{\partial S_1}{\partial l} + \dfrac{\partial H_1}{\partial G'}\dfrac{\partial S_1}{\partial g}
		\end{alignat}
		%
		\indent This expansion could be carried out indefinitely, although it will be restricted to the zeroth and first-order PDEs. It is now when one can get rid of the short-period terms of the first-order original Hamiltonian, by separating it into the secular and the short-periodic part, \ie :
		%
		\[
		H_1 = H_{1s} + H_{1p}
		\]
		%
		\indent where $H_{1s}$ and $H_{1p}$ can be expressed as:
		%
		\begin{equation}	
		\left\{
		\begin{array}{ll}
		H_{1s} = \dfrac{\mu^4 a_e^2 J_2}{L^3 G^3} A \\[1.2em]
		H_{1p} = \dfrac{\mu^4 a_e^2 J_2}{L^6} \left( A\sigma_1 + B \sigma_2 \right)
		\end{array}\right.
		\label{eqCh4:H1sH1p}
		\end{equation}
		%
		\indent Substituting \eqref{eqCh4:H1sH1p} into \eqref{eqCh4:eps_1_brouwer} splits it into two:
		%
		\begin{equation}
		\left\{
		\begin{array}{ll}
		\dfrac{\partial S_1}{\partial l}= \dfrac{\mu^2 a_e^2 J_2}{L'^3} \left( A\sigma_1 + B \sigma_2 \right) \\[1.2em]
		K_{1p} = \dfrac{\mu^4 a_e^2 J_2}{L'^3 G'^3} A
		\end{array}\right.
		\label{eqCh4:H1sH1p_2}
		\end{equation}
		%
		\indent After some mathematical manipulations, the final form of $S_1$ can be expressed as:
		%
		\begin{equation}
		S_1 = \dfrac{\mu^2 a_e^2 J_2}{G'^3} \left\{ A \left(\theta - l + e\sin \theta\right) + B\left[\dfrac{1}{2}\sin(2g + 2\theta) + \dfrac{e}{2} \sin(2g + \theta) + \dfrac{e}{6} \sin(2g + 3\theta)\right]\right\}
		\end{equation}
		%
		\indent And finally, the conversion between the long-period and secular motion set $L', G', H', l', g', h'$ and the full osculating set $L, G, H, l, g, h$ can be expressed as:
		%
		\begin{equation}
		\left\{
		\begin{array}{cc}
		L = L' + \dfrac{\partial S_1}{\partial l} 	& l = l' - \dfrac{\partial S_1}{\partial L'}\\[1.2em]
		G = G' + \dfrac{\partial S_1}{\partial g} 	& g = g' - \dfrac{\partial S_1}{\partial G'}\\[1.2em]
		H = H' 										& h = h' - \dfrac{\partial S_1}{\partial H'}
		\end{array}\right.
		\label{eqCh4:rid_SP}
		\end{equation}
		%
		\indent Second-order effects are specified in section 4. of Brouwer \cite{Brouwer}. 
		%
		\subparagraph{\GMVred{II.B.} \myul[GMVred]{Long-period effects removal.} \\}
		% 
		\indent In an analogue manner to what was done before, a further canonical transformation can be performed over the prime set ($L', G', H', l', g', h'$). The new generating function will be:
		%
		\[
		\tilde{S} = L'' l' + G'' g' + H'' h' + \tilde{S}_1 (L'', G'', H'', -, g', -)
		\]
		%
		\noindent where the target now is to obtain the function $\tilde{S}_1$ for which $L'', G'', H'', l'', g'', h''$ do not contain any periodic term. After a very similar process to the one performed before, the function $\tilde{S}_1$ results:
		%
		\begin{equation}
		\tilde{S}_1 = G'' \gamma_2 \left(\dfrac{L'^2}{G''^2} - \dfrac{L'^4}{G''^4}\right) \left[ \dfrac{1}{16} \left(1 - 11 \dfrac{H^2}{G''^2}\right) - \dfrac{5}{2} \dfrac{H^4}{G''^4} \left(1 - 5 \dfrac{H^2}{G''^2}\right)^{-1} \right] \sin 2g''
		\end{equation}
		%
		\noindent where $\gamma_2 = \dfrac{\mu^2 a_e^2 J_2}{L'^4}$. The new mean element set results:
		%
		\begin{equation}
		\left\{
		\begin{array}{cc}
		L' = L''												& l' = l'' - \dfrac{\partial \tilde{S}_1}{\partial L'}\\[1.2em]
		G' = G'' + \dfrac{\partial \tilde{S}_1}{\partial g'} 	& g = g' - \dfrac{\partial \tilde{S}_1}{\partial G''}\\[1.2em]
		H' = H'' = H 											& h = h' - \dfrac{\partial \tilde{S}_1}{\partial H}
		\end{array}
		\right.
		\label{eqCh4:rid_LP}
		\end{equation}
		%
		\paragraph{\GMVred{III.} \myul[GMVred]{Variational equations for mean element set.} \\}
		%
		\indent Finally, the variational equations for this mean element set are:
		%
		\begin{equation}
		\left\{ \begin{array}{ccc}
		\dfrac{dL''}{dt} = 0\; , \qquad \dfrac{dl''}{dt} = - \dfrac{\partial \tilde{K}}{\partial L} \\[1.2em]
		\dfrac{dG''}{dt} = 0\; , \qquad \dfrac{dl}{dt} = - \dfrac{\partial \tilde{K}}{\partial G} \\[1.2em]
		\dfrac{dH''}{dt} = 0\; , \qquad \dfrac{dl}{dt} = - \dfrac{\partial \tilde{K}}{\partial h}
		\end{array}\right. 
		\label{eqCh4:LPE_DOE_mean}
		\end{equation}
		%
		\noindent where $\tilde{K}$ is the new modified Hamiltonian. The exact equations can be seen again in Brouwer, eqs. 39-41.
		%
		\paragraph{\GMVred{IV.} \myul[GMVred]{Final mean to osculating relations. } \\}
		%
		\indent The concatenation of transformations \eqref{eqCh4:rid_SP} and \eqref{eqCh4:rid_LP} lead to some cumbersome expressions, which for the sake of tidiness, are here only quoted: they are present in Brouwer \cite{Brouwer}, section 9.  
		%
		\subsubsection{Lyddane approximation.}
		%
		\indent Brouwer's theory, though groundbreaking at the time, featured singularities. Besides the uncommon case of critical inclination (which does not need to be solved), the equations become singular null eccentricities or inclination angles. Lyddane \cite{Lyddane} tackled this singularities and gets rid of them by using Poincar\'{e} variables instead of the Delaunay set. The actual formulas for the mean to osculating transformation are quoted in the next section.
		%
		\subsubsection{Results: Transformations.}
		%
		\indent Schaub and Junkins \cite{Schaub_Junkins} provide the mathematical formulae derived from Brouwer's theory with Lyddane's modification in its appendix G. An important thing to keep in mind is that, as it is a first-order mapping, the direct (\ie mean to osculating) and inverse (\ie osculating to mean) transformations just differ by a sign, contained in the small parameter $\gamma_2'$:
		%
		\[ \gamma_2' = \pm \dfrac{J_2}{2 \eta^4}\left( \dfrac{a_e}{a} \right)^2 \]
		%
		\indent Said expressions will later be validated. 
		%
		%
	%
	\subsection{STM approach.}
	%
	\indent Brouwer's theory by itself is a powerful tool. Nonetheless, it has enabled the development of many derived theories. The STM developed by Gim and Alfriend \cite{GA_STM} is a good example of this. It actually uses a linearization of the Lyddane's modification of Brouwer's theory, as its sole purpose is to build an STM (linear by definition). An important difference with respect to the original Lyddane's modification shown in \cite{Schaub_Junkins} is that effects are separated in long and short period, which can in turn be used to validate other theories. Additionally, quasi-nonsingular elements are used instead of the Keplerian.\\
	%
	\indent A brief description on the approach followed by these authors is found in section \ref{secCh5:GA_STM}, where an emphasis is made on the linearised mean to osculating transformations.
	%	
	\subsection{Validation.}
	%
	\indent Once the selected methods have been presented, it is time for validating their implementation. In this respect, the two surveyed methods are:
	%
	\begin{itemize}
	\item[\GMVred{A.}] \myul[GMVred]{Lyddane's modification of Brouwer's theory}: Explicit relation between mean and osculating elements, expressed in Keplerian OEs, and that can be inverted by merely changing the sign of the factor $\gamma_2$. All the relations are shown in \cite{Schaub_Junkins}, appendix G, and this approach will be referred to as the Brouwer-Lyddane (BL) method.
	%
	\item[\GMVred{B.}] \myul[GMVred]{Gim-Alfriend's interpretation of Brouwer's theory}: Framed in the Gim-Alfriend STM paper, it is expressed in quasi-nonsingular elements, and approaches each of the individual effects separately (short/long period) through an alternative interpretation of Brouwer's theory. The inverse transformation is performed iteratively. This will be referred to as the Gim-Alfriend (GA) transformation, and its practical implementation is discussed in section \ref{secCh5:GA_STM}.
	\end{itemize}
	%
	\indent The first validation test will be performed against the provided mean-osculating conversion by Alfriend et al. \cite[][section 3.4]{SCFormationFlying}. Once both formulations have been proven to match the benchmark, the subdivided transformation will be tested against a High-Fidelity propagator, involving also the propagation of the mean elements. 
	%
		\subsubsection{Mean to osculating functions: Brouwer-Lyddane and GA vs truth.}
		%
		\indent The target is to validate both the direct and inverse transformations through the two different methods (BL and GA). The \textit{truth} is obtained from example 3.1. of reference \cite{SCFormationFlying}, which is expressed in quasi-nonsingular OEs:
		%
		\begin{equation}
		\text{Truth} \left\{ \begin{array}{ll}
		\text{Mean} \quad \underline{\overline{OE}} & \left\{\begin{array}{ccc}
		\overline{a} = 7100 \; km 	& \overline{u} = 0 \; rad 	& \overline{i} 		= 70 \; \deg 	\\
		\overline{q}_1 = 0.05		& \overline{q}_2 = 0.05  	& \overline{\Omega} = 45 \; \deg 	\\  
		\end{array}\right. \\
		\text{Osc.} \quad \underline{OE} & \left\{\begin{array}{ccc}
		a = 7109.31795 \; km 	& u = 0.00005 \; rad 	& i 		= 1.22196 \; rad 	\\
		q_1 = 0.05063		& q_2 = 0.05003  	& \Omega = 0.78547 \; rad 	\\  
		\end{array}\right.
		\end{array}\right.
		\label{eqCh4:Scenarios_m2o}
		\end{equation}
		%
		\indent Table \ref{tabCh4:GA_SJ} shows the mentioned results, expressing the difference between the obtained sets and the truth.
		%
		\begin{table}[!htb]
		\begin{center}
		\begin{changemargin}{-1.2cm}{0cm}
		\begin{tabular}{|a|a|c|c|c|c|c|c|}
		\hline 
		\textbf{Method} & \textbf{Transf.} & $\bm{\delta a}$ [m] & $\bm{\delta q_1}$ [--] & $\bm{\delta q_2}$[--] & $\bm{\delta i}$ [rad] & $\bm{\delta \Omega}$[rad] & $\bm{\delta u}$[rad] \\ 
		\hline 
		& Direct & 8.4138$ \cdot 10^{-2}$  & 5.5785$ \cdot 10^{-6}$ &  1.7288$ \cdot 10^{-6}$ &  2.6111$ \cdot 10^{-6}$  & 2.7143$ \cdot 10^{-6}$ &  1.5803$ \cdot 10^{-5}$ \\ 
		\cline{2-8}
		 \multirow{-2}{*}{BL}& Inverse & 4.0796  & 6.1613$ \cdot 10^{-6}$  & 1.7465$ \cdot 10^{-6}$  & 3.1437$ \cdot 10^{-6}$ &  1.1636$ \cdot 10^{-6}$ &  1.5006$ \cdot 10^{-5}$ \\ 
		\hline 
		 & Direct & 8.3737$ \cdot 10^{-2}$  & 9.1123$ \cdot 10^{-5}$  & 8.3773$ \cdot 10^{-5}$ &  2.6235$ \cdot 10^{-6}$ &  2.8420$ \cdot 10^{-3}$ & 1.7263$ \cdot 10^{-3}$ \\ 
		\cline{2-8}
		\multirow{-2}{*}{GA}& Inverse & 1.6106$ \cdot 10^{-1}$  & 9.0807$ \cdot 10^{-5}$ &  8.1354$ \cdot 10^{-5}$ &  2.5994$ \cdot 10^{-6}$  & 2.8429$ \cdot 10^{-3}$  & 1.7263$ \cdot 10^{-3}$ \\ 
		\hline 
		\end{tabular}
		\end{changemargin}
		\caption{Results of the mean to osculating transformation for both surveyed methods.}
		\label{tabCh4:GA_SJ} 
		\end{center}
		\end{table}
%		%
%		\indent Although both theories should in principle lead to the same results, the Brouwer-Lyddane approach yields a considerably better accuracy. This is particularly visible in the true argument of latitude $u$. The reason for this might 
		\subsubsection{Comparison against High-Fidelity propagation.}\label{secCh4:BL_vs_HiFi}
		%
		\indent A very useful way to leverage the mean to osculating theory is to propagate the variational equations in mean elements, retaining only the secular terms. The truth benchmark will be a High-Fidelity cartesian propagator (see appendix \ref{app:App_D}), although alternatively, it could be the direct integration of the Gauss Variational Equations with $J_2$ effect in osculating elements. The required inputs for this test are only the chief's reference orbit at $t = t_0$ and the usual propagation parameters (number of orbits, propagation method \ldots). The reference orbit is defined by the previous test, using the true values of the osculating quasi-nonsingular elements, and the orbit will be propagated along ten full revolutions.\\
		%
		%
		\indent Before showing the results, it is necessary to sketch out the propagation through the mean to osculating transformation. This procedure is performed following the next steps:
		%
		\begin{itemize}
		\item[\GMVred{\nth{1}}] Convert the osculating elements (\ie the reference orbit) to mean elements. 
		%
		\item[\GMVred{\nth{2}}] Propagate the mean elements.
		%
		\item[\GMVred{\nth{3}}] Back-convert the mean elements to osculating.  
		\end{itemize}
		%
		\indent It is insightful to now show the variational equations expressed in mean elements, which include the secular rates only (as it was expected). These equations for the Keplerian OEs are \cite{GA_STM}:
		\begin{equation}
		\left\{ \begin{array}{llll}
		\dfrac{da^{(s)}}{dt} 		& = 0 \\[1.2 em]
		\dfrac{de^{(s)}}{dt} 		& = 0 \\[1.2 em]
		\dfrac{di^{(s)}}{dt} 		& = 0 \\[1.2 em]
		\dfrac{d\Omega^{(s)}}{dt} 	& = -\dfrac{3}{2} \dfrac{J_2 a_e^2 n }{a^2 \eta^4} \cos i\\[1.2 em]
		\dfrac{d\omega^{(s)}}{dt} 	& =  \dfrac{3}{4} \dfrac{J_2 a_e^2 n }{a^2 \eta^4} \left( 5\cos^2 i - 1 \right) \\[1.2 em]
		\dfrac{dM^{(s)}}{dt}		& = n + \dfrac{3}{4} \dfrac{J_2 a_e^2 n }{a^2 \eta^3} \left( 3\cos^2 i - 1 \right)
		\end{array}\right.
		\label{eq:J2_mean_prop}
		\end{equation}
		%
		\indent Figure \ref{figCh4:M20_vs_HiFi} shows the evolution of the Keplerian OEs as propagated by both approaches. The correlation is almost complete, which can be seen in more clarity in figure \ref{figCh4:diff_truth}. All errors are almost negligible, being at least of four orders of magnitude smaller than the true value.
		%
		\begin{figure}[ht]
		\begin{changemargin}{-2.5cm}{-0.5cm}
		\begin{adjustbox}{width=1.2\textwidth}
		\centering
		\medskip
		\begin{subfigure}[t]{\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_J2__Brouwer_Lyddane_vs_Hi_Fi}
		\caption{M2O conversion + mean propagation vs. Hi-Fi.}
		\label{figCh4:M20_vs_HiFi}
		\end{subfigure}
		\end{adjustbox}
		\end{changemargin}
		\end{figure}
		\begin{figure}
		\centering
		\begin{changemargin}{-2.5cm}{-0.5cm}
		\begin{adjustbox}{width=1.2\textwidth}
		\ContinuedFloat
		\begin{subfigure}[t]{\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_J2__difference_from_truth}
		\caption{Deviation from truth.}
		\label{figCh4:diff_truth}
		\end{subfigure}
		\end{adjustbox}
		\end{changemargin}
		\caption{Mean to osculating theory versus High-Fidelity propagation.}
		\end{figure}
		%
		\FloatBarrier
		%
		\paragraph{Final comments. \\}
		%
		\indent Although $J_2$ is by far the biggest perturbation derived from Earth's asphericity, further spherical harmonics may be required --or at least useful-- so as to generate more accurate models. It is important to note that, if harmonics of higher order are to be implemented, nonlinear perturbation theory should also be considered. This would be carried out through the already presented Von Zeipel's and Lie series methods, obtaining the second-order term of the expansions in the generating function ($S_2$) and the modified Hamiltonian ($K_2$). One must keep in mind that the $J_2$ term squared is of the order of any other term of the gravitational field. \\
		%
		\indent As the grounds for nonlinear theories have been established, the next topic to tackle is the implementation of a more accurate gravity field model, ideally in a general form. In the following section, Kaula's theory is presented, developed and validated, as it is a very promising approach for the topic in question.
	%
\section{Kaula's theory.}
%
\indent The aim of this section is to provide a theory that extends the aforementioned variational approach for $J_2$ perturbed orbits to any given term of the gravity field. One remarkable problem with the spherical harmonic model of the gravity field is that it is not expressed in terms of the Keplerian OEs (or any kind really). That means that, when they are put into LPEs, cumbersome and hard to interpret terms arise. Kaula's theory \cite{Kaula} tries and solves this concern by mapping the spherical coordinates into the Keplerian element set, after a not at all trivial manipulation. \\
%
\indent One application of this theory --among many others-- is the development of a more accurate mean to osculating element transformation, which includes up to a desired number of harmonics. This can in turn be used for a linearised model of relative motion, in a similar manner as Gim and Alfriend do with their STM (see section \ref{secCh5:GA_STM}). However, this theory enables many other analysis. For example, resonances for a certain kind of orbit can be studied as done by Chao \cite{Chao}.\\
%
\indent Firstly, the mentioned mapping will be justified and developed. After that, its implementation will be discussed, and to conclude, it will be validated against a High-Fidelity propagation.
%
	\subsection{Approach: $\bm{V_{lm}}$ function rearrangement.}
	%
	%
	\indent The general solution of the Laplace equation for the gravitational potential field in spherical coordinates is provided in equation 1.31 by Kaula \cite{Kaula}:
	%
	\begin{align}
	V = \dsum_{l = 0}^{\infty} \dsum_{m = 0}^l V_{lm} = \dsum_{l = 0}^{\infty} \dsum_{m = 0}^l\dfrac{\mu a_e^l}{r^{l+1}} P_{lm}(\sin\phi) \left( C_{lm} \cos m\lambda + S_{lm}\sin m\lambda\right)
	\label{eq:V_lm_1}
	\end{align}
	%
	\noindent where $r, \lambda, \phi$ are the spherical coordinates (radial distance, longitude and latitude, respectively), $P_{lm}(\sin\phi)$ is the Legendre function, $C_{lm}, S_{lm}$ are the non-dimensional coefficients of the gravity field, $a_e$ and $\mu$ are the equatorial radius and the gravitational parameter of the Earth. This expression could in principle be computed. Nonetheless, the target is to express this perturbing function in terms of the Keplerian OEs, as in that way, a closed form for the Gauss Variational Equations can be obtained.\\
	%
	\indent The task at hand now is to obtain the expressions for $r$, $\phi$ and $\lambda$ in terms of $a$, $e$, $i$, $\omega$, $\Omega$ and $M$. 
	%
	\begin{itemize}
	\item[\GMVred{I.} ] \myul[GMVred]{$r$ in terms of the OEs:} The orbital radius can easily be expressed in terms of orbital elements as:
	%
	\[
	r = \dfrac{a (1 - e^2) }{1 + e \cos \theta}
	\]
	%
	\noindent which is almost the desired expression. The only change that needs to be performed is the conversion from true anomaly $\theta$ to mean anomaly $M$ in an analytical fashion. This will be achieved through the use of series expansions in terms of the eccentricity, which is a common topic in classical references. Hence, $r$ has the following functional dependency:
	%
	\begin{equation}
	r = g_1(a, e, M)
	\end{equation}
	%
	\item[\GMVred{II.} ] \myul[GMVred]{$\phi$ in terms of the OEs:} The latitude conversion is not as straightforward. It requires the angular position of the spacecraft around the orbit --thus depending on the argument of perigee $\omega$ and true anomaly $\theta$) and the orientation of the orbital plane with respect to the equatorial plane --hence depending on the inclination $i$. This can be achieved through the usage of spherical trigonometric relations, as shown in \cite[see][p. 32, eq. 3.56]{Kaula}:
	%
	\[
	\sin \phi = \sin i \sin(\omega + \theta) 
	\]
	%
	\noindent where the true anomaly needs again to be converted to mean through the mentioned elliptic expansions, so that:
	%
	\begin{equation}
	\sin\phi = g_2(e, i, \omega, M)
	\end{equation}
	%
	\item[\GMVred{III.} ] \myul[GMVred]{$\lambda$ in terms of the OEs:} This is the most elaborated transformation of the three, as it depends not only on the angular position around the orbit, but also on the relative angular position of the orbit plane with respect to the Greenwich Meridian. This last consideration leads to a dependence on the ascending node $\Omega$ and the Greenwich Sidereal Time $\Theta$. The decomposition of $\lambda$ also requires to apply spherical trigonometry, as well as expansions of the sines and cosines in terms of its own powers (see \cite{Kaula}, eqs. 3.50-3.52.). In conclusion, the longitude $\lambda$ introduces dependencies on $\omega$, $\theta$, $\Omega$ and $\Theta$, hence on all Keplerian elements but the semimajor axis:
	%
	\begin{equation}
	(\cos m\lambda, \sin m\lambda) = g_3(e, i, \Omega, \omega, M, \Theta)
	\end{equation}
	\end{itemize}
	%
	\indent Combining all the prior transformations, and after some simplifications and regroupings, Kaula arrives to the following expression:
	%
	\begin{align}
	V_{lm} = \dfrac{\mu a_e^l}{a^{l+1}} \dsum_{p = 0}^l F_{lmp}(i) \dsum_{q = -\infty} ^{\infty} G_{lqp}(e) S_{lmpq}(\omega, M, \Omega, \Theta) \equiv \dsum_{p = 0}^{l} \dsum_{q = -\infty}^{\infty} V_{lmpq} 
	\label{eq:V_lm_2}
	\end{align}
	\noindent where $F_{lmp}$, $G_{lpq}$, and $S_{lmpq}$ are auxiliary functions that simplify the expression, each of which accounts for the influence of certain orbital elements.\\
	%
	%
	\subsection{Subfunctions $\bm{F_{lmp}}$, $\bm{ G_{lpq}}$ and $\bm{ S_{lmpq}}$.}
	%
		\subsubsection{Subfunction $\bm{F_{lmp}}$.}
		%
		\indent The function $F_{lmp}(i)$ is built to concentrate the dependency on the inclination in one single function. It is defined as (see equation 3.62 \cite{Kaula}):
		%
		\begin{align}
		\nonumber F_{lmp}(i) = & \dsum_t \dfrac{(2l - 2t)!}{t! (l-t)! (l - m - 2t)! 2^{2l - 2t}} \sin^{l-m-2t} i \times \\
		\label{eq:F_lmp}		& \dsum_{s = 0}^{m}  \dbinom{m}{s} \cos^s i \dsum_c  \dbinom{l - m - 2t + s}{c} \dbinom{m - s}{p - t- c} (-1)^{c - k}
		\end{align}
		%
		\indent The summations are characterized by:
		%
		\begin{itemize}
		\item[\GMVred{I. }]\myul[GMVred]{Summation in $t$:} $t$ is summed from 0 to the lesser of $p$ or $k$, that is: $p = \left\{0, 1, 2, \ldots, \min(p, k)\right\}$, where $k$ is defined as the integer part of $\frac{l - m}{2}$.
		%
		\item[\GMVred{II. }]\myul[GMVred]{Summation in $s$:} $s$ is summed from 0 to $m$.
		%
		\item[\GMVred{III. }]\myul[GMVred]{Summation in $c$:} $c$ is summed over all values that make the binomial coefficients nonzero. That is, those values for which the binomial coefficient does not turn into an infinite series. This condition is split in two: (A) both lower coefficients being lower or equal than the upper ones and (B) both lower coefficients must be greater or equal than zero.
		%
		\begin{subequations}
		\label{eq:F_lmp_cond}
		\begin{alignat}{4}[left = \empheqlbrace]
		& \text{Condition A)} \label{eq:F_lmp_cond_A} && 
		\left\{\begin{array}{lll}
		c\leq l - m - 2t + s \\
		p - t - c \leq m - s \Rightarrow c \geq p - t - m + s
		\end{array}\right. 
		\\
		& \text{Condition B)} \label{eq:F_lmp_cond_B}&& 
		\left\{\begin{array}{lll}
		c\geq 0 \\
		p - t - c \geq 0 \Rightarrow c \leq p - t 
		\end{array}\right. 
		\end{alignat}
		\end{subequations}
		%
		\indent Condition \eqref{eq:F_lmp_cond} is translated into limits for $c$, as:
		%
		\begin{subequations}
		\label{eq:c_lim}
		\begin{alignat}{4}[left = \empheqlbrace]
		& \text{Lower limit:}\quad \label{eq:c_lower} && c_{min} = \max\left( p - t - m + s, 0\right)\\
		& \text{Upper limit:}\quad \label{eq:c_upper} && c_{max} = \min\left(l - m - 2t + s, p - t\right)
		\end{alignat}
		\end{subequations}
		%
		\indent This then leads to the more compact expression: $c = \left\{ c_{min}, c_{min} + 1, c_{min} + 2, \ldots, c_{max} \right)$. Theoretically, $c_{min}$ could be larger than $c_{max}$. In that case, no summation terms arise, thus being the summation zero, and also $F_{lmp}(i)$.
		%
			%
			\paragraph{Example: Calculation of $\bm{F_{321}}$\\}
			% 
			\indent Equation \eqref{eq:F_lmp}, hand in hand with the summation limits definition \eqref{eq:c_lim}, is undeniably far from intuitive. In order to show how the expression itself truly works, a particularization of it will now be developed. The calculation of $F_{321}$ is explained in the following steps. 
			%
			\begin{itemize}
			\item[\GMVred{Step 1. }] \myul[GMVred]{Definition of auxiliary variables:} Defining new constant coefficients (independent of the inclination) allows for a simpler mathematical notation: 
			%
			\begin{equation}
			F_{lmp}(i) = \dsum_t C_t \sin^{l - m - 2t} (i) \dsum_s C_s \cos^s(i) \dsum_c C_c
			\label{eq:Simp_F_lmp}
			\end{equation}
			\end{itemize}
			%
			\noindent where:
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			C_t(l, m, t) & = \dfrac{(2l - 2t)!}{t! (l-t)! (l - m - 2t)! 2^{2l - 2t}} \\[1em]
			C_s(m, s) 	 & =  \dbinom{m}{s} \\[1em]
			C_c(l, m, p, t, s, c) & =  \dbinom{l - m - 2t + s}{c} \dbinom{m - s}{p - t- c} (-1)^{c - k}
			\end{array}\right.
			\label{eq:Coeffs}
			\end{equation}
			%
			%
			\indent Now, summations can be defined as:
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			S_c(l, m, p, t, s) & = \dsum_{c = c_{min}}^{c = c_{max}} C_c \\[1em]
			S_s(l, m, p) 	 & = \dsum_{s=0}^{m} C_s S_c(l, m, p, t, s) 
			\end{array}\right.
			\label{eq:Sums}
			\end{equation}
			% 
			\noindent so that equation \eqref{eq:Simp_F_lmp} can be reframed as:
			%
			\begin{equation}
			F_{lmp}(i) = \dsum_{t = 0}^{\min{p, k}} C_t S_s
			\end{equation}
			%
			%
			\item[\GMVred{Step 2. }] \myul[GMVred]{Summation limits calculation:} Starting with $t$:
			%
			\[
			t: \quad \left\{ \begin{array}{lr}
			t_{min} & =  0\\[1em]
			t_{max} =&  \min \left(0, k = \text{int} \left(\dfrac{l - p}{2}\right)\right) = \min \left(0, \text{int}\left(\dfrac{1}{2}\right)\right) = 0
			\end{array}\right.
			\]
			%
			\begin{equation}
			\Rightarrow t = \left\{0\right\}
			\label{eq:tlim}
			\end{equation}
			%
			%
			\indent Continuing with $s$:
			\[
			s: \quad \left\{ \begin{array}{lc}
			s_{min} =&  0\\
			s_{max} =&  m = 2
			\end{array}\right.
			\]
			%
			\begin{equation}
			s = \left\{0, 1, 2\right\}
			\label{eq:slim}
			\end{equation}
			%
			\indent Lastly, the limits for the $c$ summation are calculated:
			%
			\begin{equation}
			t = 0  \rightarrow \left\{ \begin{array}{ccc} 
			s = 0  \rightarrow \left\{\begin{array}{lll} c_{min} = \max(1 - 0 - 2 + 0, 0 ) = 0 \\ c_{max} =  \min(3 - 2 - 2\cdot 0 + 0, 1 - 0) = 1 \end{array}\right. & \Rightarrow c = \left\{0, 1\right\} \\[1em]
			s = 1  \rightarrow \left\{\begin{array}{lll} c_{min} = \max(1 - 0 - 2 + 1, 0 ) = 0 \\ c_{max} =  \min(3 - 2 - 2\cdot 0 + 1, 1 - 0) = 1 \end{array}\right. & \Rightarrow c = \left\{0, 1\right\}\\[1em]
			s = 2  \rightarrow \left\{\begin{array}{lll} c_{min} = \max(1 - 0 - 2 + 2, 0 ) = 1 \\ c_{max} =  \min(3 - 2 - 2\cdot 0 + 2, 1 - 0) = 1 \end{array}\right. & \Rightarrow c = \left\{ 1\right\} \\
			\end{array}\right.
			\label{eq:clim}
			\end{equation}
			%
			\item[\GMVred{Step 3. }] \myul[GMVred]{Simplification of the general expressions:} Particularizing \eqref{eq:Coeffs}:
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			C_t 		 & = \dfrac{(2\cdot 3 - 2\cdot 0)!}{0! (3-0)! (3 - 2 - 2\cdot 0)! 2^{2\cdot 3 - 2\cdot 0}} = \dfrac{15}{8} \\[1em]
			C_s(s) 		 & =  \dbinom{2}{s} \\[1em]
			C_c(s, c) 		 & =  \dbinom{3 - 2 - 2\cdot 0 + s}{c} \dbinom{2 - s}{1 - 0- c} (-1)^{c - 0} =  \dbinom{1 + s}{c} \dbinom{2 - s}{1 - c} (-1)^{c}
			\end{array}\right.
			\end{equation}
			%
			\item[\GMVred{Step 4. }] \myul[GMVred]{Calculation of the $s$ summation:}
			%
			\[S_s = C_s(s = 0)\cos^0(i) S_c(s = 0) + C_s(s = 1)\cos(i)  S_c(s = 1) + C_s(s = 2)\cos^2(i)  S_c(s = 2)\]
			% 
			\[
			s = 0 \left\{ \begin{array}{lll} 
			C_s(s = 0) =  \dbinom{2}{0} = 1 \\
			S_c(s = 0) = C_c(s = 0, c = 0) + C_c(s = 1, c = 1) = \\
			 \dbinom{1 + 0}{0} \dbinom{2 - 0}{1 - 0} (-1)^{0} +  \dbinom{1 + 0}{1} \dbinom{2 - 0}{1 - 1} (-1)^{1} = 2 - 1 = 1
			\end{array}\right.
			\] 
			%
			\begin{equation}
			\Rightarrow C_s(s = 0)\cos^0 (i) S_c(s = 0) = 1
			\label{eqs:s=0}
			\end{equation}
			%
			\[
			s = 1 \left\{ \begin{array}{lll} 
			C_s(s = 1) =  \dbinom{2}{1} = 2 \\
			S_c(s = 1) = C_c(s = 1, c = 0) + C_c(s = 1, c = 1) = \\ \dbinom{1 + 1}{0} \dbinom{2 - 1}{1 - 0} (-1)^{0} +  \dbinom{1 + 1}{1} \dbinom{2 - 1}{1 - 1} (-1)^{1} = 1 - 2 = -1
			\end{array}\right.
			\]
			%
			\begin{equation}
			\Rightarrow C_s(s = 1) \cos^1 (i) S_c(s = 1) = -2\cos(i)
			\label{eqs:s=1}
			\end{equation}
			%
			\[
			s = 2 \left\{ \begin{array}{lll} 
			C_s(s = 2) =  \dbinom{2}{2} = 1 \\
			S_c(s = 2) = C_c(s = 2, c = 1) =  \dbinom{1 + 2}{1} \dbinom{2 - 2}{1 - 1} (-1)^{1}  = -3
			\end{array}\right.
			\]
			%
			\begin{equation}
			\Rightarrow C_s(s = 2) \cos^2 (i) S_c(s = 2) = -3\cos^2(i)
			\label{eqs:s=2}
			\end{equation}
			% 
			\begin{equation}
			\Longrightarrow S_s(t = 0) = 1 - 2\cos i - 3 \cos^2 i
			\label{eq:S_s_t=0}
			\end{equation}
			%
			\item[\GMVred{Step 5. }] \myul[GMVred]{Final calculation of $F_{321}$:}
			%
			\[
			F_{321} = C_t(t = 0) \left(\sin i\right)^{3 - 2 - 2\cdot 0} S_s(t = 0)
			\]
			\begin{GMVbox} 
			\begin{equation}
			\Longrightarrow F_{321}(i) = \dfrac{15}{8} \sin i \left( 1 - 2 \cos i - 3 \cos^2 i\right)
			\end{equation}
			\end{GMVbox}
			%
			\noindent which is exactly the same result as in Kaula's tables (\cite[][p.34-35]{Kaula}). The outlined procedure will be somehow mimicked by the computational approach later on.
			%
		\end{itemize}
		%
		\subsubsection{Subfunction $\bm{G_{lpq}}$.}
		%
		\indent This section focuses on the $G_{lpq}$ function, which through elliptic expansions, converts true anomaly dependent functions into mean anomaly dependent. For this purpose, two approaches can be implemented: The one from Kaula, and its source, from Tisserand \cite{Tisserand}. The former is the one that will here be tackled, as it is a somewhat simpler version of the latter. \\
		%
		\indent The transformation one wishes to perform is:
		%
		\begin{alignat}{4}
		& \nonumber \dfrac{1}{r^{l+1}} 
		\left\{\begin{array}{c}
		\cos \\
		\sin 
		\end{array}\right\}
		\left[ (l - 2p) (\omega + f) + m(\Omega - \Theta) \right] \\
		& = \dfrac{1}{a^{l+1}} \dsum_{q} G_{lpq}(e) 
		 \label{eq:G_lpq_conv}\left\{\begin{array}{c}
		\cos \\
		\sin 
		\end{array}\right\}
		\left[ (l - 2p)\omega + (l - 2p + q) M + m(\Omega - \Theta) \right]
		\end{alignat}
		%
		\indent This expression can be averaged with respect to M in order to get long-period terms (\cite[eq. 3.66][]{Kaula}). Nonetheless, the target is to get the general expression for $G_{lpq}$, which will be done hereafter.\\
		%
		\indent Kaula, quoting Tisserand, provides the result for $G_{lpq}$:
		%
		\begin{equation}
		G_{lpq}(e) = (-1)^{\abs{q}}\left( 1 + \beta^2\right)^l \beta^{\abs{q}} \dsum_{k=0}^\infty P_{lpqk} Q_{lpqk} \beta^{2k}
		\label{eq:G_lpq_Kaula}
		\end{equation}
		\noindent where $\beta = \dfrac{e}{1 + \dsqrt{1 - e^2}}$. Each of the sub-functions can now be analysed:
		%
			\paragraph{$P_{lpqk}$ and $Q_{lpqk}$ functions.\\}
			%
			\indent Kaula defines $P_{lpqk}$ as:
			%
			\begin{equation}
			P_{lpqk} = \dsum_{r = 0}^h  \dbinom{ 2 p' - 2 l} {h - r} \dfrac{(-1)^r}{r!} \left( \dfrac{\left(l - 2p' + q'\right) e}{2\beta}\right)^r
			\label{eq:P_lpqk_Kaula}
			\end{equation}
			%
			\noindent whereas $Q_{lpqk}$ is defined as:
			%
			\begin{equation}
			Q_{lpqk} = \dsum_{r = 0}^h  \dbinom{- 2 p'} {h - r} \dfrac{1}{r!} \left( \dfrac{\left(l - 2p' + q'\right) e}{2\beta}\right)^r
			\label{eq:Q_lpqk_Kaula}
			\end{equation}
			%
			\indent Both expressions feature two auxiliary indices $p'$ and $q'$ and the summation limit $h$. The first two are defined in terms of the input indices $lpqk$ as:
			%
			\begin{align}
			\label{eq:pprime} p' = \left\{
			\begin{array}{ccc}
			p & \text{if} & p \leq l/2 \\
			l - p & \text{if} & p > l/2
			\end{array}
			\right.
			\\
			\label{eq:qprime} q' =  \left\{
			\begin{array}{ccc}
			q & \text{if} & p \leq l/2 \\
			-q & \text{if} & p > l/2
			\end{array}
			\right.
			\end{align}
			%
			\noindent and the summation limit $h$ is defined as:
			%
			\begin{align}
			\label{eq:h_P} \text{For}\quad P_{lpqk}: \quad h =  \left\{
			\begin{array}{ccc}
			k + q' & \text{if} & q' >0 \\
			k & \text{if} & q' < 0
			\end{array}
			\right.
			\\
			\label{eq:h_Q} \text{For}\quad Q_{lpqk}: \quad h =  \left\{
			\begin{array}{ccc}
			k  		& \text{if} & q' > 0 \\
			k - q' 	& \text{if} & q' < 0
			\end{array}
			\right.
			\end{align}
			%
			\paragraph{Example: Calculation of $\bm{G_{201}}$\\}
			%
			\indent Similarly to what has been done with $F_{lmp}$, a good way to break down the complexity of the $G_{lpq}$ expression is to perform a by-hand substitution of the indices $lpq$. particularly, $l = 2$, $p = 0$ and $q = 1$. Without further ado, the substitution proceeds as follows:
			%
			\begin{itemize}
			\item[\GMVred{Step 1. }] \myul[GMVred]{Definition of auxiliary variables:} A more compact form of $G_{lpq}$ is achieved as:
			%
			\begin{equation}
			G_{lpq}(e) =  C S_{k}
			\label{eq:Simp_G_lpq}
			\end{equation}
			%
			\noindent where:
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			C(l, q) = (-1)^{\abs{q}}\left( 1 + \beta^2\right)^l \beta^{\abs{q}}\\
			S_k(l, p, q) = \dsum_{k=0}^{\infty} P_{lpqk}Q_{lpqk}\beta^{2k} 
			\end{array}\right.
			\label{eq:Simp_G_lpq_V2}
			\end{equation}
			%
			\indent Additionally, the expressions of $P_{lpqk}$ and $Q_{lpqk}$ can also be redefined as:
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			P_{lpqk} & = \dsum_{r = 0}^h p_r  \left( 1 + \eta \right)^r\\[1em]
			Q_{lpqk} & = \dsum_{r = 0}^h q_r  \left( 1 + \eta \right)^r
			\end{array}\right.
			\label{eq:PQ_simp}
			\end{equation}
			%
			\noindent where $\eta = \sqrt{1 - e^2}$ and:
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			p_r(l, p, q, h, r) & =  \dbinom{ 2 p' - 2 l} {h - r} \dfrac{(-1)^r}{r!} \left( \dfrac{l - 2p' + q'}{2}\right)^r\\[1em]
			q_r(l, p, q, h, r) & =  \dbinom{ -2 p'} {h - r} \dfrac{1}{r!} \left( \dfrac{l - 2p' + q'}{2}\right)^r\\
			\end{array}\right.
			\label{eq:pq_coeffs}
			\end{equation}
			%
			\item[\GMVred{Step 2. }] \myul[GMVred]{Auxiliary indices and summation limits calculation:}
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			p = 0 < \dfrac{2}{2} =\dfrac{l}{2} &  \Rightarrow p' = p = 0\\[1em]
			q= 1 >0  &  \Rightarrow q' = q = 1\\[1em]
			h = \left\{\begin{array}{l}
			\text{For } P_{lpqk}: \quad q' = 1>0 \\
			\text{For } Q_{lpqk}: \quad q' = 1>0 \end{array}\right.
			& \begin{array}{l}
			\Rightarrow h = k + q' = k + 1\\
			\Rightarrow h = k \\		
			\end{array}
			\end{array}\right.
			\label{eq:G_indices}
			\end{equation}
			%
			%
			\item[\GMVred{Step 3. }] \myul[GMVred]{Simplification of the general expressions:} With \eqref{eq:G_indices} in mind, and substituting the values into \eqref{eq:pq_coeffs} and \eqref{eq:Simp_G_lpq_V2}:
			%
			\begin{equation}
			\left\{ \begin{array}{ll}
			C(l= 2, q=1) 	 & = (-1)^{\abs{1}}\left( 1 + \beta^2\right)^2 \beta^{\abs{1}} = -\beta - 2\beta^3 - \beta^5 \\[1em]
			p_r(l = 2, p = 0, q = 1, h = k+1, r) 		 & =  \dbinom{-4}{k + 1 - r} \dfrac{(-1)^r}{r!} \left( \dfrac{3}{2}\right)^r\\[1em]
			q_r(l = 2, p = 0, q = 1, h = k+1, r) 		 & =  \dbinom{0}{k - r} \dfrac{1}{r!} \left( \dfrac{3}{2}\right)^r\\
			\end{array}\right.
			\end{equation}
			%
			%
			\item[\GMVred{Step 4. }] \myul[GMVred]{Analysis of eccentricity powers to retain:} If, as Kaula, the aim is to get a fourth-order expansion in terms of the eccentricity, care must be taken to calculate just the necessary terms of the $k$ summation. The factor $C(l, q)$ is a function of $\beta$, whose developments for different powers is provided in \ref{sec:Beta}. Substituting into $C$:
			%
			\[
			C(l = 2, q=1)(e) = - \left(\dfrac{1}{2}e + \dfrac{1}{8}e^3 + \mathcal{O}(e^5)\right) - 2 \left(\dfrac{1}{8} e^3 +\mathcal{O}(e^5)\right) + \mathcal{O}(e^5)
			\]
			\begin{equation}
			\Rightarrow C(e) = -\dfrac{1}{2}e - \dfrac{3}{8}e^3 + \mathcal{O}(e^5) = \mathcal{O}(e)
			\label{eq:C_approx}
			\end{equation}
			%
			%
			\indent As the coefficient $C$ is of order $\mathcal{O}(e)$, the summation $S_k$ shall only contain elements of order less or equal than $\mathcal{O}(e^3)$. The functions $P_{lpqk}$ and $Q_{lpqk}$ have a term of order zero, so terms of order up to three must be retained in $\beta^{2k}$. As powers of $\beta$ (which is $\sim \mathcal{O}(e)$) grow by twos, only $k=0$ and  $k = 1$ must be considered. \\
			%
			\indent Before diving into the calculation of $S_k$, it is necessary to arrive to a fourth-order version of $\eta$. Its MacLaurin series expansion can be calculated as:
			%
			\begin{equation}
			\begin{array}{lll}
			\eta = & \sqrt{1 - e^2} = \left(1 - e^2\right)^{1/2} = \dsum_{n = 0}^\infty  \dbinom{1/2}{n} (-1)^n e^{2n} =\\[1.2em]
			 &\dbinom{1/2}{0} (-1)^0 e^0 +  \dbinom{1/2}{1} (-1) e^2 +  \dbinom{1/2}{2} (-1)^2 e^4 + \mathcal{O}(e^6) = \\[1.2em]
			 &\dfrac{(1/2) (-1/2) (-3/2) (-5/2)\ldots }{1 \cdot (1/2)(-1/2) (-3/2) (-5/2) \ldots} + \dfrac{(1/2) (-1/2) (-3/2) (-5/2)\ldots }{1 \cdot (-1/2) (-3/2) (-5/2) \ldots} (-1)e^2  +\\ [1.2em]
			 &+ \dfrac{(1/2) (-1/2) (-3/2) (-5/2)\ldots }{1 \cdot (-3/2) (-3/2) (-5/2) \ldots} e^4 + \mathcal{O}(e^6) = 1 - \dfrac{e^2}{2} - \dfrac{e^4}{8} + \mathcal{O}(e^6)
			\end{array}
			\label{eq:eta_exp}
			\end{equation}
			%
			\begin{equation}
			\Rightarrow 1 + \eta = 2 - \dfrac{e^2}{2} - \dfrac{e^4}{8} + \mathcal{O}(e^6)
			\end{equation}
			%
			\indent In conclusion, $k = 0, 1$ and for each of those values, $h$ is defined by \eqref{eq:G_indices}.
			%
			\item[\GMVred{Step 5. }] \myul[GMVred]{Computation of $S_k$:}
			%
			\begin{equation}
			S_k = P_{2010}Q_{2010} \beta^0 + P_{2011}Q_{2011} \beta^2
			\end{equation}
			%
				\begin{changemargin}{-2.8cm}{1cm}
				\[
				k = 0 \left\{ \begin{array}{lll} 
				P_{2010} = 	 \dsum_{r = 0}^{0+1} p_r  \left( 1 + \eta \right)^r &= p_r(r = 0) + p_r(r=1) \left( 1 + \eta \right)  =\\ 
							& =\dbinom{-4}{1} \cdot 1  + \dbinom{-4}{0} (-1)\dfrac{3}{2} (1 + \eta) = -4 - \dfrac{3}{2}(1 + \eta) \\
				Q_{2010} = 	 \dsum_{r = 0}^{0+0} q_r  \left( 1 + \eta \right)^r &= q_r(r = 0) = \dbinom{0}{0} \cdot 1  = 1 \\ 
				\end{array}\right.
				\]
				\end{changemargin}
				\begin{changemargin}{-2.8cm}{1cm}
				\[
				k = 1 \left\{ \begin{array}{lll} 
				P_{2011} = 	 \dsum_{r = 0}^{1+1} p_r  \left( 1 + \eta \right)^r & = p_r(r = 0) + p_r(r=1) \left( 1 + \eta \right)  + p_r(r=2) \left( 1 + \eta \right)^2 = \\ 
							& =\dbinom{-4}{2} \cdot 1 + \dbinom{-4}{1} (-1)\dfrac{3}{2} (1 + \eta)+ \dbinom{-4}{0} \dfrac{9}{4} (1 + \eta)^2= 10 + 6  (1 + \eta) + \dfrac{9}{8} (1 + \eta)^2 \\
				Q_{2011} = 	 \dsum_{r = 0}^{1+0} q_r  \left( 1 + \eta \right)^r & = q_r(r = 0) + q_r(r = 1) \left( 1 + \eta \right) = \\
							& = \dbinom{0}{1} \cdot 1 + \dbinom{0}{0} \dfrac{3}{2}(1 + \eta) = \dfrac{3}{2}(1 + \eta) \\ 
				\end{array}\right.
				\]
				\end{changemargin}
			%
			\indent The ``tricky'' part starts now: The summation $S_k$ now looks like:
			%
			\begin{equation}
			S_k = \left[-4 - \dfrac{3}{2}(1 + \eta)\right] + \left[\left(10 + 6  (1 + \eta) + \dfrac{9}{8} (1 + \eta)^2 \right)  \dfrac{3}{2}(1 + \eta) \right]\beta^2
			\end{equation}
			% 
			\indent As argued before, $S_k$ must be expanded up to third order. The $\eta$ in the first term in brackets can be expanded up to second order, as no additional eccentricity power exists. Conversely, in the right-hand side term, the fact that it is multiplied by $\beta^2 \sim \mathcal{O}(e^2)$ allows for expanding up to first order, which actually reduces to zeroth order ($\eta$ has no linear term). In conclusion, $\eta \approx 1 - e^2 / 2$ for the left term and $\eta \approx 1$ for the right one:
			%
			\[
			S_k = \left[-4 - \dfrac{3}{2}(2 - e^2 / 2 )\right] + \left[\left(10 + 6 \cdot 2 + \dfrac{9}{8} 2^2\right) \dfrac{3}{2}2 \right]\beta^2
			\]
			%
			\indent Applying the $\beta$ function expansion and retaining terms of up to second order:
			%
			\begin{equation}
			S_k = -4 - 3 + \dfrac{3}{4}e^2 + \dfrac{53}{2} \dfrac{3}{4} e^2 = -7 + \dfrac{165}{8}e^2
			\label{eq:S_k}
			\end{equation}
			\item[\GMVred{Step 6. }] \myul[GMVred]{Final calculation of $G_{201}$:}
			%
			\[
			G_{201} = C \; S_k = \left(-\dfrac{1}{2}e - \dfrac{3}{8}e^3 \right) \left(-7 + \dfrac{165}{8}e^2\right) =
			\]
			\begin{GMVbox}
			\begin{equation}
		 	\Rightarrow G_{201} = \dfrac{7}{2}e - \dfrac{123}{16}e^3 + \mathcal{O}(e^5)
			\end{equation}
			\end{GMVbox}
			\end{itemize}
			%
			\noindent expression which is exactly identical to the one from \cite[Kaula][p.38]{Kaula}.
			%
		%
		\subsubsection{Subfunction $\bm{S_{lmpq}}$.}
		%
		%
		\indent The subfunction $S_{lmpq}$ embodies the longitude-dependent part of the spherical harmonic. This happens through the Keplerian OEs $\omega$, $M$ and $\Omega$, and the Greenwich Mean Sidereal Time $\Theta$. This function happens to be at the innermost loop in the $V_{lm}$ function, depending on four indices. It is defined as:
		%
		\begin{align}
		&\nonumber S_{lmpq} = && 
		\left[ \begin{array}{c}
		C_{lm}\\
		-S_{lm}
		\end{array}\right]_{l - m \text{\; odd}}^{l - m \text{\; even}} \cos \left[ (l - 2p)\omega + (l - 2p + q)M + m (\Omega - \Theta) \right] \\
		& \label{eq:S_lmpq} && 
		\left[ \begin{array}{c}
		S_{lm}\\
		C_{lm}
		\end{array}\right]_{l - m \text{\; odd}}^{l - m \text{\; even}} \sin \left[ (l - 2p)\omega + (l - 2p + q)M + m (\Omega - \Theta) \right] 
		\end{align}
		%
		\indent The shape of this function reveals some insights, depending on the values of the indices $l, p$ and $q$:
		%
		\begin{itemize}
		\item[\GMVred{I.}] If $m = 0$, the sidereal angle $\Theta$ does not appear on the phase angle. This means that harmonics of the form $V_{i0}$ (also known as zonal harmonics) do not depend on the Earth's rotational state. This makes sense, as said harmonics represent irregularities that present a rotational symmetry around the Earth's axis.
		%
		\item[\GMVred{II.}] If $l - 2p + q = 0$, no dependency on $M$ arises. Hence, it is not a short-period effect: it is either long-period (depends on $\omega$ or $\Omega$) or secular (null phase)
		%
		\item[\GMVred{III.}] If $l - 2p = 0$ and $m = 0$, $\omega$, $\Omega$ and $\Theta$ do not appear in the phase angle. This means that it is either a secular or a short-periodic effect.
		%
		\end{itemize}
		%
		\indent With this in mind, three different types of terms come to light:
		%
		\begin{itemize}
		\item[\GMVred{A.}] \myul[GMVred]{Secular terms}: $l,m,p$ and $q$ such that: $l - 2p = 0$, $l - 2p + q = 0$ and $m = 0$.
		%
		\item[\GMVred{B.}] \myul[GMVred]{Long-period terms}: $l,m,p$ and $q$ such that:  $l - 2p + q = 0$ and $m \neq 0$, $l - 2p \neq 0$.
		%
		\item[\GMVred{C.}] \myul[GMVred]{Short-period terms}: $l,m,p$ and $q$ such that: $l - 2p + q \neq 0$.		
		\end{itemize}
		\indent As a final remark, tables with $F_{lmp}$ and $G_{lpq}$ for $l = \left\{2, 3, 4\right\}$, $m = \left\{0, 1, 2, 3, 4\right\}$, $p = \left\{0, 1, 2, 3, 4\right\}$ and $q  = \left\{-4, -3, -2, -1, 0, 1, 2, 3, 4\right\}$ are provided in appendix \ref{app:App_E}
		%
	\subsection{Implementation.}
	%
	\indent Once the gravity field has been re-parameterized, it is time to discuss its computational implementation. For now, the target is to obtain the effect of any component $V_{lm}$ on the Keplerian OEs, which can be done through the LPEs. Nonetheless, the manipulation of each $V_{lmpq}$ term and its summation turns out to be quite cumbersome, due to (a) the intrinsic uncomfortable expressions and (b) the summation of a considerable amount of individual terms. That is why a systematic approach is developed over the following sections.
	%
		
		\subsubsection{Computation of $\bm{V_{lm}}$}
		%
		%
		\indent A priori, by looking at equation \eqref{eq:V_lm_2}, there seem to be two ways to compute $V_{lm}$:
		%
		\begin{itemize}
		\item[\textcolor{GMVred}{A}]: Compute $V_{lmpq} = F_{lmp} G_{lpq} S_{lmpq}$ and then do the summation on $p$ and $q$.
		%
		\item[\textcolor{GMVred}{B}]: Compute the summations on $q$ and $p$ successively, that is, compute $\sigma_q = \sum_{q} G_{lpq} S_{lmpq}$, then $\sigma_p = \sum_{p} F_{lmp} \sigma_q$ and finally obtain $V_{lm}$.
		\end{itemize}
		%
		\indent Both approaches are equally right. In this case, the first one will be used, whose general workflow can be seen in figure \ref{tikz:Workflow_V_lm}. 
		%
		\input{Chapters/Chapter_04/Tikz_V_lmpq}
		%
		%
			\paragraph{\GMVred{I.} \myul[GMVred]{Subfunction $\bm{F_{lmp}}$.} \\}
			%
			\indent The function $F_{lmp}(i)$ has the structure shown in \eqref{eq:F_lmp}. As it can there be appreciated, there are three concatenated summations. The innermost will be called $S_c$ onwards; the one in the middle, $S_s$, and the outer one is the function $F_{lmp}$ itself. Mathematically:
			%
			\begin{align}
			& \label{eq:sumC} S_c(i; l, m, t, s) =  \dsum_c  \dbinom{l - m - 2t + s}{c} \dbinom{m - s}{p - t- c} (-1)^{c - k}  \equiv \dsum_{c} C_c\\
			& \label{eq:sumS} S_s(i; l, m, t) = \dsum_{s = 0}^{m}  \dbinom{m}{s} \cos^s i S_c(i; l, m, t, s) \equiv \dsum_{s} C_s \cos^s i S_c \\
			& \label{eq:F_lmp_Ss}\Rightarrow F_{lmp}(i) = \dsum_t  \dfrac{(2l - 2t)!}{t! (l-t)! (l - m - 2t)! 2^{2l - 2t}} \sin^{l-m-2t} i Ss_s(i; l, m, t) \equiv\dsum_{t} C_t (\sin i)^{l - m - 2t} S_s
			\end{align}
			%
			\indent A simplified workflow of the procedure to compute $F_{lmp}$ is shown in \ref{tikz:Workflow_F_lmp_simp}. 
			%
			\input{Chapters/Chapter_04/Workflow_F_lmp_simplified}
			%
			\paragraph{\GMVred{II.} \myul[GMVred]{Subfunction $\bm{ G_{lpq}}$.}\\ }
			%
			\indent The calculation of $G_{lpq}$ can be carried out, as shown before, in two ways: the one developed by Kaula and the one developed by Tisserand. Both are tightly related, though the second one seems to be more general. The results should be the same nevertheless. In order to have control on which method is used, a method argument will be fed into the function which computes $G_{lpq}$. \\
			%
			\indent analogue to what was done for $F_{lmp}$, the computation of $G_{lpq}$ can be separated into lower-level components. Following equation \eqref{eq:G_lpq_Kaula}:
			\begin{align}
			& \label{eq:sum_k} S_k(e; l, p, q, k) = \dsum_{k = 0}^{k_{max}} P_{lpqk} Q_{lpqk} \beta^{2k} \\
			& \label{eq:G_lpq_sum_k} G_{lpq}(e) = (-1)^{\abs{q}}\left( 1 + \beta^2\right)^l \beta^{\abs{q}} S_k(e; l, p, q, k) 
			\end{align}
			%
			\noindent where $P_{lpqk}$ and $Q_{lpqk}$ are defined by \eqref{eq:P_lpqk_Kaula} and \eqref{eq:Q_lpqk_Kaula}, happening to be another nested summation in $r$. The workflow that embodies this method is shown in \ref{tikz:Workflow_G_lpq_kaula}.
			%
			\input{Chapters/Chapter_04/Workflow_G_lpq_kaula}
			%
			\paragraph{\GMVred{III.} \myul[GMVred]{Subfunction $\bm{ S_{lmpq}}$.} \\}
			%
			\indent The computation of $S_{lmpq}$ cannot be simplified any further from the expression \eqref{eq:S_lmpq}. The only reformulation that can be useful for computational purposes is to obtain a case structure, that is:
			%
			\begin{alignat}{4}
			& \label{eq:S_lmpq_mod} S_{lmpq} (\omega, M, \Omega, \Theta; l, m, p, q) = && \left\{ \begin{array}{ccc}
			C_{lm} \cos \nu	 + S_{lm} \sin \nu & \text{if} & \text{rem}(l - m, 2) = 0\\ [1em]
	 		-S_{lm} \cos \nu + C_{lm} \sin \nu & \text{if} & \text{rem}(l - m, 2)  \neq 0	
			\end{array}\right.
			\end{alignat}
			%
			\noindent where $\nu = (l - 2p)\omega + (l - 2p + q)M + m (\Omega - \Theta)$ and rem is the remainder function.
			%
			%
		\subsection{Validation.}
		%
		%
			\subsubsection{Target and approach.}
			%
			\indent Once Kaula's theory has been implemented, it is time to validate its results against a truth model. There are two basic approaches to do this:
			%
			%
			\begin{itemize}
			\item[\GMVred{A.}]\myul[GMVred]{Compare Kaula's form of $V_{lm}$ with some other form}: This validation process consists of comparing the results yielded by the expressions \eqref{eq:V_lm_1} and \eqref{eq:V_lm_2} or other expression provided in the literature. In the case of the spherical coordinate parametrization, it needs the implementation of a ECI to geodetic frame transformation, being actually a validation of Kaula's ``happy thoughts'' to arrive to a KOE-dependent expression of the gravitational field. However, a simplified version of this type of testing is achieved by comparing \eqref{eq:V_lm_2} for $l,m = 2,0$ with the expression 5.48 from Wiesel \cite{Wiesel}, which is obtained through similar yet less general operations, and only second-order accurate.
			%
			\item[\GMVred{B.}]\myul[GMVred]{Compare a High-Fidelity orbit propagator with Kaula's LPEs}: This approach basically means to implement the $V_{lmpq}$ function into the general expression of the LPEs to then compare the output with a cartesian, High-Fidelity propagator. This leads to the need of derivatives of the functions $F_{lmp}$, $G_{lpq}$ and $S_{lmpq}$, whose calculation might be more or less complex.
			\end{itemize}
			%
			\subsubsection{Validation of disturbing function.}
			%
			\indent This section focuses on the analysis of the validity of the $V_{20}$ function itself, rather than its effect on the orbital elements. In order to test this, the analytical form of the $J_2$ disturbing function will be used. This function is shown in many references, such as \cite{Wiesel}, eq. 5.41 or \cite{Brouwer}. It is equal to:
			%
			\begin{equation}
			R_2 = - \dfrac{\mu a_e^2 J_2}{2 r^3} \left(3\sin^2 i \sin^2 (\omega + \theta) - 1 \right)
			\label{eqCh4:R2_gen}
			\end{equation}
			%
			\indent Wiesel \cite{Wiesel} provides an approximation for this function in equation 5.48. It is obtained through similar though less general operations than Kaula, starting from \eqref{eqCh4:R2_gen}. As before, the radial term and the true anomaly must be converted into Keplerian OEs. For this purpose, the principal relation that is recurrently used is:
			%
			\begin{equation}
			\theta \approx M + 2e\sin M + \dfrac{5}{4}e^2\sin 2M + \mathcal{O}(e^3)
			\end{equation} 
			%
			\indent After performing some substitutions and expansions, the final form of $R_2$ correct up to second order in the eccentricity is:
			%
			\begin{alignat}{4}
			\nonumber \left. R_2\right\rvert_{e^2} & = - \dfrac{\mu a_e^2 J_2}{2 a^3} \left( \dfrac{3}{2} \sin^2 i - 1 - \dfrac{3}{2} e^2 + \dfrac{9}{4} e^2\sin^2 i - \dfrac{3}{2} \sin^2 i \cos(2M + 2\omega) \right.\\
			\nonumber 	&  + \dfrac{3}{4} e \sin^2 i \cos(M + 2\omega) - \dfrac{21}{4}e \sin^2 i \cos(3M + 2\omega) + \dfrac{9}{2} e\sin^2 i \cos M\\
			\nonumber 	& - 3e \cos M - \dfrac{51}{4} e^2 \sin^2 i \cos(4M + 2 \omega) + \dfrac{15}{4}e^2 \sin^2 i \cos(2M + 2\omega)\\
			\label{eqCh4:R2_wiesel}		&  \left. - \dfrac{9}{2} e^2 \cos(2M) + \dfrac{27}{4}e^2  \sin^2 i \cos 2M + \mathcal{O}(e^3) \right)						
			\end{alignat}
			%
			\indent Finally, Kaula computes this disturbing function as:
			%
			\begin{equation}
			V_{20} = -\dfrac{\mu J_2}{a} \left( \dfrac{a_e}{a} \right)^2 \dsum_{p} F_{20p} \dsum_{q} G_{2pq} \cos\left[ (2 - 2p)\omega + (2 - 2p + q)M \right]
			\label{eqCh4:V20_kaula}
			\end{equation}
			%
			\noindent expression which, in principle, should be accurate up to fourth order in the eccentricity. Now all it's needed to do is compare the expressions \eqref{eqCh4:R2_gen}, \eqref{eqCh4:R2_wiesel} and \eqref{eqCh4:V20_kaula}. As the error should be dependent on the eccentricity value, two values will be used, without varying the rest of the orbital elements. The scenarios are defined by the true osculating values defined in \eqref{eqCh4:Scenarios_m2o} but expressed in Keplerian elements and, for the second scenario, increasing the eccentricity on purpose. To summarize:
			%
			\begin{equation}
			\text{Scenarios} \left\{ \begin{array}{lll}
			a_1 = a_2 = 7091870 \; km 	& e_1 = 0.0055\; , \; e_2 = 0.2	& i_1 = i_2	= 1.22196 \; rad 	\\
			\Omega_1 = \Omega_2 = 0.78547\; rad 	& \omega_1 = \omega_2 =  0.31583  \; rad 	& M_1 = M_2 = 2.82233 \; rad  	\\  
			\end{array}\right.
			\label{eqCh4:Scenarios_V20}
			\end{equation}
			%
			\indent The results for each scenario are shown in \ref{tabCh4:V20}. As expected, error grows steeply with the eccentricity. There are some unexpected results though: the second-order approximation of Wiesel yields better results than the one from Kaula, which should be fourth-order accurate. The explanation for this may hide in the fact that Kaula suggests to just retain terms from $q = -2$ to $q = 2$, although a deeper analysis would be more clear. Nonetheless, and as further and more meaningful validations will be performed, this is in principle unnecessary.
			%
			%
			\begin{table}[!htb]
			\begin{center}
			\begin{changemargin}{-0.5cm}{0cm}
			\begin{tabular}{|a|c|c|c|c|}
			\hline 
			\textbf{Method} & \multicolumn{2}{c}{\textbf{Scenario 1}} & \multicolumn{2}{c|}{\textbf{Scenario 2}} \\ 
			\hline 
			\textbf{Truth} ($R_2$, eq. \eqref{eqCh4:R2_gen}) & \multicolumn{2}{c}{$2.42307 \cdot 10^{4}$}  & \multicolumn{2}{c|}{$1.41322 \cdot 10^{4}$}\\
			\cline{2-5}
			\textbf{Wiesel} ($\left. R_2\right\rvert_{e^2} $, eq. \eqref{eqCh4:R2_wiesel})& $2.42307 \cdot 10^{4}$  & $\Delta = 6.1731 \cdot 10^{-3}$  & $2.42307 \cdot 10^{4}$  & $\Delta = 4.76257 \cdot 10^{2}$ \\ 
			\textbf{Kaula} ($V_{20} $, eq. \eqref{eqCh4:V20_kaula})& $2.42308 \cdot 10^{4}$  & $\Delta = 4.9176 \cdot 10^{-2}$  & $1.58803 \cdot 10^{4}$  & $\Delta = 1.74815 \cdot 10^{3}$ \\ 
			\hline 
			\end{tabular}
			\end{changemargin}
			\caption{Approximations of the $J_2$ term of the geopotential expansion.}
			\label{tabCh4:V20} 
			\end{center}
			\end{table}
			%
			%
			\subsubsection{High-Fidelity propagation vs. Kaula's LPEs.}
			%
			\indent It is important to keep in mind the target, which is the validation of the expressions of $V_{lm}$ for a given set of $l$ and $m$. It is necessary then to validate each and every combination of $l$ and $m$, so as to make sure that the effect of every harmonic is successfully taken into account. For the propagation of Kaula's LPEs this is easily achieved by just particularizing said values of $l$ and $m$ into the general expression. Conversely, for the Hi-Fi propagation, this is done in a ``cheeky'' way, by selectively nullifying the coefficients of the $C$ and $S$ matrices, leaving the only non-zero coefficient at $C_{lm}$, $S_{lm}$.\\
			%
			\indent However, in a first approximation to the validation, doing so against a regular $J_2$ model may be enough. Further validations can easily be performed, by simply selecting any other value for $l$ and $m$.\\
			%
			\indent The LPEs particularized for Kaula's functions will be first developed, after which an approximated integration will be performed. Finally, the actual results of the comparison for a certain set of cases will be shown.
			%
				\paragraph{\GMVred{I.} \myul[GMVred]{Kaula's LPEs for $V_{lmpq}$.}\\ }
				%
				\indent As shown in Kaula \cite{Kaula} (p. 29, eq. 3.38-3.40), the Gauss Variational Equations can be written as:
				%
				\begin{equation}
				\left\{ \begin{array}{llll}
				\dfrac{da}{dt} 		& = \dfrac{2}{na} \dfrac{ \partial R}{\partial M} \\[1.2 em]
				\dfrac{de}{dt} 		& = \dfrac{\eta^2}{na^2 e} \dfrac{ \partial R}{\partial M} - \dfrac{\eta}{na^2e} \dfrac{\partial R}{\partial e} \\[1.2 em]
				\dfrac{di}{dt} 		& = \dfrac{\cos i}{na^2 \eta \sin i} \dfrac{ \partial R}{\partial \omega} - \dfrac{1}{na^2 \eta \sin i} \dfrac{\partial R}{\partial \Omega} \\[1.2 em]
				\dfrac{d\Omega}{dt} & = \dfrac{1}{na^2 \eta \sin i} \dfrac{ \partial R}{\partial i} \\[1.2 em]
				\dfrac{d\omega}{dt} & = -\dfrac{\cos i}{na^2 \eta \sin i} \dfrac{ \partial R}{\partial i} + \dfrac{\eta}{na^2  e} \dfrac{\partial R}{\partial e}\\[1.2 em]
				\dfrac{dM}{dt}		& = n - \dfrac{\eta^2}{n a^2 e}\dfrac{\partial R}{\partial e} - \dfrac{2}{na} \dfrac{\partial R}{\partial a}
				\end{array}\right.
				\label{eq:LPE}
				\end{equation}
				%
				\indent These equations can be particularized for the case $R = V_{lmpq}$: that is, when the disturbing function is the effect of the contribution $p, q$ of the harmonic $l, m$. Substituting relation \eqref{eq:V_lm_2} into \eqref{eq:LPE} and rearranging terms:
				%
				\begin{equation}
				\left\{ \begin{array}{llll}
				\dfrac{da_{lmpq}}{dt} 		& = \dfrac{2\mu a_e^l}{na^{l+2}} F_{lmp} G_{lpq} (l - 2p + q)\dfrac{ d S_{lmpq}}{d \nu} \\[1.2 em]
				\dfrac{de_{lmpq}}{dt} 		& = \dfrac{\mu a_e^l \eta}{na^{l + 3} e} F_{lmp} G_{lpq} \dfrac{ dS_{lmpq}}{d \nu} \left[ \left( l - 2p + q\right) \eta - \left(l - 2p\right)\right] \\[1.2 em]
				\dfrac{di_{lmpq}}{dt} 		& = \dfrac{\mu a_e^l}{na^{l + 3} \eta \sin i}F_{lmp} G_{lpq}  \dfrac{ \partial S_{lmpq}}{\partial \nu} \left[ \left( l - 2p \right) \cos i - m\right] \\[1.2 em]
				\dfrac{d\Omega_{lmpq}}{dt} 	& = \dfrac{\mu a_e^l}{na^{l + 3} \eta \sin i} G_{lpq} S_{lmpq}\dfrac{ dF_{lmp} }{di} \\[1.2 em]
				\dfrac{d\omega_{lmpq}}{dt} 	& = \dfrac{\mu a_e^l}{na^{l + 3} \eta } S_{lmpq} \left( \dfrac{\eta^2}{e} F_{lmp} \dfrac{d G_{lpq}}{d e} - \dfrac{\cos i}{\sin i} G_{lpq} \dfrac{dF_{lmp}}{di} \right)\\[1.2 em]
				\dfrac{dM_{lmpq}}{dt}		& = \dfrac{\mu a_e^l}{n a^{l + 3}}F_{lmp} S_{lmpq} \left[2(l+1)G_{lpq} - \dfrac{\eta^2}{e} \dfrac{dG_{lpq}}{de}\right]
				\end{array}\right.
				\label{eq:Kaula_LPE_1}
				\end{equation}
				%
				\noindent where the elements on the right-hand side of the equation are the mean OEs, calculated with the secular rates. This is of course an approximation, without which the solution cannot be obtained. Anyway, in order to calculate the variation of the orbital elements, it is necessary then to calculate the derivatives of $F_{lmp}$, $G_{lpq}$ and $S_{lmpq}$:
				%
					\subparagraph{\GMVred{I.A. } \myul[GMVred]{Derivative of $\bm{F_{lmp}}$.} \\ }
					%
					\indent The derivative of $F_{lmp}$ is directly calculated from \eqref{eq:Simp_F_lmp} as:
					%
					\begin{equation}
					\begin{array}{lll}
					\dfrac{dF_{lmp}}{di} =&  \dsum_{t} (l - m - 2t) C_t \cos^{l - m - 2t - 1}(i) \dsum_{s} C_s \cos^s (i) \dsum_{c}C_c - \\
					& \dsum_{t} C_t \sin^{l - m - 2t} (i) \dsum_{s} s C_s \sin^{s-1}(i) \dsum_{c} C_c
					\end{array}
					\label{eq:dF_lmp}
					\end{equation}
					%
					\indent This expression can be computed in an analogue manner to $F_{lmp}$.
					%
					\subparagraph{\GMVred{I.B. }\myul[GMVred]{Derivative of $\bm{G_{lpq}}$.}\\}
					%
					\indent Expression $G_{lpq}$ is clearly a messy expression to differentiate. For the sake of simplicity, the derivatives will be taken on the polynomial expansions derived from the original expression, that is, for a general $G_{lpq}$ approximated by:
					%
					\[
					G_{lpq} = g_0 + g_1 e + g_2 e^2 + g_3 e^3 + g_4 e^4 + g_5 e^5 + \mathcal{O}(e^6)
					\]
					%
					\noindent its derivative is calculated as:
					%
					\begin{equation}
					\dfrac{dG_{lpq}}{de} \approx g_1 + 2g_2 e + 3 g_3 e^2 + 4 g_4 e^3 + 5 g_5 e^4
					\label{eq:dG_lpq}
					\end{equation}
					%
					\subparagraph{\GMVred{I.C. }\myul[GMVred]{Derivative of $\bm{S_{lmpq}}$.}\\} 
					%
					\indent Finally, it is time to calculate the derivative of $S_{lmpq}$ with respect to its argument $\nu$. It can be easily calculated by differentiating \eqref{eq:S_lmpq_mod} as:
					%
					\begin{alignat}{4}
					\label{eq:dS_lmpq} \dfrac{dS_{lmpq}}{d\nu} = && \left\{ \begin{array}{ccc}
					-C_{lm} \sin \nu	+ S_{lm} \cos \nu & \text{if} & \text{rem}(l - m, 2) = 0\\ [1em]
		 			S_{lm} \sin \nu 	+ C_{lm} \cos \nu & \text{if} & \text{rem}(l - m, 2)  \neq 0	
					\end{array}\right.
					\end{alignat}
					%
				\paragraph{\GMVred{II.} \myul[GMVred]{Effect of $\bm{V_{lm}}$ in the Keplerian OEs.} \\}
				%
				\indent Up to now a closed-form for the variation of the orbital elements due to $V_{lmpq}$ has been reached. The effect of the harmonic $V_{lm}$ is just a double summation on $p$ and $q$ of the obtained derivatives $\frac{d}{dt}(a, e, i, \omega, \Omega, M)$ \eqref{eq:Kaula_LPE_1}, that is:
				%
				\begin{equation}
				\left\{ \begin{array}{llll}
				\dfrac{da_{lm}}{dt} 		& = \dsum_{p = 0}^{l} \dsum_{q = -\infty}^{\infty} \dfrac{da_{lmpq}}{dt} \\[1.2 em]
				\dfrac{de_{lm}}{dt} 		& = \dsum_{p = 0}^{l} \dsum_{q = -\infty}^{\infty} \dfrac{de_{lmpq}}{dt} \\[1.2 em]
				\dfrac{di_{lm}}{dt} 		& = \dsum_{p = 0}^{l} \dsum_{q = -\infty}^{\infty} \dfrac{di_{lmpq}}{dt} \\[1.2 em]
				\dfrac{d\Omega_{lm}}{dt} 	& = \dsum_{p = 0}^{l} \dsum_{q = -\infty}^{\infty} \dfrac{d\omega_{lmpq}}{dt}\\[1.2 em]
				\dfrac{d\omega_{lm}}{dt} 	& = \dsum_{p = 0}^{l} \dsum_{q = -\infty}^{\infty} \dfrac{d\Omega_{lmpq}}{dt} \\[1.2 em]
				\dfrac{dM_{lm}}{dt}		& = n + \dsum_{p = 0}^{l} \dsum_{q = -\infty}^{\infty} \dfrac{dM_{lmpq}}{dt}
				\end{array}\right.
				\label{eq:Kaula_LPE_2}
				\end{equation}
				%
				\paragraph{\GMVred{III.} \myul[GMVred]{Periodic effects.} \\}
				%
				\indent Equation \eqref{eq:Kaula_LPE_1} can be integrated with respect to time. The variational equation of the semimajor axis equation is used as an example. As stated before, the mean elements are substituted in the right-hand side of the equation. As a first order approximation, those mean elements are calculated under a $J_2$ perturbed gravity field (through equation \eqref{eq:J2_mean_prop}).\\
				%
				\indent Integrating \eqref{eq:Kaula_LPE_1} with respect to time leads to:
				%
				\begin{equation}
				\begin{array}{ccc}
				& da_{lmpq} = \dfrac{2\mu a_e^l}{na^{l+2}} F_{lmp} G_{lpq} (l - 2p + q)\dfrac{ d S_{lmpq}}{d \nu} dt  \\[1.2em]
				\xLongrightarrow{\int} & \Delta a_{lmpq} = \dfrac{2\mu a_e^l}{na^{l+2}} F_{lmp} G_{lpq} (l - 2p + q) \dint \left( \dfrac{d\nu}{dt} \right)^{-1} dS_{lmpq} \\
				\end{array}
				\label{eqCh4:LPE_a}
				\end{equation}
				%
				\indent The secular motions are known to be the dominant perturbation in most Earth satellites. That leads to the approximation that the rate of change of the phase angle $\nu$ is due mainly to the secular rates, that is:
				%
				\begin{equation}
				\dfrac{d\nu}{dt} \approx (l - 2p) \dot{\omega}^{(s)} + (l - 2p + q) \dot{M}^{(s)} + m \left( \dot{\Omega}^{(s)}  - \dot{\Theta}^{(s)}\right)
				\label{eqCh4:nu_dot} 
				\end{equation}
				%
				\indent Substituting \eqref{eqCh4:nu_dot} into \eqref{eqCh4:LPE_a} and integrating $dS_{lmpq}$ into $S_{lmpq}$ yields:
				%
				\begin{equation}
				\Delta a_{lmpq} = \dfrac{2\mu a_e^l}{na^{l+2}} \dfrac{F_{lmp} G_{lpq} (l - 2p + q)  S_{lmpq}}{(l - 2p) \dot{\omega} + (l - 2p + q) \dot{M} + m \left( \dot{\Omega}  - \dot{\Theta}\right)}
				\end{equation}
				%
				\noindent where the superscript $^{(s)}$ has been dropped for simplicity. Proceeding in the same way with the rest of the equations lead to:
				%
				\begin{equation}
				\left\{ \begin{array}{llll}
				\Delta a_{lmpq} 		& = \dfrac{2\mu a_e^l}{na^{l+2}} \dfrac{F_{lmp} G_{lpq} (l - 2p + q)  S_{lmpq}}{\left[(l - 2p) \dot{\omega} + (l - 2p + q) \dot{M} + m \left( \dot{\Omega}  - \dot{\Theta}\right)\right]} \\[1.5 em]
				\Delta e_{lmpq} 		& = \dfrac{\mu a_e^l \eta}{na^{l + 3} e} \dfrac{F_{lmp} G_{lpq} \left[ \left( l - 2p + q\right) \eta - \left(l - 2p\right)\right] S_{lmpq}}{\left[(l - 2p) \dot{\omega} + (l - 2p + q) \dot{M} + m \left( \dot{\Omega}  - \dot{\Theta}\right)\right]} \\[1.5 em]
				\Delta i_{lmpq} 		& = \dfrac{\mu a_e^l}{na^{l + 3} \eta \sin i}\dfrac{F_{lmp} G_{lpq} S_{lmpq} \left[ \left( l - 2p \right) \cos i - m\right]}{\left[(l - 2p) \dot{\omega} + (l - 2p + q) \dot{M} + m \left( \dot{\Omega}  - \dot{\Theta}\right)\right]} \\[1.5 em]
				\Delta \Omega_{lmpq} 	& = \dfrac{\mu a_e^l}{na^{l + 3} \eta \sin i} \dfrac{G_{lpq} \overline{S}_{lmpq}\dfrac{ dF_{lmp} }{di}}{\left[ (l - 2p)\dot{\omega} + (l - 2p + q) \dot{M} + m \left( \dot{\Omega}  - \dot{\Theta}\right) \right]} \\[1.5 em]
				\Delta \omega_{lmpq}	& = \dfrac{\mu a_e^l}{na^{l + 3} \eta } \dfrac{\overline{S}_{lmpq} \left( \dfrac{\eta^2}{e} F_{lmp} \dfrac{d G_{lpq}}{d e} - \dfrac{\cos i}{\sin i} G_{lpq} \dfrac{dF_{lmp}}{di} \right)}{\left[ (l - 2p)\dot{\omega} + (l - 2p + q) \dot{M} + m \left( \dot{\Omega}  - \dot{\Theta}\right) \right]}\\[1.5 em]
				\Delta M_{lmpq}		& = \dfrac{\mu a_e^l}{n a^{l + 3}}\dfrac{F_{lmp} \overline{S}_{lmpq} \left[2(l+1)G_{lpq} - \dfrac{\eta^2}{e} \dfrac{dG_{lpq}}{de}\right] }{\left[ (l - 2p)\dot{\omega} + (l - 2p + q) \dot{M} + m \left( \dot{\Omega}  - \dot{\Theta}\right) \right]}
				\end{array}\right.
				\label{eq:LPE_int}
				\end{equation}
				%
				\indent A quick look at the equations reveal two inconvenient cases:
				%
				\begin{itemize}
				\item[\GMVred{I.}] \myul[GMVred]{Secular terms:} Their indices are such that the phase angle derivative is not defined (zero), and as that lies in the denominator, it makes the solution divergent. This is tackled in more detail in \cite{Kaula}, section 3.6.  and in \cite{Chao}, sections 4.4-4.6.
				%
				\item[\GMVred{II.}] \myul[GMVred]{Near equatorial or near circular orbits:} If any of $e$ or $i$ is close to zero, the ascending node, argument of perigee and mean anomaly perturbations become absurdly large and meaningless. This concern will be approached later, in the conclusions
				\end{itemize}
				%
				\indent However, these equations, when summed up in $p$ and $q$ (for a given $l$ and $m$) can be understood as the oscillating part of the osculating elements. That is, if one adds up the already computed mean elements with these contributions, the osculating elements are obtained. To establish a parallelism with Brouwer's theory, the contributions $\Delta \bullet _{lmpq}$ can be understood as the derivative of the generating function in some way: that is, the difference between the osculating and the mean elements expressed as a function of the latter. Mathematically, denoting just for this case the mean elements with an overline:\\
				%
				\begin{equation}
				\xi = \overline{\xi} + \dsum_{p, q}^{\text{periodic}} \Delta \xi_{lmpq} (\overline{a}, \overline{e}, \overline{i}, \overline{\Omega}, \overline{\omega}, \overline{M}, \overline{\Theta})
				\label{eqCh4:Kaula_M2O}
				\end{equation}
				%
				\noindent where $\xi$ denotes any of $a, e, i, \Omega, \omega, M$. Equation \eqref{eqCh4:Kaula_M2O} is nothing but a linear mean to osculating transformation. 
				%
				%
				\paragraph{\GMVred{IV.}\myul[GMVred]{Results: Kaula vs Brouwer-Lyddane and High-Fidelity.} \\}
				%
				\indent Kaula's theory can be leveraged to derive a mean to osculating transformation, which can be used in a similar form to the one shown before in section \ref{secCh4:BL_vs_HiFi}. In this case, and in order to analyse the effect only of the mean to osculating transformation, the process is the following:
				%
				\begin{itemize}
				\item[\GMVred{\nth{1}}]: Convert the osculating elements to mean through the Brouwer-Lyddane transformation.
				%
				\item[\GMVred{\nth{2}}]: Propagate the mean elements.
				%
				\item[\GMVred{\nth{3}}]: Calculate each of the contributions (\ie $\Delta \xi_{lmpq}$) and add them up to the mean elements, getting hence the osculating.
				\end{itemize}
				%
				\indent This conversion will be compared firstly against a High-Fidelity propagation of the same scenario, and afterwards, the deviation from truth will be compared with the one obtained through the Brouwer theory with Lyddane's modification. Three scenarios will be evaluated: one in which the eccentricity is not too low (so as to avoid the aforementioned singularity) and two with specially low eccentricity, in order to evaluate the effects of this situation. All of them are specified in \ref{tabCh4:Kaula_scenarios}:
				%
				\begin{table}[!htb]
				\begin{center}
				\begin{tabular}{|a|c|c|c|c|c|c|}
				\hline 
				\hline
				\rowcolor{Gray!30}
				\textbf{Scenario} & $\bm a$[m] & $\bm e$[--] & $\bm i$[rad] & $\bm \Omega$ [rad] & $\bm\omega$ [rad] & $\bm M$ [rad] \\ 
				\hline 
				\textbf{1 (elliptic)} & 7078135 & 0.1 & 1.7139 & 0.1640 & 1.0472 & 5.2377 \\ 
				\hline 
				\textbf{2 (near-circular)} & 7078135 & 0.01 & 1.7139 & 0.1640 & 1.0472 & 5.2377 \\ 
				\hline 
				\textbf{2 (near-circular)} & 7078135 & 0.001 & 1.7139 & 0.1640 & 1.0472 & 5.2377 \\ 
				\hline 
				\end{tabular} 
				\end{center}
				\caption{Scenarios for testing Kaula's theory.}
				\label{tabCh4:Kaula_scenarios}
				\end{table}
				%
				\clearpage
				%
					\subparagraph{\GMVred{IV.A.} \myul[GMVred]{Scenario 1: $\bm{e = 0.1}$.} \\}
					%
					\indent Figure \ref{figCh4:01} shows a very tight correlation between Kaula's theory and the truth. The error is of the same order as the one obtained by Brouwer's theory (except for the mean anomaly), but in any case, it is always below an acceptable threshold (lower than 0.1\%). Although more scenarios should be tested, the generality of this scenario (retrograde, eccentric, non-zero orbital elements) suggests that the theory works, at least for nonsingular cases.
					%
					\begin{figure}[ht]
					\begin{changemargin}{-2.5cm}{-0.5cm}
					\begin{adjustbox}{width=1.2\textwidth}
					\centering
					\medskip
					\begin{subfigure}[t]{\linewidth}
					\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_V_{20}__Osculating_elements_(Kaula_vs_Hi_Fi)_(e___0_1)}
					\caption{Kaula's conversion vs Hi-Fi.}
					\label{figCh4:Kaula_vs_HiFi_01}
					\end{subfigure}
					\end{adjustbox}
					\end{changemargin}
					\end{figure}
					\begin{figure}
					\centering
					\begin{changemargin}{-2.5cm}{-0.5cm}
					\begin{adjustbox}{width=1.2\textwidth}
					\ContinuedFloat
					\begin{subfigure}[t]{\linewidth}
					\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_V_{20}__Deviation_from_truth_(e___0_1)}
					\caption{Deviation from truth.}
					\label{figCh4:diff_truth_01}
					\end{subfigure}
					\end{adjustbox}
					\end{changemargin}
					\caption{Results of Kaula's conversion for scenario 1 ($e = 0.1)$.}
					\label{figCh4:01}
					\end{figure}
					%
					\FloatBarrier
					%
					\subparagraph{\GMVred{IV.B.} \myul[GMVred]{Scenario 2: $\bm{e = 0.01}$.} \\}
					%
					\indent However, the results for $e = 0.01$, shown in figure \ref{figCh4:001} are not as good. Error in mean anomaly and argument of perigee grow by at least one order of magnitude ($\approx 1 \%$), and although it might be acceptable, it shows the nature of the behaviour of this model: low eccentricities make it inaccurate.
					\begin{figure}[ht]
					\begin{changemargin}{-2.5cm}{-0.5cm}
					\begin{adjustbox}{width=1.2\textwidth}
					\centering
					\medskip
					\begin{subfigure}[t]{\linewidth}
					\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_V_{20}__Osculating_elements_(Kaula_vs_Hi_Fi)_(e___0_01)}
					\caption{Kaula's conversion vs Hi-Fi.}
					\label{figCh4:Kaula_vs_HiFi_001}
					\end{subfigure}
					\end{adjustbox}
					\end{changemargin}
					\end{figure}
					\begin{figure}
					\centering
					\begin{changemargin}{-2.5cm}{-0.5cm}
					\begin{adjustbox}{width=1.2\textwidth}
					\ContinuedFloat
					\begin{subfigure}[t]{\linewidth}
					\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_V_{20}__Deviation_from_truth_(e___0_01)}
					\caption{Deviation from truth.}
					\label{figCh4:diff_truth_001}
					\end{subfigure}
					\end{adjustbox}
					\end{changemargin}
					\caption{Results of Kaula's conversion for scenario 2 ($e = 0.01)$.}
					\label{figCh4:001}
					\end{figure}
					%
					\FloatBarrier
					%
					\subparagraph{\GMVred{IV.C.} \myul[GMVred]{Scenario 3: $\bm{e = 0.001}$ }\\}
					%
					\indent As it could be expected from the previous results, the scenario with the lowest eccentricity yields the worst results. It is the first time that it can be clearly seen in the first figure (\ref{figCh4:Kaula_vs_HiFi_0001}), with huge deviations in eccentricity, argument of perigee and mean anomaly, which are unsurprisingly the ones that feature the inverse of the eccentricity in their oscillations. One remarkable defect is that eccentricity reaches negative values, which lacks any physical meaning whatsoever.
					%
					\begin{figure}[ht]
					\begin{changemargin}{-2.5cm}{-0.5cm}
					\begin{adjustbox}{width=1.2\textwidth}
					\centering
					\medskip
					\begin{subfigure}[t]{\linewidth}
					\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_V_{20}__Osculating_elements_(Kaula_vs_Hi_Fi)_(e___0_001)}
					\caption{Kaula's conversion vs Hi-Fi.}
					\label{figCh4:Kaula_vs_HiFi_0001}
					\end{subfigure}
					\end{adjustbox}
					\end{changemargin}
					\end{figure}
					\begin{figure}
					\centering
					\begin{changemargin}{-2.5cm}{-0.5cm}
					\begin{adjustbox}{width=1.2\textwidth}
					\ContinuedFloat
					\begin{subfigure}[t]{\linewidth}
					\centering\includegraphics[width=\linewidth]{Chapters/Chapter_04/High_quality/_due_to_V_{20}__Deviation_from_truth_(e___0_001)}
					\caption{Deviation from truth.}
					\label{figCh4:diff_truth_0001}
					\end{subfigure}
					\end{adjustbox}
					\end{changemargin}
					\caption{Results of Kaula's conversion for scenario 3 ($e = 0.001)$.}
					\label{figCh4:0001}
					\end{figure}
					%
					\FloatBarrier
					%
			\subsubsection{Conclusions.}
			%
			\indent Kaula's theory has been validated, with the only setback of the singularities for null eccentricity or inclination. However, this should be somewhat easily tackled by the usage of nonsingular elements, such as Delaunay's or equinoctials. It seems like the functions $G_{lpq}$ and $F_{lmp}$ have no issue with this, so the source of this inconvenience is the inherent singularities of the Keplerian elements (through the LPEs).\\
			%
			\indent Future work should then first focus on the implementation of a equinoctial form of the LPEs, to then move on to the usage of this transformation as a mean to construct a more accurate STM. This involves of course the inclusion of higher order harmonics, although that should not be any big issue.