\chapter{Relative dynamics around elliptic reference orbits.}
%
\label{chap: Eccentric}
%
\section{Introduction.}
%
\indent In the previous chapter, the Clohessy-Wiltshire set of equations of motion has been analyzed. Getting them from Newton's law required the fulfillment of two assumptions. Firstly, the distance between deputy and chief must be negligible compared to either spacecraft's orbital radius. This is usually the case when dealing both with formation flying and rendez-vous maneuvers. The second assumption is that both orbits are near-circular ($e<<1$), which is not as acceptable as the first one. This is specially relevant on formation flying, as the timescale is usually large enough to experience sensible deviations. \\
%
\indent Conceptually, there are some obvious differences between near-circular and eccentric orbits. First of all, orbital radius varies over time, which means that, at every point, the spacecraft is radially closing or moving away from the central body (\ie the Earth). But more importantly, the angular velocity is no longer constant, which means that the non-inertial effects when analyzing the relative motion are not constant. That will surely make it harder to get analytical expressions, though through some simplifications, it may be done.\\
%
\indent For this reason, several motion models for elliptic orbits have been developed \cite{Sullivan}. Both linear and nonlinear models are present in the literature, though the first ones are the most usually employed. Tschauner and Hempel \cite{Tschauner_Hempel} developed a linear, first-order model via the truncation of the Taylor series expansion of the differential gravity. The so-called Tschauner-Hempel equations were widely used at the time, as they are consistent with the Hill/Clohessy-Wiltshire (HCW) model. Nonetheless, they were subsequently improved, due to the existence of singularities in the in-plane motion. Carter \cite{Carter} provides a non-singular solution for this issue. \\
%
\indent Instead of these solutions, the motion model used for elliptic, unperturbed orbits in this thesis is one developed by Yamanaka and Ankersen \cite{Yamanaka_ankersen} (YA onwards). It results in a fairly simpler STM, which is generally considered the state-of-the-art solution for linear propagation of the relative position and velocity in eccentric orbits. It will actually be used in the PROBA-3 mission, which flies in a highly elliptical orbit.\\
%
\indent During this chapter, we will firstly develop YA's approach for the motion model and their proposed solution for it. This enables in turn to develop the YA STM, which will be duly tested with their own scenarios. Lastly, orbit safety concerns will be approached, extending the prior knowledge from near-circular orbits to arbitrarily elliptical, as done by Peters and Noomen \cite{Peters_Noomen}.
%
\section{Motion model and STM.}
%
%
 	\subsection{Simplification of equations of motion: YA solution.}
	%
	\indent As developed in section \ref{sec: Diff_eqs_prox}, the differential equations for proximity relative motion are:
	%
	\begin{equation}
	\left\{
	\begin{array}{c}
	\ddot{x}\\
	\ddot{y}\\
	\ddot{z}
	\end{array}\right\}
	= 
	\left\{
	\begin{array}{c}
	- k \omega^{3/2} x + 2\omega \dot{z} + \dot{\omega} z + \omega^2 x	\\
	-k \omega^{3/2} y \\
	2k\omega^{3/2} z - 2 \omega \dot{x} - \dot{\omega} x + \omega^2 z
	\end{array}\right\}
	+ \underline{a}_f + \underline{a}_{D, d} - \underline{a}_{C, d}
	\label{eqCh3: Diff_eqs_prox}
	\end{equation}
	%
	\indent In this chapter, we will focus solely on the unperturbed version of this problem, that is, $\underline{a}_f = \underline{a}_{D, d} = \underline{a}_{C, d} = \underline{0}$. A slightly more general approach is to assume that, if dealing with perturbed motion, the perturbation acceleration is equal on either body. The main difference now with respect to Hill equations (CITE HILL EQUATIONS) is that the angular rate $\omega$ is now time-varying, whereas before it was constant ($\omega = n = \const $). This fact completely changes the character of the mathematical problem: the coefficient matrix is no longer constant.\\
	%
	\indent It is here where Yamanaka and Ankersen, following Carter's approach, implement two changes. Firstly, chief's true anomaly $\theta$ is adopted as the independent variable instead of time. That changes the derivative definition, and for a certain variable $\xi$, the conversion from time to true anomaly derivatives is as follows:
	%
	\begin{subequations}
	\label{eqCh3:xi}
	\begin{alignat}{4}[left=\empheqlbrace]
	&\dfrac{d\xi}{dt} && =  \dfrac{d\xi}{d\theta} \dfrac{d\theta}{dt} = \omega \dfrac{d\xi}{d\theta} && \Rightarrow \dot{\xi} =\omega \xi^{\prime} \label{eqCh3:First_dt}\\ 
	&\dfrac{d^2\xi}{dt^2} && = \dfrac{d}{dt}\left(\dfrac{d\xi}{dt}\right)= \omega \dfrac{d\omega}{d\theta} \dfrac{d\xi}{d\theta} +\omega^2 \dfrac{d^2 \xi}{dt^2}&&  \Rightarrow  \ddot{\xi} = \omega^2 \xi^{\prime\prime} + \omega \omega^{\prime} \xi^{\prime} \label{eqCh3:Second_dt}
	\end{alignat}
	\end{subequations}
	
	%
	\noindent where $\omega^{\prime}$ is calculated by simply using the angular momentum definition:
	%
	\begin{equation}
	\omega = \dfrac{h}{R^2} = \dfrac{h}{p^2} \left( 1 + e \cos\theta\right)^2 = k^2 \rho^2 \Rightarrow \omega\prime = 2 k^2\rho \rho^{\prime} = -2k^2 e \sin\theta \rho
	\label{eqCh3: omegaprime}
	\end{equation}
	%
	\indent Substituting \eqref{eqCh3:First_dt}, \eqref{eqCh3:Second_dt} and \eqref{eqCh3: omegaprime} into \eqref{eqCh3: Diff_eqs_prox} yields:
	%
	\begin{subequations}
	\label{eqCh3: primeprime} 
	\begin{alignat}{4}[left=\empheqlbrace]
	&\rho x^{\prime \prime}-2 e \sin \theta x^{\prime}-e \cos \theta x &&=2 \rho z^{\prime}-2 e \sin \theta z \\ 
	&\rho y^{\prime \prime}-2 e \sin \theta y^{\prime} &&=-y \\ 
	&\rho z^{\prime \prime}-2 e \sin \theta z^{\prime}-(3+e \cos \theta) z &&=-2 \rho x^{\prime}+2 e \sin \theta x 
	\end{alignat}
	\end{subequations}
	%
	\indent Once this change of variable has been applied, the following transformation is performed:
	%
	\begin{equation}
	\left\{
	\begin{array}{c}
	\widetilde{x}\\
	\widetilde{y}\\
	\widetilde{z}
	\end{array}\right\}
	= 
	\left( 1 + e \cos\theta\right)
	\left\{
	\begin{array}{c}
	x\\
	y\\
	z
	\end{array}\right\}
	\label{eqCh3:rho_tx}
	\end{equation}
	%
	\noindent which, if substituted in \eqref{eqCh3: primeprime}, lead to the rather simple following set of equations:
	%
	\begin{subequations}
	\label{eqCh3: primeprime} 
	\begin{alignat}{4}[left=\empheqlbrace]
	&\label{eqCh3: tildeprime_x}\widetilde{x}^{\prime\prime} = && 2 \widetilde{z}^{\prime} \\
	&\label{eqCh3: tildeprime_y}\widetilde{y}^{\prime\prime} = && -\widetilde{y}\\
	&\label{eqCh3: tildeprime_z}\widetilde{z}^{\prime\prime} = && 3\dfrac{\widetilde{z}}{\rho} -2 \widetilde{x}^{\prime} 
	\end{alignat}
	\end{subequations}
	%
	\indent The initial conditions that complete the initial value problem (IVP) can be written as:
	%
	\[
	\left\{\begin{array}{c}
	\widetilde{x} \\
	\widetilde{y} \\
	\widetilde{z} 
	\end{array}\right\}(\theta_0) = 
	\left\{\begin{array}{c}
	\widetilde{x}_0 \\
	\widetilde{y}_0 \\
	\widetilde{z}_0 	
	\end{array}\right\}
	= (1 + e\cos\theta_0) 
	\left\{\begin{array}{c}
	x_0 \\
	y_0 \\
	z_0 
	\end{array}\right\}
	\]
	%
	\paragraph{Solution of the simplified set of equations. \\}
	%
	\indent It is rather obvious that equations \eqref{eqCh3: tildeprime_x}, \eqref{eqCh3: tildeprime_y}, \eqref{eqCh3: tildeprime_z} feature a decoupling between in-plane components (x-z) and out-of-plane (y). The latter can easily be solved as:
	%
	\begin{equation}
	\widetilde{y} = K_{y1} \sin\theta + K_{y2} \cos\theta
	\label{eqCh3: OOP_sol}
	\end{equation}
	%
	\noindent while for the in-plane motion, equation \eqref{eqCh3: tildeprime_x} must be first integrated, then introduced into \eqref{eqCh3: tildeprime_z}, yielding:
	%
	\begin{equation}
	\widetilde{z}^{\prime\prime} + \left( 4 - \dfrac{3}{\rho} \right) \widetilde{z} = - 2 K_{x1}
	\label{eqCh3: IP_eqz}
	\end{equation} 
	%
	\noindent with $\widetilde{x}$ is calculated from $\widetilde{z}$ as:
	%
	\begin{equation}
	\widetilde{z}^{\prime} = 2 \widetilde{z} + K_{x1}
	\label{eqCh3: IP_eqx}
	\end{equation}
	%
	\noindent where $K_i$ is the set of integration constants, derived from the prescribed initial conditions. The relation between them will be later described.\\
	%
	\indent The task at hand now is to solve \eqref{eqCh3: IP_eqz}. Yamanaka and Ankersen propose a new solution to it, whose mathematical development is explained in  \cite{Yamanaka_ankersen}. Bottom line is that, the solution for $\widetilde{z}$ is:
	%
	\begin{equation}
	\widetilde{z} = K_{z1} \rho\sin\theta + \left(K_{z2} - \dfrac{K_{x1}}{e}\right) \rho\cos\theta - K_{z2} e\left(2 - 3 e\rho\sin\theta J\right)
	\label{eqCh3: z_tilde}
	\end{equation}
	%
	\noindent where:
	%
	\[
	J = k^2 (t - t_0)
	\]	
	Substituting into \eqref{eqCh3: IP_eqx} and integrating:
	%
	\begin{equation}
	\widetilde{x} = K_{x2} - K_{z1} \cos\theta \left(\rho + 1\right) + \left(K_{z2} - \dfrac{K_{x1}}{e}\right) \sin\theta \left(\rho + 1\right) - 3 K_{z2} e\rho^2 J
	\end{equation}	
	%
	\indent Redefining the integral constants for simplicity as:
	%
	\[
	K_1 \equiv K_{x2} \qquad K_2 \equiv K_{z1} \qquad K_3 = \left(K_{z2} - \dfrac{K_{x1}}{e}\right) \qquad K_{4} = - K_{z2} e
	\]
	%
	\noindent and using the following simplified notation
	%
	\[
	s = \rho \sin\theta \qquad c = \rho \cos\theta	
	\]
	%
	\noindent the solution of the in-plane dynamics turns fairly simpler:
	%
	\begin{subequations} 
	\begin{alignat}{4}[left=\empheqlbrace]
	&\label{eqCh3: x_tilde}\widetilde{x} && = K_1 - K_2 c \left(1 + \frac{1}{\rho}\right) + K_3 s \left(1 + \frac{1}{\rho}\right) + 3 K_4 \rho^2 J \\
	&\label{eqCh3: z_tilde}\widetilde{z} && = K_2 s + K_3 c + K_4 \left(2 - 3 e s J\right)
	\end{alignat}
	\end{subequations}
	%
	\indent By simply differentiating the latter equations, we can obtain the in-plane velocity components. Considering both position and velocity, a simple matrix form can be achieved:
	%
	\begin{equation}
	\left\{
	\begin{array}{c}
	\widetilde{x}\\
	\widetilde{z}\\
	\widetilde{v}_x\\
	\widetilde{v}_z\\
	\end{array}
	\right\} = 
	\left[ 
	\begin{array}{cccc}
	1 &  -c(1 + \rho^{-1}) & s(1 + \rho^{-1}) & 3 \rho^2 J \\
	0 & s & c & (2 - 3 e s J) \\
	0 & 2s & 2c - e & 3(1  - 2 e s J)\\
	0 & s^{\prime} & c^{\prime} & -3 e(s^{\prime} J + s / \rho^2 )
	\end{array}
	\right]
	\left\{
	\begin{array}{c}
	K_1\\
	K_2\\
	K_3\\
	K_4
	\end{array}
	\right\} \equiv
	\Phi_{\theta}\rvert_{IP} \: \underline{K}_{IP}
	\label{eqCh3: phi_theta_IP}
	\end{equation}
	%
	\noindent where:
	%
	\[
	s^{\prime} = \cos\theta + e\cos 2\theta \qquad c^{\prime} = - \left(\sin\theta + e \sin 2\theta \right)
	\]
	%
	\indent The out-of-plane problem can be expressed in this form as well:
	%
	\begin{equation}
	\left\{
	\begin{array}{c}
	\widetilde{y}\\
	\widetilde{v}_y
	\end{array}
	\right\} = 
	\left[ 
	\begin{array}{cccc}
	\cos\theta & \sin\theta \\
	-\sin\theta & \cos\theta
	\end{array}
	\right]
	\left\{
	\begin{array}{c}
	\widetilde{y}_0\\
	\widetilde{v}_{y0}
	\end{array}
	\right\} \equiv
	\Phi_{\theta}\rvert_{OOP} \: \underline{K}_{OOP}
	\label{eqCh3: phi_theta_OOP}
	\end{equation}
	%
	\subsection{YA STM and integration constants.}
	%
	\indent Our target is to obtain a state transition matrix, that is, a matrix which when fed a state vector at a given time, returns the state vector at a latter epoch. Generally speaking, said entity is built as:
	%
	\[
	\Phi_{\theta_0}^{\theta} = \Phi_{\theta} \Phi_{\theta_0}^{-1}	\Rightarrow \underline{x} \left(\theta\right) = \Phi_{\theta_0}^\theta \underline{x} \left(\theta_0 \right) 
	\]
	%
	\noindent where $\theta$ can be substituted by any independent variable, such as time. Yamanaka and Ankersen propose to merge the second part of the STM and the initial state vector, leading to the so-called pseudoinitial state vector, defined by:
	%
	\[
	\underline{\overline{x}}_0 =  \Phi_{\theta_0}^\theta \underline{x} \left(\theta_0 \right) 
	\]	
	%
	\noindent which is also called the YA element set. With this in mind, our target now is to obtain both matrices, which in fact can be built from the in- and out-of-plane parts, previously defined in \eqref{eqCh3: phi_theta_IP} and \eqref{eqCh3: phi_theta_OOP}.
	%
		\subsubsection{In-plane motion.}
		\indent The first component $\Phi_{\theta}$ was already defined as \eqref{eqCh3: phi_theta_IP}:
		%
		\begin{equation}
		\Phi_{\theta}\rvert_{IP} = \left[ 
		\begin{array}{cccc}
		1 &  -c(1 + \rho^{-1}) & s(1 + \rho^{-1}) & 3 \rho^2 J \\
		0 & s & c & (2 - 3 e s J) \\
		0 & 2s & 2c - e & 3(1  - 2 e s J)\\
		0 & s^{\prime} & c^{\prime} & -3 e(s^{\prime} J + s / \rho^2 )
		\end{array}
		\right]
		\label{eqCh3: phi_IP}
		\end{equation}
		%
		\indent In order to get $\Phi_{\theta_0}\rvert_{IP}^{-1}$, let us note that $J(\theta_0) = J(t_0) = 0$. Once applied that, the inverse is not so hard to compute, namely:
		%
		\begin{equation}
		\Phi_{\theta_0}\rvert_{IP}^{-1} = 
		\dfrac{1}{1 - e^2}		
		\left[ 
		\begin{array}{cccc}
		1 - e^2 	& 3e(s/\rho) \left(1 + \rho^{-1}\right) 	& -es\left(1 + \rho^{-1}\right) 	& 2 - ec 	\\
		0 			& -3(s/\rho) \left(1 + e^2/\rho\right) 	& s\left(1 + \rho^{-1}\right) 		& c - 2e 	\\
		0		 	& -3 		\left(e + c/\rho\right) 	& c\left(1 + \rho^{-1}\right) + e 	& -s 		\\
		0		 	& 3\rho + e^2 - 1 						& -\rho^2 						& es 
		\end{array}
		\right]_{\theta_0}
		\label{eqCh3: phi_inv_IP}
		\end{equation}
		%
		\subsubsection{Out-of-plane motion.}
		%
		\indent The out-of-plane equations require a less cumbersome manipulation. As we already have the full STM in \eqref{eqCh3: phi_theta_OOP}, we have to first divide it into the two subcomponents by substituting $\theta$ for $\theta - \theta_0$. Then, using trigonometric relations for the sum of sines and cosines, it is easy to pull both matrices apart as:
		%
		\begin{equation}
		\Phi_{\theta_0}^{\theta} = 
		\left[ 
		\begin{array}{cccc}
		\cos(\theta - \theta_0) & \sin(\theta - \theta_0) \\
		-\sin(\theta - \theta_0) & \cos(\theta - \theta_0)
		\end{array}
		\right] = 
		\left[ 
		\begin{array}{cccc}
		\cos\theta & \sin\theta  \\
		-\sin\theta & \cos\theta 
		\end{array}
		\right]
		\left[ 
		\begin{array}{cccc}
		\cos\theta_0 & -\sin\theta_0  \\
		\sin\theta_0 & \cos\theta_0
		\end{array}
		\right]
		\equiv 
		\Phi_{\theta} \Phi_{\theta_0}^{-1}
		\label{eqCh3:phi_OOP}
		\end{equation}
		%
		\indent This expression could have also been reached similarly to the in-plane counterpart. 
		%
		\subsubsection{Full matrices.}
		%
		\indent By simply but carefully placing the elements of \eqref{eqCh3: phi_IP}, \eqref{eqCh3: phi_inv_IP}, and \eqref{eqCh3:phi_OOP} in a 6x6 matrix, we can finally reach the full matrices as:
		%
		\begin{subequations}
		\begin{alignat}{2}
		&\label{eqCh3:phi_final} \Phi_{\theta} = 
		\left[
		\begin{array}{cccccc}
		1 	&    0 			&  -c  (1 + \rho^{-1})	& s  (1 + \rho^{-1})	&    0			&                  3 \rho^2 J \\
        0	&  \cos\theta 	&                   0	&                 0	&  \sin\theta 	&                              0\\
        0 	&  	0			&                  s	&                 c	&    0			&              2 - 3  e  s  J\\
        0	&    0			&              2  s		&         2  c - e	&    0			&       3  (1  - 2 e  s  J)\\
        0	& -\sin\theta   &                0 		&                 0&  \cos\theta 	&                              0\\
        0	&	0 			&             s^{\prime}	&            c^{\prime}&    0			& -3  e  (s^{\prime}  J + s/\rho^2)
		\end{array}
		\right] \\
		&\nonumber \Phi_{\theta_0}^{-1} = \dfrac{1}{1 - e^2}\times \\ 
		&\label{eqCh3:phi_inv_final}\left[
		\begin{array}{cccccc}
		1 - e^2	&    0 					&  3 e  (s/\rho)  (1 + \rho^{-1})		& -e s  (1 + \rho^{-1})	&    0						&                 2 - e c\\
        0		&  (1 - e^2) \cos\theta	&         0							&                 0		&  -(1 - e^2) \sin\theta 	&              0\\
        0 		&  	0					&     -3  (s/\rho)  (1 + e^2/\rho)	&   s  (1 + \rho^{-1})	&    0						&              c - 2e	\\
        0		&    0					&          -3  (c/\rho + e)			&  c  (1 + \rho^{-1}) + e	&    0						&      -s 		\\
        0		& (1 - e^2) \sin\theta 	&                0 					&                 0		&  (1 - e^2) \cos\theta 	&                              0\\
        0		&	0 					&             3  \rho + e^2 - 1		&           -\rho^2 	&    0						& e s
		\end{array}
		\right]
		\end{alignat}
		\end{subequations}
		%
		\subsubsection{Pseudo-initial state vector.}
		%
		\indent Finally, let us compute the so-called pseudoinitial conditions as defined before, namely:
		%
		\begin{alignat}{2}
		&\nonumber &&\left\{
		\begin{array}{c}
		\overline{x}_0 \\
		\overline{y}_0 \\
		\overline{z}_0 \\
		\overline{v}_{x0} \\
		\overline{v}_{y0} \\
		\overline{v}_{z0} 
		\end{array}
		\right\} =
		\Phi_{\theta_0}^{-1} \widetilde{\underline{x}}_0 = 
		\dfrac{1}{1 - e^2} \times \\
		&\label{eqCh3: Pseudo_ICs}&&\left[
		\begin{array}{cccccc}
		1 - e^2	&    0 					&  3 e  (s/\rho)  (1 + \rho^{-1})		& -e s  (1 + \rho^{-1})	&    0						&                 2 - e c\\
        0		&  (1 - e^2) C\theta	&         0							&                 0		&  -(1 - e^2) S\theta 	&              0\\
        0 		&  	0					&     -3  (s/\rho)  (1 + e^2/\rho)	&   s  (1 + \rho^{-1})	&    0						&              c - 2e	\\
        0		&    0					&          -3  (c/\rho + e)			&  c  (1 + \rho^{-1}) + e	&    0						&      -s 		\\
        0		& (1 - e^2) S\theta 	&                0 					&                 0		&  (1 - e^2) C\theta 	&                              0\\
        0		&	0 					&             3  \rho + e^2 - 1		&           -\rho^2 	&    0						& e s
		\end{array}
		\right]
		\left\{
		\begin{array}{c}
		\widetilde{x}_0 \\
		\widetilde{y}_0 \\
		\widetilde{z}_0 \\
		\widetilde{v}_{x0} \\
		\widetilde{v}_{y0} \\
		\widetilde{v}_{z0} 
		\end{array}
		\right\}
		\end{alignat}
		%
		\noindent where $C = \cos$ and $S = \sin$. Nonetheless, the right hand side vector $\underline{\widetilde{x}}_0$ is actually a transformation of a genuine LVLH state vector (see \eqref{eqCh3:rho_tx}), which is the true inputs of our relative dynamics problem. For that reason, it is necessary to map the transformed state vector $\underline{\widetilde{x}}$ from and to the original one $\underline{x}$. This is done through the matrix $T_{\theta}$ as follows:
		%
		\begin{equation}
		\underline{\widetilde{x}} = T_{\theta} \underline{x} \Rightarrow
		\left\{
		\begin{array}{c}
		\underline{\widetilde{r}}\\
		\underline{\widetilde{v}}
		\end{array}
		\right\}
		= \left[
		\begin{array}{cc}
		\rho \mathbb{I}_{3x3} 			& \mathbb{O}_{3x3} \\
		-e \sin\theta \mathbb{I}_{3x3} 	& \dfrac{1}{k^2 \rho} \eye_{3x3} 
		\end{array}
		\right]
		\left\{
		\begin{array}{c}
		\underline{r}\\
		\underline{v}
		\end{array}
		\right\}
		\label{eqCh3:T_theta}
		\end{equation}
		%
		\indent The combination of \eqref{eqCh3: Pseudo_ICs} and \eqref{eqCh3:T_theta} lead to a transformation between a LVLH state vector and the so-called Yamanaka-Ankersen element set, through the transformation matrix $T_{LVLH\to YA}$:
		%
		\begin{alignat}{2}
		&\nonumber && \underline{\overline{x}} \equiv \underline{x}_{YA} = \Phi_{\theta_0}^{-1} T_{\theta} \underline{x}_{LVLH} = \dfrac{1}{1 - e^2} \times \\
		&\nonumber && \left[
		\begin{array}{cccccc}
		1 - e^2	&    0 					&  3 e  (s/\rho)  (1 + \rho^{-1})		& -e s  (1 + \rho^{-1})	&    0						&                 2 - e c\\
        0		&  (1 - e^2) \cos\theta	&         0							&                 0		&  -(1 - e^2) \sin\theta 	&              0\\
        0 		&  	0					&     -3  (s/\rho)  (1 + e^2/\rho)	&   s  (1 + \rho^{-1})	&    0						&              c - 2e	\\
        0		&    0					&          -3  (c/\rho + e)			&  c  (1 + \rho^{-1}) + e	&    0						&      -s 		\\
        0		& (1 - e^2) \sin\theta 	&                0 					&                 0		&  (1 - e^2) \cos\theta 	&                              0\\
        0		&	0 					&             3  \rho + e^2 - 1		&           -\rho^2 	&    0						& e s
		\end{array}
		\right] \times\\
		&\label{eqCh3:LVLH2YA}&&
		\left[
		\begin{array}{cccccc}
		\rho  			& 0 			& 0 			&  						&  						&  	\\
		0 				& \rho 			& 0 			& 						& \mathbb{O}_{3x3} 		&  	\\
		0  				& 0 			& \rho 			&  						&  						&  	\\
		-e \sin\theta  	& 0 			& 0 			& \dfrac{1}{k^2 \rho} 	& 0 					& 0 \\
		0  				& -e \sin\theta & 0 			& 0 					& \dfrac{1}{k^2 \rho} 	& 0 \\
		0  				& 0 			& -e \sin\theta	& 0 					& 0 					& \dfrac{1}{k^2 \rho} \\
		\end{array}
		\right]
		\underline{x}_{LVLH}
		\end{alignat}
		%
		\subsubsection{Solution scheme.}
		%
		\indent The target is to compute the relative state vector at a certain time epoch, given the following inputs:
		%
		\begin{itemize}
		\item $\underline{x}_{LVLH}\rvert_{0}$: Initial LVLH relative state vector (see section \ref{secAppB:LVLH}).
		%
		\item $\underline{KOE}_C\rvert_{0}$: Initial chief's Keplerian OE set (see section \ref{secAppA:KOE}).
		%
		\item $t$: Time elapsed from the initial time epoch to the desired one.
		%
		\end{itemize}
		\indent This is, as explained in appendix \ref{chap:App_software}, the usual workflow for orbit propagation. With all the operations and transformations previously described, this process is graphically described in \ref{tikz:Workflow_ecc_integrator}.
		%
		\input{Chapters/Chapter_03/tikz_ecc_integrator}
		%
	\subsection{Results: Comparison with HCW and Hi-Fi propagation.}
	%
	\indent Once we have defined the complete model for orbit propagation, it is turn to discuss how does it compare with respect to the previous solution (HCW) and the High-Fidelity propagation. The workflows for both of these approach are available at \textbf{REF HCW DIAGRAM} and \textbf{REF HIFI DIAGRAM}. \\
	%
	\indent Now, let us define (rather cite) a scenario to test this method. In order to be able to compare the results with the method source, we will use the scenarios defined by Yamanaka and Ankersen \cite{Yamanaka_ankersen}. As we know, if no body-dependent perturbations are considered, a scenario is completely defined by:
	%
	\begin{itemize}
	\item \underline{Chief's reference orbit} (Keplerian OEs)
	% 
	\item \underline{Deputy's relative position and velocity with respect to chief} (LVLH frame)
	%
	\item \underline{Propagation values}: Time elapsed and numerical method for high-fidelity propagation(algorithm, timestep \ldots)
	\end{itemize}
	%
	\indent In this case, Yamanaka and Ankersen define them as:
	%
	\input{Chapters/Chapter_03/Scenarios_YA}
	%
	\indent Nonetheless, we must get the set of Keplerian OEs as defined in \ref{secAppA:KOE}. Firstly, let us compute the semimajor axis from the perigee height $h_p$ as:
	%
	\[
	h_p = a (1 - e) \Rightarrow a = \dfrac{h_p}{1 - e}
	\]
	%
	\indent Secondly, the mean anomaly is computed from the true anomaly and the eccentricity, as explained in \textbf{REF MEAN2TRUE}. Then, the Keplerian OEs for both scenarios are:
	%
	\begin{subequations}
	\begin{alignat}{3}[left=\empheqlbrace]
	& \underline{KOE}_1 && = (7.61861333\cdot 10^{6},\: 0.1,\: \pi / 6,\: 0,\: 0,\: 0.65125326) &&\quad\text{[m, --, rad, rad, rad, rad]} \\
	& \underline{KOE}_2 && = (2.28558400\cdot 10^{7}, \: 0.7,\: \pi / 6,\: 0,\: 0,\: 0.10811191]) &&\quad\text{[m, --, rad, rad, rad, rad]}
	\end{alignat}
	\end{subequations}
	%
	\indent Let us now proceed with the result evaluation.
	%
		\subsubsection{Scenario 1: $e = 0.1$.}
		%
%		
		\begin{figure}[!htb]
		\begin{changemargin}{-2.2cm}{-1cm}
		\begin{adjustbox}{width=1.2\textwidth}
		\centering
		\medskip
		\begin{subfigure}[t]{1.1\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_03/YA_scenario_1_(e___0_1)_IP}
		\caption{In-plane motion.}
		\label{figCh3:Scenario1_IP}
		\end{subfigure}
		\end{adjustbox}
		\end{changemargin}
		\end{figure}
		\begin{figure}
		\begin{changemargin}{-2.2cm}{-1cm}
		\begin{adjustbox}{width=1.2\textwidth}
		\ContinuedFloat
		\centering
		\begin{subfigure}[t]{1.2\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_03/YA_scenario_1_(e___0_1)_OOP}
		\caption{Out-of-plane motion.}
		\label{figCh3:Scenario1_OOP}
		\end{subfigure}
		\end{adjustbox}
		\end{changemargin}
		\caption{Scenario 1($e= 0.1$): Comparison between Hi-Fi, HCW and YA. }
		\label{figCh3:Scenario1}
		\end{figure}
		%
		\FloatBarrier
		%
		\subsubsection{Scenario 2: $e = 0.7$.}
		%
		\begin{figure}[ht]
		\begin{changemargin}{-2.2cm}{-1cm}
		\begin{adjustbox}{width=1.2\textwidth}
		\centering
		\medskip
		\begin{subfigure}[t]{\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_03/YA_scenario_2_(e___0_7)_IP}
		\caption{In-plane motion.}
		\label{figCh3:Scenario2_IP}
		\end{subfigure}
		\end{adjustbox}
		\end{changemargin}
		\end{figure}
		\begin{figure}
		\begin{changemargin}{-2.2cm}{-1cm}
		\begin{adjustbox}{width=1.2\textwidth}
		\ContinuedFloat
		\centering
		\begin{subfigure}[t]{\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_03/YA_scenario_2_(e___0_7)_OOP}
		\caption{Out-of-plane motion.}
		\label{figCh3:Scenario2_OOP}
		\end{subfigure}
		\end{adjustbox}
		\end{changemargin}
		\caption{Scenario 2 ($e= 0.7$): Comparison between Hi-Fi, HCW and YA. }
		\label{figCh3:Scenario2}
		\end{figure}
		%
		\FloatBarrier
		%
\section{Orbit safety in eccentric, unperturbed orbits.}
%
\indent As orbit safety has already been introduced in section \ref{sec:Orbit_safety}, we just need to extend it to eccentric orbits. This is neatly presented in \cite{Peters_Noomen}, whose main concern is linear cotangential transfers. As a quick summary, trajectory safety is tightly related to the notions of relative position, looking for avoiding collision by maintaining a certain distance and orientation between the spacecrafts.\\
%
\indent One substantial fact that differentiates eccentric and circular orbits is that orbital radius is no longer constant. As a consequence, orbital velocity is also time-varying. This two facts lead to the definition of the TAN frame (see \ref{sec:TAN_frame}), which embodies a set of characteristics that allow for a much simpler description of the relative motion. That is to say, as for near-circular orbits we used the LVLH frame, we will now use the TAN frame for describing the relative motion. Later on, said advantages will be duly looked at. \\
%
\indent This section starts by giving a brief description of the parametrization of the relative motion in the TAN frame. Secondly, general relative trajectories for eccentric reference orbits will be discussed, and finally, safe orbit families will be defined and represented, extending as well the eccentricity-inclination vector separation strategy.
%
	\subsection{Relative motion description in TAN frame.}
	%
	\indent In order to properly follow the herewith developed relations, it is recommended to first understand sections \ref{sec:C_ROE} and \ref{sec:TAN_frame}. As already explained, we analyze the radial and cross-track coordinates to ensure orbit safety, as along-track uncertainty is much larger. Our target is then to describe the relative motion in TAN frame, that is, to have a description of $(y_{TAN}, z_{TAN})$ in terms of some relative orbital elements, in a somewhat analog manner compared to \ref{sec:Orbit_safety}.\\
	%
	\indent The QNS relative OE set is quite useful in near-circular orbits, greatly simplifying the relative motion description. Nonetheless, this simplicity fades away for elliptic reference orbits. This is where the C relative OE set becomes useful. The elements $C_1$, $C_2$ and $C_3$ will somehow describe the radial coordinate, while $C_4$ is associated with the along-track position. Finally, $C_5$ and $C_6$ describe the cross-track relative motion. We can then draft a one-to-one relation between the QNS ROEs and the C ROEs, as shown in table \ref{tabCh3:QNS_C_correspondence}.\\
	%
	\input{Chapters/Chapter_03/QNS_C_correspondence}
	%
	\paragraph{\textcolor{GMVred}{I.} Parameter reformulation. \\}
	\indent The description we arrived at in \ref{sec:Orbit_safety} (see equation \ref{eqCh2:EI_1}) depended on the relative inclination and eccentricity $\delta i$ and $\delta e$ and the angles $\varphi$ and $\theta$. The complete $y-z$ motion in LVLH frame was then determined by four parameters: The amplitude of two oscillations and their respective phase angles. A similar formulation can be developed here for the C ROE set. Let us start by converting $C_2$ and $C_3$ into an radial amplitude $C_m$ and a radial phase angle $\alpha$ as \cite{Peters_Noomen}:
	%
	\begin{subequations}
	\label{eqCh3: Cm_alpha}
	\begin{alignat}{4}[left = \empheqlbrace]
	C_m 		&= \dsqrt{C_2^2 + C_3^2} \\[1em]
	\alpha 	&= \atantwo(C_3, C_2)
	\end{alignat}
	\end{subequations}
	% 
	\noindent that is, 
	%
	\begin{subequations}
	\label{eqCh3: C2_C3}
	\begin{alignat}{4}[left = \empheqlbrace]
	C_2 & = C_m \cos\alpha \\[1em]
	C_3 & = C_m \sin\alpha 
	\end{alignat}
	\end{subequations}
	%
	\indent Now it is turn to do the same for the cross-track component. The cross-track amplitude is defined by the ratio $\Lambda$, hand in hand with the cross-track phase $\beta$:
	%
	%
	\begin{subequations}
	\label{eqCh3:Lambda_beta}
	\begin{alignat}{4}[left = \empheqlbrace]
	\Lambda C_m 		&= \dsqrt{C_5^2 + C_6^2} \\[1em]
	\beta 	&= \atantwo(C_6, C_5)
	\end{alignat}
	\end{subequations}
	% 
	\noindent that is, 
	%
	\begin{subequations}
	\label{eqCh3:C5_C6}
	\begin{alignat}{4}[left = \empheqlbrace]
	C_5 & = \Lambda C_m \cos\beta \\[1em]
	C_6 & = \Lambda C_m \sin\beta 
	\end{alignat}
	\end{subequations}
	%
	\indent With these expressions at hand, the description turns easier and parallel to the developed for near-circular orbits.
	%
	\paragraph{\textcolor{GMVred}{II.} Radial and cross-track coordinates.}
	%
	\indent The TAN coordinates can be easily obtained from the C ROE set and the true anomaly of the chief $\theta$ as \cite[][appendix B] {Peters_Noomen}:
	%
	\begin{subequations}
	\label{eqCh3:yz_TAN}
	\begin{alignat}{4}[left = \empheqlbrace]
	\label{eqCh3:yTAN}\hat{y}_{TAN} & = \rho y_{TAN} = C_5 \sin\theta - C_6\cos\theta \\[1em]
	\label{eqCh3:zTAN}\hat{z}_{TAN} & = \rho \Theta z_{TAN} = -\left( C_1 + C_2 \cos\theta + C_3\sin\theta\right) 
	\end{alignat}
	\end{subequations}
	%
	\noindent where the variables with a hat denote the scaled variables (unlike the regular, unscaled ones). $\rho$ (defined as before) and $\Theta = \sqrt{2 \rho - eta^2}$ are the scaling factors. Substituting \eqref{eqCh3: C2_C3} and \eqref{eqCh3:C5_C6} into \eqref{eqCh3:yz_TAN} and applying trigonometric relations, we arrive to:
	%
	\begin{subequations}
	\label{eqCh3:yz_TAN_2}
	\begin{alignat}{4}[left = \empheqlbrace]
	\label{eqCh3:yTAN_2}\hat{y}_{TAN} & =  \Lambda C_m \sin\left(\tau - \tau_0\right) \\[1em]
	\label{eqCh3:zTAN_2}\hat{z}_{TAN} & =  C_m \cos\tau - C_1 
	\end{alignat}
	\end{subequations}
	%
	\noindent where $\tau = \theta - \alpha$ is the radial phase referred to the maximum radial separation and $\tau_0 = \beta - \alpha$ is the relative phase between radial and cross-track motion. Now we have arrived to a very similar expression compared to \eqref{eqCh2:EI_1}, especially considering that, for bounded trajectories, $C_1 = 0$. From a very primitive analysis, we see that $\tau_0$ will determine the shape of the $y-z$ motion, similarly to what $\varphi -  \psi$ did in near-circular orbits. 
%	
	\subsection{General trajectories and safe orbits.}
	%
		\subsubsection{Orbit families.}
		%
		\indent In this context, an orbit family is a set of relative orbits who share most of the defining elements (in particular, $C_1$, $C_m$, $e$ and $\tau_0$), being differenced just by the phase angle $\alpha$ (anomaly at which radial distance is maximum). Scaled variables are actually independent of $\alpha$, conversely to the unscaled ones. This will be later graphically portrayed. As a summary, table \ref{tabCh3:Orbit_family} shows the different elements which define an orbit family.
		%
		\input{Chapters/Chapter_03/Orbit_family_parameters}
		%
		\subsubsection{Eccentricity/inclination vector separation in eccentric orbits.}
		%
		\indent By simply looking at equation \eqref{eqCh3:yz_TAN_2}, it is clear that $\tau_0$ will determine the eccentricity/inclination vector relative orientation. As for the near-circular case, the parallel configuration takes place when both phases have the same value, that is:
		%
		\begin{align*}
		\beta = \alpha  \Rightarrow \tau_0 = 0 
		\end{align*}
		%
		\indent In that case, the scaled coordinates behave as:
		%
		\begin{subequations}
		\label{eqCh3:yz_TAN_e_i}
		\begin{alignat}{4}[left = \empheqlbrace]
		\label{eqCh3:yTAN_e_i}\hat{y}_{TAN} & =  \Lambda C_m \sin\tau  \\[1em]
		\label{eqCh3:zTAN_e_i}\hat{z}_{TAN} & =  C_m \cos\tau - C_1 
		\end{alignat}
		\end{subequations}
		%
		\noindent which is the equation of an ellipse with center at $(0, -C_1)$, a semimajor axis $C_m$ and semiminor axis $\Lambda C_m$. An antiparallel configuration is obtained if $\tau_0 = \pi$, exactly as for near-circular reference orbits. Nonetheless, the useful configuration is the parallel one, and that is why we will now analyze a safe orbit family with that characteristic.\\
		%
		\paragraph{\textcolor{GMVred}{I.} Scenario definition.\\}
		%
		\indent Our goal is to propagate a family of safe orbits, which as we know, is defined by (a) the chief's orbit and (b) the amplitudes and phase angles of the radial and cross-track components. In fact, only the eccentricity of the chief's orbit is required. Table \ref{tabCh3:Scenarios_safe_orbits} shows the two scenarios that have been chosen for this validation, as well as the different values of $\alpha$ within each family. 
		%
		\input{Chapters/Chapter_03/Scenarios_safe_orbits}
		%
		\paragraph{\textcolor{GMVred}{II. A.} Bounded trajectory case ($C_1 = 0$). \\}
		%
		\indent Figure \ref{figCh3:Safe_orbit_1} shows the scaled coordinates, the unscaled coordinates (one for each $\alpha$ value) and the lower and upper boundaries of the relative motion. They can be easily obtained from the scaled variables by applying the maximum and minimum scaling factors, respectively. That is:
		%
		\begin{equation}
		\left\{ \begin{array}{llll}
		y_{TAN, LB}  & = \dfrac{1}{\rho(\theta = 0)} \Lambda C_m \sin\tau  &= \dfrac{\Lambda C_m }{1 + e} \sin\tau \\[1.3em]
		z_{TAN, LB}  & = \dfrac{1}{\rho(\theta = 0) \Theta(\theta = 0)} C_m \cos\tau  &= \dfrac{ C_m }{(1 + e)^2} \cos\tau 
		\end{array} \right.
		\label{eqCh3:LB}
		\end{equation}
		%
		\begin{equation}
		\left\{ \begin{array}{llll}
		y_{TAN, UB}  & = \dfrac{1}{\rho(\theta = \pi)} \Lambda C_m \sin\tau  &= \dfrac{\Lambda C_m }{1 - e} \sin\tau \\[1.3em]
		z_{TAN, UB}  & = \dfrac{1}{\rho(\theta = \pi) \Theta(\theta = \pi)} C_m \cos\tau  &= \dfrac{ C_m }{(1 - e)^2} \cos\tau 
		\end{array} \right.
		\label{eqCh3:UB}
		\end{equation}
		%
		\begin{figure}[!htb]
		\centering\includegraphics[width = 0.7\linewidth]{Chapters/Chapter_03/Safe_orbit_C1_0}
		\caption{Safe orbit family: Scenario 1 ($C_1 = 0$).}
		\label{figCh3:Safe_orbit_1}
		\end{figure}
		%
		\FloatBarrier
		%
		\indent As $C_1 = 0$, the every member of the family is an ellipse is centered at the origin.
		%
		\paragraph{\textcolor{GMVred}{II. B.} Unbounded trajectory case ($C_1 = 0$). \\}		
		%
		\indent The orbit family for this second case is shown in figure \ref{figCh3:Safe_orbit_2}. The main difference now is that every orbit passes through the origin, as both boundaries collapse there.
		%
		\begin{figure}[!htb]
		\centering\includegraphics[width = 0.7\linewidth]{Chapters/Chapter_03/Safe_orbit_C1_10}
		\caption{Safe orbit family: Scenario 2 ($C_1 = C_m$).}
		\label{figCh3:Safe_orbit_2}
		\end{figure}
		%
		\FloatBarrier
		%
		\indent Besides analyzing the results by themselves, we can additionally compare them to a truth model (High-Fidelity). For this to be done, we have to (a) convert the C ROEs into Keplerian and (b) define some dummy values of the chief's orbit. An example of this can be seen in figure \ref{figCh3:PN_vs_HiFi}, where some members of the previously graphed families are shown. The chief's orbit is defined by the first case specified in \ref{tabCh3:Scenarios_YA}.
		%
		\begin{figure}[ht]
		\centering
		\medskip
		\begin{subfigure}[t]{.7\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_03/Safe_orbit_comp_C1_0}
		\caption{Scenario 1: No offset ($C_1 = 0$m).}
		\label{figCh3:PN_vs_HiFi_1}
		\end{subfigure}
		\end{figure}
		\begin{figure}
		\centering
		\ContinuedFloat
		\begin{subfigure}[t]{.7\linewidth}
		\centering\includegraphics[width=\linewidth]{Chapters/Chapter_03/Safe_orbit_comp_C1_10}
		\caption{Scenario 2: Offset ($C_1 = C_m = 10$m).}
		\label{figCh3:PN_vs_HiFi_2}
		\end{subfigure}
		\caption{Comparison between Peters-Noomen approach and High-Fidelity propagation.}
		\label{figCh3:PN_vs_HiFi}
		\end{figure}
		%
		\FloatBarrier
		%
