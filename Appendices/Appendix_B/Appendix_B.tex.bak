\chapter{Cartesian reference systems.}
%
\label{app:App_B}
%
\section{Introduction.}
%
\indent Cartesian states are, as mentioned in appendix \ref{app:App_A}, one of the two main alternatives to describe the state of a certain spacecraft (or celestial body). Though orbital elements (OEs) are generally more intuitive and meaningful, these states are quite critical for the description of both absolute and relative motion. Ultimately, and specially considering the latter, one wishes to know the relative orientation and linear distance between the involved bodies. During this appendix, a set of absolute and relative reference frames will be described and related through transformations, which have been used time and again along this thesis.
%
	\subsection{Inertial and rotating reference frames.}
	%
	\indent Technically, an inertial reference frame is one where Newton's law holds. Effectively, it is a frame which is not object of any acceleration whatsoever. It is then, when interpreted to the letter, an idealization, as there will always be any perturbation which disavows this assumption. Nonetheless, it is usual to neglect said perturbations up to a certain point, thus considering pseudo-inertial reference frames. From now on then, when inertial reference frames are mentioned they will be considered so, even though they are actually not. Along this thesis, both inertial and rotating frames will be considered, each bearing its different advantages and disadvantages.
	%
	\subsection{Absolute and relative frames.}
	%
	\indent Another distinction that will be made is between absolute and relative frames. In this thesis, absolute frames are those who are centered in the Earth's center of mass, while relative frames are defined with respect to a reference orbit (the chief's generally). Again, they have different scopes, though relations between them need to be developed.
	%
	\subsection{Time measurement.}
	%
	\indent Later it will be described how Earth's rotational state influences the dynamics of the spacecrafts, due to its non-homogeneous mass distribution. That leads to the need of precisely computing it, which in turn requires the time elapsed since a given epoch. This section intends to briefly describe the most usual conventions for time definition, without diving in technical considerations. For further description, see \cite{Time_handbook}. These conventions are:%
	%	
	\begin{itemize}
	% 
	\item[\GMVred{I.}] \myul[GMVred]{International Atomic Time (TAI)}: Physical timescale which is calculated through the measurement of cesium radiation. Lacks intuitive meaning, but acts as a ultra-high precision time system and reference for other timescales.
	%
	\item[\GMVred{II.}] \myul[GMVred]{Universal Time (UT1/UT2)}: Civil time system, which is defined by the right ascension of the mean Sun. It is not a continuous time system, varying as time passes.  
	%
	\item[\GMVred{III.}] \myul[GMVred]{Coordinated Universal Time (UTC)}: Civil time system, which is measured with TAI and synchronized with UT1 via leap seconds to get within 1-second range. It is then a non-continuous time system.
	%
	\item[\GMVred{IV.}] \myul[GMVred]{Terrestrial Time (TT)}: Civil time system, which is measured with TAI but has a delay with respect to it (32.184 seconds).
	\end{itemize}
	%
	\indent Figure \ref{fig:	Time_graph} shows more clearly the differences between them.
	%
	%
	\begin{figure}[!htb]
	\centering\includegraphics[width = 0.8\linewidth]{Appendices/Appendix_B/Time_graph}
	\caption{Sketch of the different time systems.}
	\label{fig:	Time_graph}
	\end{figure}
	%
	\FloatBarrier
	%
% 
\section{Transformations between reference systems.}
%
\indent In this section, two approaches for reference system transformations will be presented. These will prove quite useful later on, helping to clarify how different systems relate to each other. \\
%
\indent For the sake of generality, two frames are considered: firstly an inertial and absolute reference frame, and secondly, a rotating, relative reference frame (see figure \ref{fig:	Abs_rel}). In case two absolute systems are considered, it is enough to just nullify the displacement between both frames' origins. The notation used is described below:
%
\begin{itemize}
%
\item[\GMVred{$\bullet$}] \myul[GMVred]{Vectors}: $\underline{X}$ refers to a vector with respect an absolute frame, while $\underline{x}$ is used for relative reference frames. Please, note that no reference system (\ie vector base) is being used: the vector entity is considered as a mere object.
%
\item[\GMVred{$\bullet$}] \myul[GMVred]{Subscripts}: Unless specified otherwise, denote the body: $\bullet_{C}$ for the chief, $\bullet_D$ for the deputy.
%
\item[\GMVred{$\bullet$}] \myul[GMVred]{Time derivatives and superscripts}: As Coriolis' Theorem states, when non-inertial reference frames are involved, it is necessary to specify the frame with respect to which the derivative is calculated. $\dfrac{^{\mathcal{F}} d \bullet}{dt}$ denotes the time derivative in the frame $\mathcal{F}$. An equally valid yet more compact notation is $\dot{\bullet}^{\mathcal{F}}$. 
%
\item[\GMVred{$\bullet$}] \myul[GMVred]{Right vertical bar subscript}: Denotes the coordinate system in which one vector or matrix is described. For example, $\underline{u}\rvert_{1} = \sum_{i=1}^3 u_{xi} \underline{\hat{e}_{i1}} $.
%
\end{itemize}
%
%
\begin{figure}[!htb]
\centering\includegraphics[width = 0.7\linewidth]{Appendices/Appendix_B/Abs_rel}
\caption{Absolute and relative frames.}
\label{fig:	Abs_rel}
\end{figure}
%
\FloatBarrier
%
\indent Consider the frames $A$ and $B$ from figure \ref{fig:	Abs_rel}. Firstly the transformation from $A \rightarrow B$ is addressed, that is, converting an absolute \& inertial state vector expressed in coordinate system $A$ to the relative, rotating frame $B$ in its coordinates. What one would like to achieve is a relationship of the form:
%
\[
\left\{ \begin{array}{cccc}
\underline{x}\rvert_{B} 			& 	= 	& \bm f_1 \left( \underline{X}\rvert_{A}, ---, \underline{X_C}\rvert_{A}, ---\right) \\ 
\underline{\dot{x}}^{B}\rvert_{B} 	&  	= 	& \bm f_2 \left( \underline{X}\rvert_{A}, \underline{\dot{X}}^{A}\rvert_{A}, \underline{X_C}\rvert_{A}, \underline{\dot{X_C}}^{A}\rvert_{A}\right) \\
\end{array}
\right.
\]
%
\indent As it turns out, this relation is actually linear on the inputs $\underline{\dot{X}}^{A}\rvert_{A}$ and  $\underline{X}\rvert_{A}$. From this point on, two approaches are derived:
%
	\subsection{Direct analytical differentiation.} \label{sec:	LVLH_theory}
	%
	\indent The first approach starts from the decomposition of the deputy's absolute position vector \cite{LVLH}:
	%
	\[
	\underline{X} = \underline{X_C} + \underline{x} \rightarrow \underline{x} = \underline{X} - \underline{X_C}
	\]
	%
	\indent This vector can be expressed in both coordinate systems, namely $\underline{x}\rvert_A$ and $\underline{x}\rvert_B$. The transformation between them can be written as the following rotation:
	%
	\begin{equation}
	\underline{x}\rvert_{B} = R_{A \to B} \underline{x}\rvert_{A}
	\label{eqAppB: 	LVLH_x}
	\end{equation}
	%
	\indent The rotation matrix $R_{A \to B}$ takes the following form:
	%
	\[
	R_{A \to B} = 
	\left[ \begin{array}{ccc}
	\left(\underline{\hat{e}_{xA}} \cdot \underline{\hat{e}_{xB}}\right) & \left(\underline{\hat{e}_{yA}} \cdot \underline{\hat{e}_{xB}}\right) & \left(\underline{\hat{e}_{zA}} \cdot \underline{\hat{e}_{xB}}\right) \\
	\left(\underline{\hat{e}_{xA}} \cdot \underline{\hat{e}_{yB}}\right) & \left(\underline{\hat{e}_{yA}} \cdot \underline{\hat{e}_{yB}}\right) & \left(\underline{\hat{e}_{zA}} \cdot \underline{\hat{e}_{yB}}\right) \\
	\left(\underline{\hat{e}_{xA}} \cdot \underline{\hat{e}_{zB}}\right) & \left(\underline{\hat{e}_{yA}} \cdot \underline{\hat{e}_{zB}}\right) & \left(\underline{\hat{e}_{zA}} \cdot \underline{\hat{e}_{zB}}\right)
	\end{array}\right]
	\]
	%
	\noindent where each column is the coordinates of each base vector of the ``origin'' coordinate system (A) expressed in the ``destination'' system (B). This fact is specially useful when such vectors are characteristic of the problem at hand, as it is the case for the two body problem. In order to transform the velocity vector, the first step is to take the time derivative of \ref{eqAppB: 	LVLH_x}, yielding:
	%
	\begin{equation}
	\underline{\dot{x}}\rvert_{B} = \dot{R}_{A \to B} \underline{x}\rvert_{A} + R_{A \to B} \underline{\dot{x}}\rvert_{A}
	\label{eqAppB: 	LVLH_xdot}
	\end{equation}
	%
	\noindent whose first derivative $\dot{R}_{A \to B}$ can be calculated by columns, simplifying the task at hand if the origin base $\left( \underline{\hat{e}_{xA}}, \underline{\hat{e}_{yA}}, \underline{\hat{e}_{zA}}\right)$ has been obtained in terms of the final one. For the sake of completeness, it is necessary to keep in mind that \cite{LVLH}:
	%
	\begin{equation}
	\dfrac{d}{dt}\underline{\hat{u}} = \dfrac{1}{u} \left[ \underline{\dot{u}} - \left( \underline{\hat{u}} \cdot \underline{\dot{u}}\right) \underline{\hat{u}}\right]
	\label{eqAppB:	Unit_der}
	\end{equation}
	% 
	\indent A final, more compact form of both \ref{eqAppB: 	LVLH_x} and \ref{eqAppB: 	LVLH_xdot} can be reached by rearranging terms:
	%
	\begin{equation}
	\left\{ \begin{array}{c}
	\underline{x}\rvert_{B} \\
	\underline{\dot{x}}^{B}\rvert_{B}
	\end{array} \right\}
	= 
	\left[\begin{array}{cc}
	R_{A\to B} & 0_{3x3} \\
	\dot{R}_{A\to B} & R_{A\to B} 
	\end{array}\right]
	\left\{ \begin{array}{c}
	\underline{X}\rvert_{A} - \underline{X_C}\rvert_{A}\\
	\underline{\dot{X}}^{A}\rvert_{A} - \underline{\dot{X}_C}^{A}\rvert_{A}
	\end{array}\right\}
	\label{eqAppB: 	LVLH}
	\end{equation}
	%
	\noindent and the inverse transformation can be expressed as: 
	%
	\begin{equation}
	\left\{ \begin{array}{c}
	\underline{X}\rvert_{A} \\
	\underline{\dot{X}}^{A}\rvert_{A}
	\end{array} \right\}
	= 
	\left[\begin{array}{cc}
	R_{B\to A} & 0_{3x3} \\
	\dot{R}_{B\to A} & R_{B\to A} 
	\end{array}\right]
	\left\{ \begin{array}{c}
	\underline{x}\rvert_{B} \\
	\underline{\dot{x}}^{B}\rvert_{B}
	\end{array}\right\} + 
	\left\{ \begin{array}{c}
	\underline{X_C}\rvert_{A} \\
	\underline{\dot{X}_C}^{A}\rvert_{A}
	\end{array} \right\}
	\label{eqAppB: 	LVLH_inverse}
	\end{equation}
	%
	\indent An example of this approach will be developed later on in \ref{sec:	LVLH_example}.
	%
	\subsection{Classical motion composition.}
	%
	\indent This approach, rather on pure derivation, is based on the grounds of motion composition and Coriolis' Theorem. This theorem states that the derivative of a vector in an inertial frame is equivalent to the derivative in a rotating frame plus another contribution due to the rotation of this reference frame:
	%
	\[
	\dfrac{^{A}d \underline{u}}{dt} = \dfrac{^{B}d \underline{u}}{dt} + \underline{\omega}_{B\wrt A} \times \underline{u}
	\]
	%
	\indent The first term of the right-hand side is associated to the temporal variation of the coordinates of $\underline{u}$ in the rotating frame, whereas the second one is purely related to the relative rotation between both frames. Applying this to \ref{eqAppB: 	LVLH_x}:
	%
	\[
	\dfrac{^{A}d \underline{X}}{dt} = \dfrac{^{A}d \underline{X_C}}{dt} + \dfrac{^{A}d \underline{x}}{dt} = \dfrac{^{A}d \underline{X_C}}{dt} + \dfrac{^{B}d \underline{x}}{dt} + \underline{\omega}_{B\wrt A} \times \underline{x}
	\]
	%
	\begin{equation}
	\Rightarrow \underline{\dot{X}}^{A} = \underline{\dot{X}_C}^{A} + \underline{\dot{x}}^{B} + \underline{\omega}_{B\wrt A} \times \underline{x}
	\label{eqAppB: 	MC1}
	\end{equation}
	%
	\indent As before, the first step is to go from the inertial frame towards the rotating. For that purpose, one shall substitute \eqref{eqAppB: 	LVLH_x} into \eqref{eqAppB: 	MC1}, solving for $\underline{\dot{x}}^{B}$:
	%
	\begin{equation}
	\underline{\dot{x}}^{B} = \underline{\dot{X}}^{A} - \underline{\dot{X}_C}^{A} - \underline{\omega}_{B\wrt A} \times \left(\underline{X} - \underline{X_C} \right)
	\end{equation}
	%
	\indent Now, expressing every vector in its proper frame:
	%
	\begin{equation}
	\underline{\dot{x}}^{B}\rvert_{B} = R_{A\to B} \left[\underline{\dot{X}}^{A}\rvert_{A} - \underline{\dot{X}_C}^{A}\rvert_{A} + \underline{\omega}_{A\wrt B}\rvert_{A} \times \left(\underline{X}\rvert_{A} - \underline{X_C}\rvert_{A} \right)\right]
	\end{equation}
	%
	\indent Using the axial-dual vector form leads to:
	%
	\begin{equation}
	\underline{\dot{x}}^{B}\rvert_{B} = R_{A\to B} \left[\underline{\dot{X}}^{A}\rvert_{A} - \underline{\dot{X}_C}^{A}\rvert_{A} + \Omega_{A\wrt B}\rvert_{A} \left(\underline{X}\rvert_{A} - \underline{X_C}\rvert_{A} \right)\right]
	\end{equation}
	%
	\noindent where $\Omega_{A\wrt B}$ is the matrix dual form of $\underline{\omega}_{A \to B}$, that is:
	%
	\[
	\Omega_{A\wrt B} = \left[ \begin{array}{ccc}
			0 			& -\omega_z & \omega_y \\
			\omega_z 	& 0 		& -\omega_x \\
			-\omega_y 	& \omega_x 	& 0
			\end{array}\right]
	\]
	%
	\indent It is possible now express the conversion in a far more compact form as:
	%
	\begin{equation}
	\left\{ \begin{array}{c}
	\underline{x}\rvert_{B} \\
	\underline{\dot{x}}^{B}\rvert_{B}
	\end{array} \right\}
	= 
	\left[\begin{array}{cc}
	R_{A\to B} 								& 0_{3x3} \\
	R_{A\to B} \Omega_{A \wrt B} \rvert_{A} & R_{A\to B} 
	\end{array}\right]
	\left\{ \begin{array}{c}
	\underline{X}\rvert_{A} - \underline{X_C}\rvert_{A}\\
	\underline{\dot{X}}^{A}\rvert_{A} - \underline{\dot{X}_C}^{A}\rvert_{A}
	\end{array}\right\}
	\label{eqAppB: 	MC_direct}
	\end{equation}
	% 
	\noindent and its inverse can be easily derived, leading to:
	%
	\begin{equation}
	\left\{ \begin{array}{c}
	\underline{X}\rvert_{A} \\
	\underline{\dot{X}}^{A}\rvert_{A}
	\end{array} \right\}
	= 
	\left[\begin{array}{cc}
	R_{B\to A} & 0_{3x3} \\
	R_{B\to A} \Omega_{B\wrt A} \rvert_{B} & R_{B\to A} 
	\end{array}\right]
	\left\{ \begin{array}{c}
	\underline{x}\rvert_{B} \\
	\underline{\dot{x}}^{B}\rvert_{B}
	\end{array}\right\} + 
	\left\{ \begin{array}{c}
	\underline{X_C}\rvert_{A} \\
	\underline{\dot{X}_C}^{A}\rvert_{A}
	\end{array} \right\}
	\label{eqAppB: 	MC_inverse}
	\end{equation}
	%
	\indent Comparing \eqref{eqAppB: 	LVLH} and \eqref{eqAppB: 	MC_direct}, an interesting property of $\dot{R}$ can be extracted, namely:
	%
	\[
	\dot{R}_{A \to B} = R_{A\to B} \Omega_{A \wrt B} \rvert_{A}
	\]
	%
	\noindent which is in turn quite useful, as time derivation of the rotation matrix itself might be quite costly and symbolically dense. This requires though to know the angular velocity vector, whose calculation might not be easy.
	%
\section{Absolute reference systems.}
%
	\subsection{Earth-Centered-Inertial reference system (ECI).}
	%
	\indent As previously stated, any Earth-fixed reference system will in turn be non-inertial. That leads to the need of defining a common baseline, \ie an epoch at which the reference system is known. The chosen epoch is denoted as J2000.0\footnote{J2000 denotes a reference frame, being analog to ECI. J2000.0 refers to the mentioned epoch.}, which translates to January \nth{1}, at 12:00:00.000 (midday) in Julian years \cite[see][, glossary]{Time_handbook}. Effectively, the ECI reference system, is geometrically defined as follows \cite{Tapley}:
	%
	\[
	\arraycolsep=10pt
	\def\arraystretch{1.3}
	ECI \equiv\left\{
	\begin{array}{lll}
	\text{Origin} 	& \equiv 	& \text{Earth's COM} \\[0.5 em]
	\text{X-axis} 	& \equiv 	& \text{Earth's COM} \longrightarrow \text{Mean vernal equinox at epoch J2000.0} \\
	\text{Z-axis} 	& \equiv 	& \text{Normal to the mean equatorial plane at epoch J2000.0, } \\
	  				& 			& \text{pointing towards the Northern Hemisphere} \\
	\text{Y-axis} 	& \equiv 	& \text{Perpendicular to the X and Z axes forming a right-handed system} \\
	\end{array}
	\right.
	\]
	%
	\indent The main reason behind using this system is that it considerably simplifies the dynamics equation of any spacecraft. It is then the most adequate frame on which dynamics can be solved. Furthermore, when considering relative motion, the reference axis are not a critical axis, as one is rather focused on the motion between spacecrafts. On the other hand, this frame is not able to describe the position relative to Earth's surface, thus being useless in communications or visibility analysis.
	%
	\subsection{Earth-Centered, Earth-Fixed reference system (ECEF).}
	%
	\indent Due to the formerly mentioned concerns, another Earth-centered reference frame must be defined. In this case, that will be ECEF. Geometrically, it is defined as \cite{Tapley}
	%
	\[
	\arraycolsep=10pt
	\def\arraystretch{1.3}
	ECEF \equiv\left\{
	\begin{array}{lll}
	\text{Origin} 	& \equiv 	& \text{Earth's COM} \\[0.5 em]
	\text{X-axis} 	& \equiv 	& \text{Earth's COM} \longrightarrow \text{Intersection of prime meridian and true equatorial plane} \\
	\text{Z-axis} 	& \equiv 	& \text{Earth's true angular velocity vector (rotation axis)} \\
	\text{Y-axis} 	& \equiv 	& \text{Perpendicular to the X and Z axes forming a right-handed system} \\
	\end{array}
	\right.
	\]
	%
	\indent Once defined, it is turn to evaluate how ECI and ECEF frames differ.
	%
		\subsubsection{Conversion from ECI to ECEF.}
		%
		%
		\begin{figure}[!htb]
		\centering\includegraphics[width = 0.6\linewidth]{Appendices/Appendix_B/ECI_ECEF}
		\caption{ECI and ECEF reference frames.}
		\label{fig: ECI_ECEF}
		\end{figure}
		%
		\FloatBarrier
		%
		%
		\paragraph{Decomposition of the conversion. \\}
		%
		\indent There are four essential differences between ECI and ECEF frame, due to four motions that ECEF include due to it being fixed to Earth:
		%
		\begin{itemize}
		\item[1.] Precession of the equinoxes.
		%
		\item[2.] Nutations (small oscillations) of the equinoxes.
		%
		\item[3.] Earth's rotation around its axis.
		%
		\item[4.] Spin axis motion.
		\end{itemize}
		%
		\indent Each of this motions can be characterized by a rotation to an associated frame. That is, the conversion between ECI and ECEF may be decomposed in four rotations, which will now be analyzed.
		%
		\paragraph{\GMVred{I.} \myul[GMVred]{Involved intermediate frames \& rotations.}}
		%
		\subparagraph{\GMVred{I.A.} \myul[GMVred]{ECI(J2000) to Mean of Date. }\\}
		%
		\indent The equinoxes rotate at a slow, but relevant rate. That means that the vernal equinox today differs considerably from the one at J2000.0. The Mean of Date (MOD) frame arises from this notion, being defined as \cite{Tapley}: \\
		%
		\[
		\arraycolsep=10pt
		\def\arraystretch{1.3}
		MOD\equiv\left\{
		\begin{array}{lll}
		\text{X-axis} 	& \equiv 	& \text{Earth's COM} \longrightarrow \text{Mean vernal equinox at current epoch} \\
		\text{Z-axis} 	& \equiv 	& \text{Perpendicular to the mean equatorial plane at current epoch} \\
		\text{Y-axis} 	& \equiv 	& \text{Perpendicular to the X and Z axes forming a right-handed system} \\
		\end{array}
		\right.
		\]
		%
		\indent The rotation matrix from J2000 to MOD results:
		%
		\begin{equation}
		R_{ECI\rightarrow MOD} = 
		\left[ 
		\begin{array}{ccc}
		C \zeta_A C \theta_A C z_A - S \zeta_A S z_A 	& - S \zeta_A C \theta_A C z_A - C \zeta_A S z_A 	& -S \theta_A C z_A \\
		C \zeta_A C \theta_A S z_A + S \zeta_A C z_A 	& - S \zeta_A C \theta_A S z_A + C \zeta_A C z_A 	& -S \theta_A S z_A \\
 		C \zeta_A S \theta_A 							& - S \zeta_A S \theta_A 							& C \theta_A
		\end{array}
		\right]
		\label{eq: R_ECI_MOD}
		\end{equation}
		%
		\noindent where the precession angles $\zeta_A$, $\theta_A$ and $z_A$, which are functions of the epoch, are shown in \cite{Tapley}, page 519. $S$ and $C$ are abbreviations of the sine and cosine functions.
		%
		%
		\begin{figure}[!htb]
		\centering\includegraphics[width = 0.4\linewidth]{Appendices/Appendix_B/Nut_prec}
		\caption{Nutation and precession motion \cite{DinVu}.}
		\label{fig:	Nut_prec}
		\end{figure}
		%
		\FloatBarrier
		%
		\subparagraph{\GMVred{I.B.} \myul[GMVred]{Mean of Date to True of Date.}\\}
		%
		\indent Besides the ``long-term'' precession motion, equinoxes suffer also short-period, small oscillations, which are denoted as nutations. For more clarity, see figure \ref{fig:	Nut_prec}. The True of Date (TOD) frame is thus defined as: \\
		%
		\[
		\arraycolsep=10pt
		\def\arraystretch{1.3}
		TOD\equiv\left\{
		\begin{array}{lll}
		\text{X-axis} 	& \equiv 	& \text{Earth's COM} \longrightarrow \text{True vernal equinox at current epoch} \\
		\text{Z-axis} 	& \equiv 	& \text{Perpendicular to the true equatorial plane at current epoch} \\
		\text{Y-axis} 	& \equiv 	& \text{Perpendicular to the X and Z axes forming a right-handed system} \\
		\end{array}
		\right.
		\]
		%
		\indent The rotation matrix now has the following shape:
		%
		\begin{equation}
		R_{MOD\rightarrow TOD} = 
		\left[ 
		\begin{array}{ccc}
		C \Delta \psi 				& - C \epsilon_m S \Delta \psi 	& - S \epsilon_m S \Delta \psi \\
		C \epsilon_t S \Delta \psi 	& C \epsilon_m C \epsilon_t C \Delta \psi + S \epsilon_m S \epsilon_t & S \epsilon_m C \epsilon_t C \Delta \psi - C \epsilon_m S \epsilon_t \\
		S \epsilon_t S \Delta \psi 	& C \epsilon_m S \epsilon_t C \Delta \psi - S \epsilon_m C \epsilon_t & S \epsilon_m S \epsilon_t C \Delta \psi + C \epsilon_m C \epsilon_t \\
		\end{array}
		\right]
		\label{eq: R_MOD_TOD}
		\end{equation}
		%
		\noindent where four angles appear. Firstly, the mean obliquity, which is the angle between the mean ecliptic and the mean equatorial plane ($\approx 23.5^{\circ}$). For an analytic expression, see \cite{Tapley}, page 519. Moreover, two nutations arise: one in longitude and one in obliquity ($\Delta \psi$ and $\Delta \epsilon$, respectively). This angles are computed by a summation of a large number of sinusoidal functions, whose construction and coefficients are shown in \cite{IERS_conventions}. Lastly, the true obliquity is simply the addition of its mean counterpart and the nutation ($\epsilon_t = \epsilon_m + \Delta \epsilon$).
		%
		\subparagraph{\GMVred{I.C.}\myul[GMVred]{True of Date to Pseudo-Body-Fixed.}\\}
		%
		\indent Perhaps the biggest and most intuitive difference between ECI and ECEF is Earth's rotation around its axis. The pseudo-body-fixed is simply a clockwise rotation (seen from north pole towards the Earth's COM) around said axis from the True of Date frame:  \\
		%
		\[
		\arraycolsep=10pt
		\def\arraystretch{1.3}
		PBF\equiv\left\{
		\begin{array}{lll}
		\text{X-axis} 	& \equiv 	& \text{Earth's COM} \longrightarrow \text{Intersection between prime meridian and true equatorial plane.} \\
		 				&  	 		& \text{(without accounting for the axis' displacement).} \\
		\text{Z-axis} 	& \equiv 	& \text{Perpendicular to the true equatorial plane at current epoch} \\
		\text{Y-axis} 	& \equiv 	& \text{Perpendicular to the X and Z axes forming a right-handed system} \\
		\end{array}
		\right.
		\]
		%
		\indent The rotation matrix is now as simple as:
		%
		\begin{equation}
		R_{TOD\rightarrow PBF} = 
		\left[ 
		\begin{array}{ccc}
		C \alpha_G 		& S\alpha_G 	& 0 \\
		-S\alpha_G 		& C\alpha_G 	& 0 \\
		0 				& 0 			& 1 \\
		\end{array}
		\right]
		\label{eq: R_TOD_PBF}
		\end{equation}
		%
		\noindent where $\alpha_G$ is referred to as the Greenwich Mean Sidereal Time (GMST). $\dot{\alpha_G}$ is then the rotation rate of the Earth. An analytical expression for this angle is provided in \cite{Tapley}, page 520 (eq. H.4.3).
		%
		\subparagraph{\GMVred{I.D.}\myul[GMVred]{Pseudo-Body-Fixed to Body-Fixed (ECEF).}\\}
		%
		\indent The last, and surely most subtle transformation, is the one that accounts for the displacement in Earth's axis of rotation. This displacement is parametrized with the polar angles $x_p$ and $y_p$, which can again be found at \cite{IERS_conventions}. As these angles are sufficiently small, the rotation matrix from PBF to ECEF is:\\
		%
		%
		\begin{equation}
		R_{PBF\rightarrow BF} = 
		\left[ 
		\begin{array}{ccc}
		1		& 0 	& x_p \\
		0 		& 1 	& -y_p \\
		-x_p 	& y_p 	& 1 \\
		\end{array}
		\right]
		\label{eq: R_PBF_ECEF}
		\end{equation}
		\paragraph{\GMVred{II.} \myul[GMVred]{Full rotation matrix $\bm{R_{ECI\rightarrow ECEF}}$. }\\}
		%
		\indent By simply successively composing rotations, the full rotation matrix from ECI to ECEF is computed as:
		%
		\[
		R_{ECI\rightarrow ECEF} = R_{PBF \rightarrow ECEF} R_{TOD \rightarrow PBF} R_{MOD\rightarrow TOD} R_{ECI\rightarrow MOD}		
		\]
		%
	%
	\subsection{Perifocal (PQW) reference frame.} \label{sec: PQW}
	%
		\subsubsection{Definition.}
		%
		\indent The perifocal reference frame is defined as:
		%
		\[
		\arraycolsep=10pt
		\def\arraystretch{1.3}
		PQW\equiv\left\{
		\begin{array}{lll}
		\text{Origin} 	& \equiv 	& \text{Central body's COM} \\
		\text{X-axis} 	& \equiv 	& \text{Origin} \longrightarrow \text{Periapsis.} \\
		\text{Z-axis} 	& \equiv 	& \text{Perpendicular to the osculating orbital plane (out-of-plane)} \\
		\text{Y-axis} 	& \equiv 	& \text{Perpendicular to the X and Z axes forming a right-handed system} \\
		\end{array}
		\right.
		\]
		%	
		\indent This frame takes advantage of the motion being contained in the orbital plane (when using osculating elements, see section \ref{secCh4:mean2osc}). That means that usually, the problem reduces to evaluating two components of the position and velocity. It also allows for a quite straightforward description of the motion in terms of the Keplerian OEs, assuming elliptical motion. In this case, and using $\underline{q}$ and $\underline{\dot{q}}$ to denote perifocal position and velocity, the perifocal state vector is expressed as:
		%
		\[\begin{array}{cc}
		\underline{q} = \left\{ 
		\begin{array}{c}
		r \cos \theta \\
		r \sin \theta \\
		0
		\end{array}				
		\right\} = 
		\left\{ 
		\begin{array}{c}
		a \left( \cos E - e \right) \\
		a \sin E\\
		0
		\end{array}				
		\right\},  		& \quad
		\underline{\dot{q}} = \dfrac{na}{\sqrt{1-e^2}}
		\left\{ 
		\begin{array}{c}
		-\sin\theta\\
		e + \cos \theta\\
		0
		\end{array}				
		\right\}		
		\end{array}
		\]
		%
		\noindent where $E$ is the eccentric anomaly, $r$ is the orbital radius, $n$ is the mean orbital rate and the remaining parameters are the regular Keplerian OEs. $r$ and $n$ can be expressed as a function of them as:
		%
		\[
		r = \dfrac{a (1 - e^2)}{1 + e \cos\theta} = a (1 - e\cos E) \; ; \qquad n = \sqrt{\dfrac{\mu }{a^3}}		
		\]
		%
		\noindent with $\mu = GM$ being the gravitational parameter of the central body.
		%
		\subsubsection{State vector transformation.}
		%
		\indent The target is to get an expression analogous to \eqref{eqAppB: 	MC_direct}. As both frames are Earth-centered, $\underline{X}_C = 0$, so that only the rotation and angular velocity matrices are to be found.
		% 
			\paragraph{\GMVred{I.} \myul[GMVred]{Rotation matrix from \& to ECI.} \\}
			%
			\indent As done with the ECI to ECEF transformation, this one can also be decomposed in three rotations, each associated with one Keplerian angle.\\
			%
			\indent The first rotation is associated to $\Omega$, being done around the Z ECI axis. The resulting frame will be named I1 (intermediate 1), and the rotation matrix from ECI is:
			%
			\[
			R_{ECI\rightarrow I1}(\Omega) = \left[
			\begin{array}{ccc}
			\cos \Omega 	& \sin \Omega 	& 0 \\
			- \sin \Omega 	& \cos \Omega 	& 0 \\
			0 				& 0 			& 1 
			\end{array}						
			\right]	
			\]
			%
			\indent Afterwards, a rotation around X axis of I1 (nodal line) of value $i$ is performed, leading to frame I2. The rotation matrix is simply:
			%
			\[
			R_{I1\rightarrow I2}(\Omega) = \left[
			\begin{array}{ccc}
			1 	& 0			 	& 0 \\
			0 	& \cos i 		& \sin i \\
			0 	& -\sin i		& \cos i 
			\end{array}						
			\right]	
			\]
			%
			\indent Finally, a rotation around Z axis of I2 (out-of-plane direction) of value $\omega$ is done, yielding the desired perifocal frame (which will be denoted as PQW):
			%
			\[
			R_{I2\rightarrow PQW}(\Omega) = \left[
			\begin{array}{ccc}
			\cos \omega 	& \sin \omega 	& 0 \\
			- \sin \omega 	& \cos \omega 	& 0 \\
			0 				& 0 			& 1 
			\end{array}						
			\right]	
			\]
			%
			\indent By composition, the matrix $R_{ECI\rightarrow PQW}$ can easily be calculated:
			%
			\[
			R_{ECI \rightarrow PQW} = R_{I2 \rightarrow PQW}R_{I1 \rightarrow I2} R_{ECI \rightarrow I1} = 
			\left[\begin{array}{ccc}
			C \Omega C \omega - S \Omega Ci S\omega 	& S\Omega C\omega + C\Omega Ci S\omega 	& Si S\omega \\
			-C \Omega S \omega - S \Omega Ci c\omega 	& C\Omega Ci C\omega + S\Omega S\omega 	& Si C\omega \\
			S \Omega Si									& - C\Omega Si  						& Ci \\
			\end{array}\right]
			\]
			%
			\paragraph{\GMVred{II.} \myul[GMVred]{Angular velocity. }\\}
			%
			\indent In order to fully transform the system, it is necessary to calculate the relative angular velocity between both frames. Again, that can be done by composing the angular movements:
			%
			\[
			\underline{\omega}_{PQW \wrt ECI} = \dot{\Omega} \underline{\hat{k}_{I1}} + \dot{i} \underline{\hat{i}_{I2}} + \dot{\omega} \underline{\hat{k}_{PQW}}
			\]
			%			
			\indent Expressing everything in PQW frame:
			%
			\[
			\underline{\omega}_{PQW \wrt ECI}\rvert_{PQW} = \left\{\begin{array}{c} \omega_x \\ \omega_y \\ \omega_z \end{array}\right\} = \dot{\Omega} R_{ECI\rightarrow PQW} \left\{\begin{array}{c} 0 \\ 0 \\ 1 \end{array}\right\} + \dot{i} R_{I2 \rightarrow PQW}R_{I1 \rightarrow I2} \left\{\begin{array}{c} 1 \\ 0 \\ 0 \end{array}\right\} + \dot{\omega} R_{I2 \rightarrow PQW} \left\{\begin{array}{c} 0 \\ 0 \\ 1 \end{array}\right\}
			\]
			% 
			\indent In virtue of the axial dual form principle, there exists one matrix that, when applied to a certain vector, yields the same result as doing the cross product between $\underline{\omega}$ and that vector. This matrix has the following shape:
			%
			\[
			\Omega_{PQW \wrt ECI}\rvert_{PQW} = \left[ \begin{array}{ccc}
			0 			& -\omega_z & \omega_y \\
			\omega_z 	& 0 		& -\omega_x \\
			-\omega_y 	& \omega_x 	& 0
			\end{array}\right]
			\]
			%
			\paragraph{\GMVred{III.}\myul[GMVred]{Transformation matrices $\bm{T_{PQW\rightarrow ECI}}$, $\bm{T_{ECI\rightarrow PQW}}$. }\\}
			%
			\indent The transformation matrices can easily be built as in \eqref{eqAppB: 	MC_direct}:
			%
			\[
			 T_{PQW\to ECI} = \left[\begin{array}{cc}
	R_{PQW\to ECI} & 0_{3x3} \\
	R_{PQW\to ECI} \Omega_{PQW \wrt ECI}\rvert_{PQW} & R_{PQW\to ECI}
	\end{array}\right]
			\]
			%
			\noindent whose inverse counterpart can be obtained in terms of the same components, as:
			%
			\[
			 T_{ECI\to PQW} = \left[\begin{array}{cc}
	R_{PQW\to ECI}^T & 0_{3x3} \\
	-\Omega_{PQW \wrt ECI}\rvert_{PQW} R_{PQW\to ECI}^T & R_{PQW\to ECI}^T
	\end{array}\right]
			\]
			%
			\indent It is important to note that, as the rotation angles are Keplerian OEs, the unperturbed assumption leads to a null angular velocity (as the orbital plane remains unchanged along time). That greatly simplifies the transformation, turning into a trivial rotation of the position and velocity vectors, which can be expressed as:
			%
			\begin{equation}
			\left\{\begin{array}{lll}
			\underline{x}_{ECI} & = R_{PQW\to ECI} \\underline{q} \\
			\underline{\dot{x}}_{ECI} & = R_{PQW\to ECI} \underline{\dot{q}} 
			\end{array}\right.
			\label{eqAppB:PQW2ECI}
			\end{equation}
			%
			\noindent where the functional dependencies are separated, as $R_{PQW\to ECI}(\Omega, i, \omega)$ and $[\underline{q}, \underline{\dot{q}}] = f(a, e, M)$. This fact will prove useful later on.
			%
\section{Relative reference systems.}
%
\indent It is time now to address relative reference frames. For each of them, a description is provided, followed by a conversion to and from the ECI reference frame. 
%
	\subsection{RTN reference frame.} \label{secAppB:RTN}
	%
		\subsubsection{Definition.}
		%
		\indent The Radial-Tangential-Normal (RTN) reference frame is defined as \cite{dAmicoDLR}:
		%
		\[
		\arraycolsep=10pt
		\def\arraystretch{1.3}
		RTN\equiv\left\{
		\begin{array}{lll}
		\text{Origin} 	& \equiv 	& \text{Chief SC COM} \\
		\text{X-axis}(\underline{e}_R) 	& \equiv 	& \text{Radial direction (positive outwards)} \\
		\text{Z-axis}(\underline{e}_N) 	& \equiv 	& \text{Normal to the orbit plane (positive with orbit momentum)} \\
		\text{Y-axis}(\underline{e}_T) 	& \equiv 	& \text{Perpendicular to the X and Z axes forming a right-handed system} \\
									 	& 			& \text{(} \approx \text{ tangent to the trajectory)}
		\end{array}
		\right.
		\]
		%
		\indent A graphical representation of this frame is shown in figure \ref{fig:	RTN_frame}.
		%
		%
		\begin{figure}[!htb]
		\centering\includegraphics[width = 0.4\linewidth]{Appendices/Appendix_B/RTN_frame}
		\caption{RTN frame \cite{dAmicoDLR}.}
		\label{fig:	RTN_frame}
		\end{figure}
		%
		\FloatBarrier
		%
		\subsubsection{State vector transformation.}
		%
		\indent As before, one needs to build two matrices: The rotation matrix and the angular velocity matrix. 
		%
			\paragraph{\GMVred{I.}\myul[GMVred]{Rotation matrix from ECI. }\\}
			%
			\indent When paying close attention to both PQW and RTN frames, it arises that the rotation matrix is virtually the same, only changing the value of the last rotation from $\omega$ to $u = \theta + \omega$. That is:
			%
			\[
			R_{I2 \to RTN} = R_{I2\to RTN} \rvert_{\omega \to u} \Rightarrow R_{ECI\to RTN} = R_{ECI\to PQW}\rvert_{\omega \to u}
			\]
			%
			\noindent which leads to the following expression:
			%
			\[
			R_{ECI\to RTN} = \left[ \begin{array}{ccc}
			C\Omega C u - S\Omega C i S u 			& S\Omega C u + C\Omega C i S u & S i S u \\
			-C\Omega S u - S\Omega C i C u 			& -S\Omega S u + C\Omega C i C u & S i C u \\
			S\Omega S i 							& - C\Omega S i 			& C i
			\end{array}\right]
			\]
			\paragraph{\GMVred{II.} \myul[GMVred]{Angular velocity. }\\}
			%
			\indent Assuming unperturbed motion, the only time-varying angle is $u$ through the true anomaly. Its rate is in fact:
			%
			\[
			\dot{\theta} = \dot{M} \dfrac{\rho^2}{\eta^{3}} = \dfrac{n \rho^2}{\eta^3}
			\]
			%			
			\noindent where $\rho = 1 + e \cos\theta$ and $\eta = \sqrt{1 - e^2}$. With this in mind, the angular velocity matrix takes the following form:
			%
			\[
			\Omega_{RTN\wrt ECI}\rvert_{RTN} = \left[ \begin{array}{ccc}
			0 			& -\dot{\theta} 	& 0 \\
			\dot{\theta} & 0 			& 0 \\
			0 			& 0 			& 0
			\end{array}\right]
			\]
			%
			\paragraph{\GMVred{III.}\myul[GMVred]{Transformation matrices $\bm{T_{RTN\rightarrow ECI}}$, $\bm{T_{ECI\rightarrow RTN}}$.} \\}
			%
			\indent The transformation matrices are composed as follows:
			\[
			 T_{ECI\to RTN} = \left[\begin{array}{cc}
	R_{ECI\to RTN} & 0_{3x3} \\
	-\Omega_{RTN \wrt ECI}\rvert_{RTN} R_{ECI\to RTN}   & R_{ECI\to RTN} 
	\end{array}\right]
			\]
			%
			\noindent whose inverse counterpart can be obtained in terms of the same components, as:
			%
			\[
			 T_{RTN\to ECI} = \left[\begin{array}{cc}
	R_{ECI\to RTN}^T & 0_{3x3} \\
	R_{ECI\to RTN}^T\Omega_{RTN \wrt ECI}\rvert_{RTN} & R_{ECI\to RTN}^T
	\end{array}\right]
			\]
			%
			
	\subsection{LVLH reference frame.} \label{secAppB:LVLH}
	%
		\subsubsection{Definition.}
		%
		\indent The Local Vertical-Local Horizontal frame (LVLH) may be understood as a different interpretation of the RTN frame. It basically differs from it in the naming and direction of the axis, namely:
		%
		\[
		\arraycolsep=10pt
		\def\arraystretch{1.3}
		LVLH\equiv\left\{
		\begin{array}{lll}
		\text{Origin} 	& \equiv 	& \text{Chief SC COM} \\
		\text{Z-axis}(-\underline{e}_R) 	& \equiv 	& \text{Radial direction (positive inwards)}\\
		\text{Y-axis}(-\underline{e}_N) 	& \equiv 	& \text{Normal to the orbit plane (cross-track) } \\
											& 			& \text{(negative with orbit momentum)}\\
		\text{X-axis}(\underline{e}_T) 	& \equiv 	& \text{Perpendicular to the Y and Z axes (along-track) } \\
									 	& 			& \text{forming a right-handed system (} \approx \text{ tangent to the trajectory)}
		\end{array}
		\right.
		\]
		%
		\subsubsection{State vector transformation.}
		%
		\indent There are two main ways to obtain the ECI to LVLH frame transformation:
		%
		\paragraph{\GMVred{A)} Using reference orbit's Keplerian OEs. \\}
		%
		\indent This method is the one used for the PQW and the RTN frame. It is as easy as performing yet another rotation from the RTN frame, being consistent with the angular velocity.
		%
			\subparagraph{\GMVred{I.} \myul[GMVred]{Rotation matrix from ECI.} \\}
			%
			\indent The additional rotation from RTN to LVLH is:
			%
			\[
			R_{RTN\to LVLH} = \left[ \begin{array}{ccc}
			0 			& 1 	& 0 \\
			0		    & 0 			& -1 \\
			-1 			& 0 			& 0
			\end{array}\right]
			\]
			%
			\noindent leading to the full rotation matrix:
			%
			\[
			R_{ECI\to LVLH} = R_{ECI\to RTN} R_{RTN\to LVLH} = \left[ \begin{array}{ccc}
			-C\Omega S u - S\Omega C i C u 			& C\Omega C i C u - S\Omega S u		& C u S i\\
			-S\Omega S i		    				& C\Omega S i 						& -C i \\
			-C\Omega C u + S\Omega C i S u 			& -C\Omega C i S u - S\Omega C u	& -S u S i\\
			\end{array}\right]
			\]
			%
			\subparagraph{\GMVred{II.} \myul[GMVred]{Angular velocity. }\\}
			%
			\indent Although one could rotate either the vector or the matrix itself, it is actually easier to graphically derive the angular velocity (assuming of course unperturbed motion). Doing this, it can easily be seen that the only angular velocity component is the one in Y-axis, of value $-\dot{\theta}$. The angular velocity matrix then becomes:
			%
			\[
			\Omega_{LVLH\wrt ECI}\rvert_{LVLH} = \left[ \begin{array}{ccc}
			0 			& 0 			& -\dot{\theta}\\
			0 			& 0 			& 0 \\
			\dot{\theta}	& 0 			& 0
			\end{array}\right]
			\]
			%
		\paragraph{\GMVred{B)} Using reference ECI state vector. \\}
		\phantomsection \label{sec:	LVLH_example}
		%
		\indent This approach is based on \cite{LVLH}, and was introduced in \ref{sec:	LVLH_theory}. For this transformation to be performed, the rotation matrix and its derivative have to be calculated. With this approach, that is analogous to get the unitary vectors expressed in ECI frame. As the inputs are actually the ECI coordinates and velocity of the chief spacecraft, this is almost already done. The unitary vectors of the rotating frame in this case are:
		%
		\begin{equation}
		\arraycolsep=10pt
		\def\arraystretch{1.3}
		\left\{ \begin{array}{ccc}
		\underline{\hat{e}_z} = - \underline{\hat{r}} \\
		\underline{\hat{e}_y} = - \underline{\hat{h}} \\		
		\underline{\hat{e}_x} = \underline{\hat{e_y}} \times \underline{\hat{e_z}} 		
		\end{array}\right.
		\end{equation}
		%
		\noindent where $\underline{\hat{h}} = \dfrac{\underline{r} \times\underline{v}}{\lvert \underline{r} \times\underline{v} \rvert}$. $\underline{r}$ and $\underline{v}$ are respectively the position and velocity of the chief spacecraft.
		%
			\subparagraph{\GMVred{I.} \myul[GMVred]{Rotation matrix from ECI. }\\}
			%
			\indent The rotation matrix $R_{ECI\to LVLH}$ is then:
			%
			\[
			R_{ECI\to LVLH}= \left[ \begin{array}{c}
			\underline{\hat{e}_x}^T \\
			\underline{\hat{e}_y}^T \\
			\underline{\hat{e}_z}^T
			\end{array}\right]
			\]
			%
			\noindent that is, each unitary vector is transposed into one row of the matrix.
			%
			\subparagraph{\GMVred{II.} \myul[GMVred]{Rotation matrix derivative. }\\}
			%
			\indent By using equation \eqref{eqAppB:	Unit_der}, the vectors' time derivatives are:
			%
			\[
			\arraycolsep=10pt
			\def\arraystretch{1.3}
			\left\{ \begin{array}{lllll}
			\dfrac{d}{dt} \left(\underline{\hat{e}_z}\right) & = & \dfrac{d}{dt} \left(-\underline{\hat{r}}\right) & = & - \dfrac{1}{r} \left[ \underline{v} - \left(\underline{\hat{r}} \cdot \underline{v}\right)\underline{\hat{r}}\right] \\
			\dfrac{d}{dt} \left(\underline{\hat{e}_y}\right) & = & \dfrac{d}{dt} \left(-\underline{\hat{h}}\right) & = & - \dfrac{1}{h} \left[ \underline{\dot{h}} - \left(\underline{\hat{h}} \cdot \underline{\dot{h}}\right)\underline{\hat{h}}\right] \\
			\dfrac{d}{dt} \left(\underline{\hat{e}_x}\right)  & = & \dfrac{d}{dt} \left(\underline{\hat{e_y}}\times \underline{\hat{e_z}}\right) & = & \dfrac{d}{dt} \left(\underline{\hat{e_y}}\right)\times\underline{\hat{e_z}} +  \underline{\hat{e_y}}\times \dfrac{d}{dt} \left(\underline{\hat{e_z}}\right)
			\end{array} \right.
			\]
			\noindent where all entities are known except for $\underline{\dot{h}}$, which is in turn:
			%
			\[
			\underline{\dot{h}} = \dfrac{d}{dt} \left(\underline{r}\times \underline{v}\right) = \underline{r} \times \underline{a}
			\]
			%
			\indent Hence, the acceleration of the chief spacecraft needs to be provided when it is not radial. As that is the case with the unperturbed two-body problem, the rotation matrix is significantly simplified:
			%
			\[
			\arraycolsep=10pt
			\def\arraystretch{1.3}
			\left\{ \begin{array}{lllll}
			\dfrac{d}{dt} \left(\underline{\hat{e}_z}\right) 	& = & - \dfrac{1}{r} \left[ \underline{v} - \left(\underline{\hat{r}} \cdot \underline{v}\right)\underline{\hat{r}}\right] \\
			\dfrac{d}{dt} \left(\underline{\hat{e}_y}\right) 	& = & 	\underline{0} \\
			\dfrac{d}{dt} \left(\underline{\hat{e}_x}\right) 	& = & - \underline{\hat{h}} \times \dfrac{d}{dt} \left(\underline{\hat{e_z}}\right) 
			\end{array} \right.
			\]
			%
			\indent The construction of $\dot{R}_{ECI\to LVLH}$	is identical to its primitive. The transformation matrices can now be built, following equations \ref{eqAppB: 	LVLH} and \ref{eqAppB: 	LVLH_inverse}.
			%
			
	\subsection{TAN reference frame.}\label{sec:TAN_frame}
	%
	%
	\begin{figure}[!htb]
	\centering\includegraphics[width = 0.6\linewidth]{Appendices/Appendix_B/RTN_LVLH_TAN}
	\caption{Relative reference frames.}
	\label{fig:	RTN_LVLH_TAN}
	\end{figure}
	%
	\FloatBarrier
	%
		\subsubsection{Definition.}
		%
		\indent The Tangent reference frame (TAN) is quite similar to the LVLH frame, but instead of featuring an axis pointing towards \textit{nadir} (Earth), this frame includes an axis pointing always in the velocity direction. This involves a simple rotation from the LVLH frame, of an angle $\gamma$ called flight path angle (see figure \ref{fig:	RTN_LVLH_TAN}). It is then unsurprisingly defined as the angle between the horizon (local horizontal) and the velocity vector. The transformation from the LVLH frame is now described.
		%
		\subsubsection{State vector transformation.}
		%
			\paragraph{\GMVred{I.} \myul[GMVred]{Rotation matrix from LVLH. }\\}
			%
			\indent In this case, it is a simple clockwise rotation around LVLH Y-axis, that is:
			%
			\[
			R_{LVLH\to TAN} = \left[ \begin{array}{ccc}
			\cos\gamma 	& 0	& -\sin\gamma\\
			0 			& 1	& 0 \\
			\sin\gamma	& 0 & \cos\gamma
			\end{array}\right]
			\]
			%
			\paragraph{\GMVred{II.} \myul[GMVred]{Angular velocity.} \\}
			%
			\indent As it has been explained before, the angular velocity matrix can be written as:
			%
			\[
			\Omega_{LVLH\to TAN}\rvert_{LVLH} = \left[ \begin{array}{ccc}
			0 			& 0	& -\dot{\gamma}\\
			0 			& 0 & 0 \\
			\dot{\gamma}& 0 & 0
			\end{array}\right]
			\] 
			%			
			\indent There is something remaining: $\gamma$ and its derivative must be calculated. Starting with the angle itself, its sine and cosine satisfy:
			%
			\[
			\left\{
			\begin{array}{ccc}
			\sin\gamma & = & \dfrac{e \sin \theta}{\Theta} \\[1.2em]
			\cos\gamma & = & \dfrac{\rho}{\Theta}
			\end{array}
			\right.
			\]
			%
			\noindent where $\Theta = \sqrt{2 \rho - \eta^2}$. $\gamma$ is simply calculated as:
			%
			\[\gamma = \atantwo\left(\sin\gamma ,\: \cos\gamma\right)\]
			%
			\indent On the other hand, $\dot{\gamma}$ can be calculated as:
			%
			\[
			\dot{\gamma} = n \dfrac{\rho^2 \left( \rho - \eta^2\right)}{\eta^3 \Theta^2}
			\]
			%
			\indent Therefore, the transformation is complete.
			%
\section{Conversions from OEs to cartesian coordinates.}
%
%
	\subsection{Keplerian OEs to ECI and vice versa.}
	%
		\subsubsection{KOE to ECI transformation.}
		%
		\indent By considering the perifocal coordinates $\left(\underline{q}, \dot{\underline{q}}\right) $ (see \ref{sec: PQW}), an explicit relation from Keplerian OEs to the ECI state vector can easily be derived:
		%
		\[\left\{ \begin{array}{cclll}
		x 		& = &\left(\cos\Omega \cos u - \sin \Omega \cos i \sin u\right)		& r &\\
		y 		& = & \left(\sin\Omega \cos u + \cos \Omega \cos i \sin u\right) 	& r &\\
		z 		& = & \left(\sin i \sin u\right) 									& r &\\
		\dot{x} & = & \left(\cos\Omega \cos u - \sin \Omega \cos i \sin u\right) 	& v_R  - \left(\cos\Omega \sin u + \sin \Omega \cos i \cos u\right) & v_T \\
		\dot{y} & = & \left(\sin\Omega \cos u + \cos \Omega \cos i \sin u\right)	& v_R  - \left(\sin\Omega \sin u - \cos \Omega \cos i \cos u\right) & v_T \\
		\dot{z} & = & \left(\sin i \sin u \right) 									& v_R + \left(\cos u \sin i \right) 								& v_T
		\end{array}\right.
		\]
		%
		\noindent where $v_R$ and $v_T$ are the radial and tangential velocities, namely:
		%
		\[
		\left\{ \begin{array}{lllll}
		v_R & = & \dot{r} & = & \dfrac{h}{p} e \sin \theta \\[1.5em]
		v_T & = &  r \dot{\theta} & = & \dfrac{h}{p} \rho
		\end{array}\right.
		\]
		\subsubsection{ECI to KOE transformation.}
		%
		\indent This transformation is considerably more complex. For that reason, the relations will not be entirely justified. These are the following:
		%
		\begin{itemize}
		\item \myul[GMVred]{Semimajor axis}: Directly from energy equation:
		%
		\[
		a = \dfrac{r}{2 - \dfrac{r v^2}{\mu}}
		\]
		%
		\item \myul[GMVred]{Eccentricity}: Prior relations arise from (a) the dot product of velocity and position and (b) the polar equation of the ellipse:
		%
		\[
		\begin{array}{ccc}
		\left\{ \begin{array}{lll}
		e\sin\theta & = & \dfrac{h}{\mu r} \underline{r} \cdot \underline{v}\\[1.5em]
		e\cos\theta & = & \dfrac{p}{r} - 1
		\end{array}\right. 
		&
		\Rightarrow
		& 
		e = \dsqrt{(e\sin\theta)^2 + (e\cos\theta)^2}
		\end{array}
		\]
		\noindent where $p$ is the orbit parameter.
		%
		%
		\item \myul[GMVred]{Inclination} From the orientation of the angular momentum vector:
		%
		\[
		i = \atantwo\left( h_{xy},\: h_z \right)
		\]
		\noindent where $h_{xy} = \sqrt{h_x^2 + h_y^2}$
		\end{itemize}
		%
		\indent The remaining elements ($\Omega$, $\omega$ and $M$) depend on the type of the orbit. If the orbit is equatorial ($i=0$), $\Omega$ and $\omega$ are not defined by themselves. Furthermore, if the orbit is circular, not even $\omega$ is defined, and therefore it is necessary to make some adjustments. In the first case, $\varpi = \omega + \Omega $ is assumed as our fifth element, and the fourth will be null. In the second case, all values will be merged into the mean anomaly, assuming both $\omega$ and $\Omega$ to be null.\\
		%
		\subparagraph{Case A) Non-singular eccentricity or inclination.\\}
		%
		\[
		\left\{
		\begin{array}{lll}
		\Omega 	& = & \atantwo\left( h_x,\: -h_y\right)\\
		u 		& = & \atantwo\left( h \cdot z,\: y\cdot h_x - x \cdot h_y\right)\\
		\theta 	& = & \atantwo\left(e\sin\theta,\: e\cos\theta\right)\\
		\omega 	& = & u - \theta
		\end{array}\right.
		\]
		%
		\subparagraph{Case B) Null inclination, non-singular eccentricity. \\}
		%
		\[
		\left\{
		\begin{array}{lll}
		\Omega 	& = & 0 \\
		u 		& = & \atantwo\left( y, x \right) \cdot \sign (h_z) \\
		\theta 	& = & \atantwo\left(e\sin\theta, e\cos\theta\right)\\
		\omega 	& = & u - \theta
		\end{array}\right.
		\]
		%
		\subparagraph{Case C) Null eccentricity, non-singular inclination. \\}
		%
		\indent Auxiliary definitions:
		%
		\[\left\{
		\begin{array}{lll}
		\underline{N} 	& = & \underline{\hat{e}_z} \times \underline{h} \\
		N_{xy} 			& = & \sqrt{N_x^2 + N_y^2} \\
		S 				& = & \sign\left( (\underline{e} \times\underline{r}) \cdot \underline{h} \right)
		\end{array}
		\right.
		\]
		%
		\indent Element computation:
		\[
		\left\{
		\begin{array}{lll}
		\Omega 	& = & \atantwo\left( h_x, -h_y\right)\\
		\omega 	& = & 0 \\
		\theta 	& = & S \cdot \arccos\left( \dfrac{\underline{r}}{r}, \dfrac{\underline{N}}{N_{xy}} \right)\\
		\end{array}\right.
		\]
		%
		\subparagraph{Case D) Null eccentricity and inclination. \\}
		%
		\[
		\left\{
		\begin{array}{lll}
		\Omega 	& = & 0 \\
		\omega 	& = & 0 \\
		\theta 	& = & \atantwo(y, x) \cdot \sign(h_z)\\
		\end{array}\right.
		\]
		%
	%
	\subsection{Relative Keplerian OEs to RTN.}\label{sec:RKOE2RTN}
	%
	\indent Although one can technically go from RKOEs to RTN coordinates in several steps already described, there is a direct mapping between them, developed by H. Schaub \cite{Schaub2004}. Without further ado, the position mapping is expressed as follows:
	%
	\begin{subequations}
	\label{eqAppB: 	RKOE_RTN_pos}
	\begin{alignat}{3}[left=\empheqlbrace]
	&x   \approx && \dfrac{r}{a} \delta a + \dfrac{ae\sin\theta}{\eta} \delta M - a\; \cos\theta \delta e\\
	&y	 \approx && \dfrac{r\rho^2}{\eta^3} \delta M + r\delta\omega + \dfrac{r\sin\theta }{\eta^2} (\rho + 1) \delta e + r\cos i \delta\Omega \\
	&z	 \approx && r\left(\sin u \delta i - \cos u \sin i \delta \Omega\right)
	\end{alignat}
	\end{subequations}
	%
	\indent Nonetheless, the mapping for the velocity is expressed in terms of relative quasi-non-singular OEs \cite{Schaub_Alfriend}. For the conversion from RKOEs to these, please see \ref{app:App_A}:
	%
	\begin{subequations}
	\label{eqAppB: 	RKOE_RTN_vel}
	\begin{alignat}{4}[left=\empheqlbrace]
	\nonumber &\dot{x}	\approx & -\dfrac{V_{r}}{2 a} \delta a+\left(\dfrac{1}{r}-\dfrac{1}{p}\right) h \delta u \\
	 & & +\left(V_{r} a q_{1}+h \sin u\right) \dfrac{\delta q_{1}}{p}+\left(V_{r} a q_{2}-h \cos u\right) \dfrac{\delta q_{2}}{p} \\
	\nonumber &\dot{y}	\approx & -\dfrac{3 V_{t}}{2 a} \delta a-V_{r} \delta u+\left(3 V_{t} a q_{1}+2 h \cos u\right) \dfrac{\delta q_{1}}{p} \\
	 & & +\left(3 V_{t} a q_{2}+2 h \sin u\right) \dfrac{\delta q_{2}}{p}+V_{r} \cos i \delta \Omega \\
	\nonumber& \dot{z} \approx & \left(V_{t} \cos u+V_{r} \sin u\right) \delta i \\
	 & & +\left(V_{t} \sin u-V_{r} \cos u\right) \sin i \delta \Omega
	\end{alignat}
	\end{subequations}
	
	%
	\indent The mapping represented by equations \eqref{eqAppB: 	RKOE_RTN_pos} and \eqref{eqAppB: 	RKOE_RTN_vel} is a linear approximation, in which it is assumed that the relative distance between spacecrafts is much smaller than the chief's orbital radius. For more in-depth content about this transformation, please see \cite{Schaub2004, Schaub_Alfriend}.
